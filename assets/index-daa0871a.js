import{r as g,a as ce,R as me}from"./vendor-b1791c80.js";import{A as te,T as de,a as ue,C as se,b as pe,Z as he,c as xe,S as fe,R as ve,d as ge}from"./utils-12f0a800.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function l(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(r){if(r.ep)return;r.ep=!0;const a=l(r);fetch(r.href,a)}})();var ae={exports:{}},B={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var je=g,ye=Symbol.for("react.element"),Ne=Symbol.for("react.fragment"),ke=Object.prototype.hasOwnProperty,be=je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,we={key:!0,ref:!0,__self:!0,__source:!0};function re(t,n,l){var c,r={},a=null,s=null;l!==void 0&&(a=""+l),n.key!==void 0&&(a=""+n.key),n.ref!==void 0&&(s=n.ref);for(c in n)ke.call(n,c)&&!we.hasOwnProperty(c)&&(r[c]=n[c]);if(t&&t.defaultProps)for(c in n=t.defaultProps,n)r[c]===void 0&&(r[c]=n[c]);return{$$typeof:ye,type:t,key:a,ref:s,props:r,_owner:be.current}}B.Fragment=Ne;B.jsx=re;B.jsxs=re;ae.exports=B;var e=ae.exports,z={},Z=ce;z.createRoot=Z.createRoot,z.hydrateRoot=Z.hydrateRoot;const K=new Map;function Se(){K.clear(),q.clear()}function H(t){try{if(!t)return null;const n=t.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(!n)return null;const[,,l,c,r,a,s,i]=n,u={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}[l.toLowerCase()];if(u===void 0)return null;let m=parseInt(a);return i.toUpperCase()==="PM"&&m!==12?m+=12:i.toUpperCase()==="AM"&&m===12&&(m=0),new Date(parseInt(r),u,parseInt(c),m,parseInt(s))}catch{return null}}function $e(t){try{if(!t)return!1;const n=t.split("/");if(n.length!==3)return!1;const l=parseInt(n[0])-1,c=parseInt(n[1]),r=parseInt(n[2]);return new Date(r,l,c,23,59,59)<new Date}catch{return!1}}function Te(t,n){var o,u;const l=`${n||"unknown"}_${t.length}_${t.slice(0,100)}`,c=K.get(l);if(c)return c;const r=t.split(`
`),a=[],s=Math.max(1e3,r.length*.8);a.length=s;let i=0;for(let m=1;m<r.length;m++){const p=r[m].trim();if(!p)continue;const x=Ve(p);if(!(x.length<20))try{const v=x[5]||"",y=x[6]||"",b=x[7]||"",f=parseFloat(x[8])||0,h=x[9]||"",S=x[10],D=parseInt(((o=x[12])==null?void 0:o.replace(/,/g,""))||"0"),F=x[13]||"$0",O=parseInt(((u=x[14])==null?void 0:u.replace(/,/g,""))||"0"),d=0,j=["Ask","Above","Bid","Below","Sweep","Block","Trade","Volume","Premium"],w=b&&b.length>=1&&b.length<=10&&!j.includes(b)&&!b.match(/^\d+$/)&&!b.includes(" ")&&/^[A-Z0-9]+$/.test(b),V=$e(h);w&&f>0&&h&&S&&D>0&&!V&&(a[i++]={ticker:b,strike:f,expiry:h,optionType:S,volume:D,premium:F,openInterest:O,bidAskSpread:d,timestamp:v,sweepType:y,sourceFile:n})}catch{}}return a.length=i,K.set(l,a),a}function Ve(t){const n=[];let l="",c=!1;for(let r=0;r<t.length;r++){const a=t[r];a==='"'?c=!c:a===","&&!c?(n.push(l.trim()),l=""):l+=a}return n.push(l.trim()),n}const q=new Map;function Pe(t){const n=`${t.length}_${t.slice(0,3).map(a=>`${a.ticker}_${a.timestamp}`).join("_")}`,l=q.get(n);if(l)return l;const c=new Map;for(let a=0;a<t.length;a++){const s=t[a];if(!c.has(s.ticker)){const u=H(s.timestamp);c.set(s.ticker,{ticker:s.ticker,totalVolume:0,callVolume:0,putVolume:0,totalPremium:0,uniqueExpiries:[],expirySet:new Set,lastActivity:s.timestamp,lastActivityDate:u,lastTrade:{strike:s.strike,optionType:s.optionType,volume:s.volume,premium:s.premium,sweepType:s.sweepType,timestamp:s.timestamp}})}const i=c.get(s.ticker);i.totalVolume+=s.volume,i.totalPremium+=Ee(s.premium),s.optionType==="Call"?i.callVolume+=s.volume:i.putVolume+=s.volume,i.expirySet.has(s.expiry)||(i.expirySet.add(s.expiry),i.uniqueExpiries.push(s.expiry));const o=H(s.timestamp);o&&i.lastActivityDate&&o>i.lastActivityDate?(i.lastActivity=s.timestamp,i.lastActivityDate=o,i.lastTrade={strike:s.strike,optionType:s.optionType,volume:s.volume,premium:s.premium,sweepType:s.sweepType,timestamp:s.timestamp}):o&&!i.lastActivityDate&&(i.lastActivity=s.timestamp,i.lastActivityDate=o,i.lastTrade||(i.lastTrade={strike:s.strike,optionType:s.optionType,volume:s.volume,premium:s.premium,sweepType:s.sweepType,timestamp:s.timestamp}))}const r=Array.from(c.values()).map(({expirySet:a,...s})=>s).sort((a,s)=>{const i=a.lastActivityDate,o=s.lastActivityDate;return i&&o&&i.getTime()!==o.getTime()?o.getTime()-i.getTime():s.totalVolume-a.totalVolume});return q.set(n,r),r}function De(t,n,l){const c=t.filter(a=>a.ticker===n&&(!l||a.expiry===l)),r=new Map;return c.forEach(a=>{r.has(a.strike)||r.set(a.strike,{strike:a.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const s=r.get(a.strike);s.totalVolume+=a.volume,s.openInterest+=a.openInterest,a.optionType==="Call"?s.callVolume+=a.volume:s.putVolume+=a.volume}),Array.from(r.values()).sort((a,s)=>a.strike-s.strike)}function Ce(t,n){const l=new Set;return t.forEach(c=>{c.ticker===n&&l.add(c.expiry)}),Array.from(l).sort((c,r)=>new Date(c).getTime()-new Date(r).getTime())}function Me(t,n,l){const c=t.filter(i=>i.ticker===n&&(!l||i.expiry===l));if(!c.length)return null;const r=new Map;c.forEach(i=>{r.has(i.strike)||r.set(i.strike,{strike:i.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const o=r.get(i.strike);o.totalVolume+=i.volume,o.openInterest+=i.openInterest,i.optionType==="Call"?o.callVolume+=i.volume:o.putVolume+=i.volume});const s=Array.from(r.values()).reduce((i,o)=>o.totalVolume>i.totalVolume?o:i);return{strike:s.strike,totalVolume:s.totalVolume,callVolume:s.callVolume,putVolume:s.putVolume,openInterest:s.openInterest}}function Ee(t){const n=t.replace(/[$,K]/g,""),l=parseFloat(n);return t.includes("K")?l*1e3:t.includes("M")?l*1e6:l}function E(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function Ae(t){return t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(0)}`}function G(t){const n=[],l=[];let c=null,r=null;const a=new Map;t.sort((o,u)=>u.timestamp.getTime()-o.timestamp.getTime()).forEach(o=>{const u=Te(o.data,o.filename);u.forEach(m=>{const p=`${m.ticker}_${m.strike}_${m.expiry}_${m.optionType}_${m.volume}_${m.premium}_${m.timestamp}`;a.has(p)||a.set(p,m)}),l.push({filename:o.filename,recordCount:u.length,timestamp:o.timestamp}),(!c||o.timestamp<c)&&(c=o.timestamp),(!r||o.timestamp>r)&&(r=o.timestamp)}),n.push(...a.values());const i={totalFiles:t.length,totalRecords:n.length,dateRange:{earliest:c,latest:r},files:l};return{mergedData:n,info:i}}function Le(t,n,l){if(t.length===0)return null;const c=t.reduce((f,h)=>f+h.volume,0),r=t.reduce((f,h)=>{const S=parseFloat(h.premium.replace(/[$,]/g,""))||0;return f+S},0),a=t.filter(f=>f.optionType==="Call").reduce((f,h)=>f+h.volume,0),s=t.filter(f=>f.optionType==="Put").reduce((f,h)=>f+h.volume,0),i=s>0?a/s:a,o=t.filter(f=>f.sweepType&&f.sweepType.toLowerCase().includes("sweep")).length,u=c/t.length,m=[...new Set(l.map(f=>f.ticker))],p=l.reduce((f,h)=>f+h.volume,0)/m.length,x=l.reduce((f,h)=>{const S=parseFloat(h.premium.replace(/[$,]/g,""))||0;return f+S},0)/m.length,v=[];let y="low",b="volume";return c>p*3?(v.push(`Volume ${(c/p*100).toFixed(0)}% above average`),y="high",b="volume"):c>p*2&&(v.push(`Volume ${(c/p*100).toFixed(0)}% above average`),y="medium"),r>x*3?(v.push(`Premium ${(r/x*100).toFixed(0)}% above average`),y="high",b!=="volume"?b="premium":b="multiple"):r>x*2&&(v.push(`Premium ${(r/x*100).toFixed(0)}% above average`),y!=="high"&&(y="medium")),o>5?(v.push(`${o} sweeps detected`),y="high",b=b==="volume"||b==="premium"?"multiple":"sweep"):o>2&&(v.push(`${o} sweeps detected`),y==="low"&&(y="medium")),i>5?(v.push(`Heavy call bias (${i.toFixed(1)}:1)`),y==="low"&&(y="medium")):i<.2&&(v.push(`Heavy put bias (1:${(1/i).toFixed(1)})`),y==="low"&&(y="medium")),u>5e3&&(v.push(`Large avg trade size: ${E(Math.round(u))}`),y==="low"&&(y="medium")),v.length>0?{ticker:n,alertType:b,severity:y,reason:v.join(" • "),metrics:{totalVolume:c,totalPremium:r,callPutRatio:i,sweepCount:o,avgTradeSize:u}}:null}function Ie(t,n=5){if(t.length===0)return[];const l=new Map;return t.forEach(r=>{const a=l.get(r.strike)||{volume:0,openInterest:0,premium:0,callVolume:0,putVolume:0},s=parseFloat(r.premium.replace(/[$,]/g,""))||0;a.volume+=r.volume,a.openInterest+=r.openInterest,a.premium+=s,r.optionType==="Call"?a.callVolume+=r.volume:a.putVolume+=r.volume,l.set(r.strike,a)}),Array.from(l.entries()).map(([r,a])=>{const s=Math.max(...Array.from(l.values()).map(b=>b.volume)),i=Math.max(...Array.from(l.values()).map(b=>b.openInterest)),o=Math.max(...Array.from(l.values()).map(b=>b.premium)),u=s>0?a.volume/s:0,m=i>0?a.openInterest/i:0,p=o>0?a.premium/o:0,x=u*.4+m*.4+p*.2;let v="low";x>.7?v="high":x>.4&&(v="medium");let y="both";return a.callVolume>a.putVolume*2?y="call":a.putVolume>a.callVolume*2&&(y="put"),{strike:r,volume:a.volume,openInterest:a.openInterest,premium:a.premium,significance:v,type:y,combinedScore:x}}).sort((r,a)=>a.combinedScore-r.combinedScore).slice(0,n).map(({combinedScore:r,...a})=>a)}function Fe(t,n){if(t.length===0)return[];const l=new Map;return t.forEach(r=>{const a=l.get(r.strike)||{callVolume:0,putVolume:0,callOI:0,putOI:0};r.optionType==="Call"?(a.callVolume+=r.volume,a.callOI+=r.openInterest):(a.putVolume+=r.volume,a.putOI+=r.openInterest),l.set(r.strike,a)}),Array.from(l.entries()).map(([r,a])=>{let s=1;if(n){const p=Math.abs(r-n)/n;p<.05?s=2:p<.1?s=1.5:p>.2&&(s=.5)}const i=(a.putOI-a.callOI)*s,o=Math.abs(i),u=Math.max(...Array.from(l.values()).map(p=>Math.abs(p.putOI-p.callOI)));let m="low";if(u>0){const p=o/u;p>.7?m="extreme":p>.4?m="high":p>.2&&(m="moderate")}return{strike:r,netGammaExposure:i,callVolume:a.callVolume,putVolume:a.putVolume,callOI:a.callOI,putOI:a.putOI,level:m}}).sort((r,a)=>r.strike-a.strike)}function Re(t){if(t.length===0)return null;const n=[...new Set(t.map(a=>a.strike))].sort((a,s)=>a-s),l=new Map;n.forEach(a=>{let s=0;t.forEach(i=>{const{strike:o,optionType:u,openInterest:m}=i;u==="Call"?a<o&&(s+=m*(o-a)):a>o&&(s+=m*(a-o))}),l.set(a,s)});let c=n[0],r=l.get(n[0])||0;return l.forEach((a,s)=>{a>r&&(r=a,c=s)}),c}function _e(t,n,l){const c=n.filter(r=>r.ticker===t);return{ticker:t,unusualActivity:Le(c,t,n),keyPriceLevels:Ie(c,5),gammaExposure:Fe(c,l),maxPainStrike:Re(c),currentPrice:l}}const Oe=(t,n)=>{try{let l;return n?l=n:l=new Date(t),isNaN(l.getTime())?"Unknown":l.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" "+l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return"Unknown"}},le=g.memo(({tickers:t,onTickerSelect:n,allData:l})=>{const[c,r]=g.useState("recent"),a=g.useMemo(()=>{const s=[...t];switch(c){case"recent":return s.sort((i,o)=>i.lastActivityDate&&o.lastActivityDate?o.lastActivityDate.getTime()-i.lastActivityDate.getTime():0);case"oldest":return s.sort((i,o)=>i.lastActivityDate&&o.lastActivityDate?i.lastActivityDate.getTime()-o.lastActivityDate.getTime():0);case"volume-high":return s.sort((i,o)=>o.totalVolume-i.totalVolume);case"volume-low":return s.sort((i,o)=>i.totalVolume-o.totalVolume);case"calls-high":return s.sort((i,o)=>o.callVolume-i.callVolume);case"puts-high":return s.sort((i,o)=>o.putVolume-i.putVolume);case"premium-high":return s.sort((i,o)=>o.totalPremium-i.totalPremium);case"premium-low":return s.sort((i,o)=>i.totalPremium-o.totalPremium);default:return s}},[t,c]);return e.jsxs("div",{className:"ticker-list",children:[e.jsxs("div",{className:"ticker-list-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h2",{children:"Options Volume Dashboard"}),e.jsx("p",{children:"Click on any ticker to view detailed volume profile"})]}),e.jsxs("div",{className:"sort-controls",children:[e.jsx(te,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:s=>r(s.target.value),children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"volume-high",children:"Volume (High to Low)"}),e.jsx("option",{value:"volume-low",children:"Volume (Low to High)"}),e.jsx("option",{value:"calls-high",children:"Calls (High to Low)"}),e.jsx("option",{value:"puts-high",children:"Puts (High to Low)"}),e.jsx("option",{value:"premium-high",children:"Premium (High to Low)"}),e.jsx("option",{value:"premium-low",children:"Premium (Low to High)"})]})]})]}),e.jsx("div",{className:"ticker-grid",children:a.map(s=>{const i=s.callVolume>s.putVolume,o=s.putVolume>s.callVolume,u=i?"call-dominant":o?"put-dominant":"balanced",m=_e(s.ticker,l);return e.jsxs("div",{className:`ticker-card ${u}`,onClick:()=>n(s.ticker),children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h3",{className:"ticker-symbol",children:s.ticker}),e.jsxs("div",{className:"ticker-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx(de,{className:"metric-icon call"}),e.jsx("span",{className:"metric-label",children:"Calls"}),e.jsx("span",{className:"metric-value",children:E(s.callVolume)})]}),e.jsxs("div",{className:"metric",children:[e.jsx(ue,{className:"metric-icon put"}),e.jsx("span",{className:"metric-label",children:"Puts"}),e.jsx("span",{className:"metric-value",children:E(s.putVolume)})]})]})]}),e.jsxs("div",{className:"ticker-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Volume:"}),e.jsx("span",{className:"detail-value",children:E(s.totalVolume)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Premium:"}),e.jsx("span",{className:"detail-value",children:Ae(s.totalPremium)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(se,{className:"detail-icon"}),e.jsx("span",{className:"detail-label",children:"Expiries:"}),e.jsx("span",{className:"detail-value",children:s.uniqueExpiries.length})]}),s.lastTrade&&e.jsxs("div",{className:"detail-row last-trade-row",children:[e.jsx("span",{className:"detail-label",children:"Last Trade:"}),e.jsxs("span",{className:"detail-value last-trade",children:[s.lastTrade.optionType," $",s.lastTrade.strike,e.jsx("span",{className:`trade-side ${s.lastTrade.optionType.toLowerCase()}`,children:s.lastTrade.optionType==="Call"?"↗":"↘"}),E(s.lastTrade.volume)]})]})]}),(m.keyPriceLevels.length>0||m.maxPainStrike)&&e.jsxs("div",{className:"ticker-analytics",children:[m.keyPriceLevels.length>0&&e.jsxs("div",{className:"analytics-badge key-levels-badge",children:[e.jsx(pe,{size:12}),e.jsx("span",{className:"badge-label",children:"Key Levels:"}),e.jsx("span",{className:"badge-strikes",children:m.keyPriceLevels.slice(0,3).map((p,x)=>e.jsxs("span",{className:`level-strike level-${p.significance}`,title:`${p.type==="call"?"Call":p.type==="put"?"Put":"Call/Put"} - Vol: ${E(p.volume)}, OI: ${E(p.openInterest)}`,children:[x>0&&", ","$",p.strike]},p.strike))})]}),m.maxPainStrike&&e.jsxs("div",{className:"analytics-badge max-pain-badge",children:[e.jsx(he,{size:12}),e.jsx("span",{className:"badge-label",children:"Max Pain:"}),e.jsxs("span",{className:"badge-value",children:["$",m.maxPainStrike]})]})]}),e.jsx("div",{className:"ticker-footer",children:e.jsxs("div",{className:"last-activity",children:[e.jsx(xe,{className:"activity-icon"}),e.jsx("span",{children:Oe(s.lastActivity,s.lastActivityDate)})]})})]},s.ticker)})})]})});le.displayName="TickerList";const W=g.memo(({data:t,highestVolumeData:n,ticker:l,expiry:c,chartType:r,currentPrice:a,trades:s=[]})=>{const[i,o]=g.useState({visible:!1,x:0,y:0,content:null}),u=g.useCallback((d,j)=>j===0?0:Math.min(d/j*46,46),[]),m=g.useCallback((d,j)=>{const w=s.filter(k=>k.strike===d&&(!j||k.optionType===j)),V=w.reduce((k,P)=>k+P.volume,0),T=w.reduce((k,P)=>{const M=P.premium.replace(/[$,]/g,"");return k+(parseFloat(M)||0)},0),A=T>=1e6?(T/1e6).toFixed(2)+"M":T>=1e3?(T/1e3).toFixed(1)+"K":T.toFixed(0),C=T.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),R=[...new Set(w.map(k=>k.sweepType))].filter(Boolean),_=w.map(k=>k.volume).sort((k,P)=>P-k),I=[...new Set(w.map(k=>k.expiry))].sort(),N=V,$=w.sort((k,P)=>P.volume-k.volume).map(k=>({volume:k.volume,premium:k.premium,timestamp:k.timestamp,expiry:k.expiry}));return{strike:d,type:j,volume:V,trades:w.length,premium:A,premiumFull:C,sweepTypes:R,tradeVolumes:_,expiries:I,size:N,tradeDetails:$}},[s]),p=g.useCallback((d,j,w)=>{const V=d.currentTarget.getBoundingClientRect(),T=m(j,w);o({visible:!0,x:d.clientX,y:V.top-10,content:T})},[m]),x=g.useCallback(()=>{o(d=>({...d,visible:!1}))},[]),v=g.useCallback(d=>{o(j=>({...j,x:d.clientX}))},[]),y=g.useCallback(()=>a||(n==null?void 0:n.strike)||null,[a,n]),b=g.useCallback(d=>{const j=y();return j!==null&&Math.abs(d-j)<.01},[y]),h=g.useCallback(()=>t.sort((d,j)=>d.strike-j.strike),[t])(),S=g.useMemo(()=>{if(!h.length)return{maxVolume:0,minStrike:0,maxStrike:0,maxTotalVolume:0,totalVolumeSum:0};let d=0,j=0,w=1/0,V=-1/0,T=0;for(let A=0;A<h.length;A++){const C=h[A];d=Math.max(d,Math.max(C.callVolume,C.putVolume)),j=Math.max(j,C.totalVolume),w=Math.min(w,C.strike),V=Math.max(V,C.strike),T+=C.totalVolume}return{maxVolume:d,minStrike:w===1/0?0:w,maxStrike:V===-1/0?0:V,maxTotalVolume:j,totalVolumeSum:T}},[h]),D=g.useCallback(d=>{if(!h.length||S.maxStrike===S.minStrike)return 50;const j=h.findIndex(T=>T.strike===d);if(j===-1)return 50;const w=h.length,V=100/(w+1);if(r==="callput"){const T=w-1-j;return V*(T+1)}else return V*(j+1)},[h,S,r]),F=g.useCallback(d=>{if(!h.length||S.maxStrike===S.minStrike)return 50;const j=S.minStrike,w=S.maxStrike,V=Math.max(j,Math.min(w,d));let T=j,A=w,C=0,R=h.length-1;for(let M=0;M<h.length-1;M++){const L=h[M].strike,X=h[M+1].strike;if(L<=V&&V<=X){T=L,A=X,C=M,R=M+1;break}}const _=h.length,I=100/(_+1);let N,$;if(r==="callput"){const M=_-1-C,L=_-1-R;N=I*(M+1),$=I*(L+1)}else N=I*(C+1),$=I*(R+1);if(A===T)return N;const k=(V-T)/(A-T);return N+($-N)*k},[h,S,r]),O=g.useCallback(()=>Math.max(400,h.length*18+40),[h.length]);return t.length?r==="callput"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"volume-profile-chart modern-mirrored-chart",children:[e.jsxs("div",{className:"chart-header modern-header",children:[e.jsxs("h3",{children:[l," Call/Put Volume"]}),e.jsxs("div",{className:"header-info",children:[y()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",y()]})]}),c&&e.jsx("span",{className:"expiry-date",children:c})]})]}),e.jsx("div",{className:"chart-container modern-container",children:e.jsxs("div",{className:"chart-area modern-chart-area",style:{height:`${O()}px`},children:[e.jsx("div",{className:"center-line"}),e.jsx("div",{className:"strike-axis modern-strike-axis",children:h.map(d=>e.jsx("div",{className:"strike-line modern-strike-line",style:{top:`${D(d.strike)}%`},children:e.jsx("span",{className:`strike-label modern-strike-label ${b(d.strike)?"current-price-label":""}`,children:d.strike})},d.strike))}),e.jsx("div",{className:"volume-bars modern-volume-bars",children:h.map(d=>e.jsxs("div",{className:"strike-row modern-strike-row",style:{top:`${D(d.strike)}%`},children:[e.jsx("div",{className:"volume-bar call-bar modern-call-bar",style:{width:`${u(d.callVolume,S.maxVolume)}%`,right:"52%"},onMouseEnter:j=>p(j,d.strike,"Call"),onMouseLeave:x,onMouseMove:v,children:d.callVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:E(d.callVolume)})}),e.jsx("div",{className:"volume-bar put-bar modern-put-bar",style:{width:`${u(d.putVolume,S.maxVolume)}%`,left:"52%"},onMouseEnter:j=>p(j,d.strike,"Put"),onMouseLeave:x,onMouseMove:v,children:d.putVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:E(d.putVolume)})})]},d.strike))}),y()&&e.jsx("div",{className:"current-price-line",style:{top:`${F(y())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"105%",top:"50%",transform:"translateY(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",y().toFixed(2)]})})]})})]}),i.visible&&i.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${i.x+15}px`,top:`${i.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>o(d=>({...d,visible:!0})),onMouseLeave:x,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",i.content.strike]}),i.content.type&&e.jsx("span",{className:`tooltip-type ${i.content.type.toLowerCase()}`,children:i.content.type})]}),e.jsx("div",{className:"tooltip-body",children:i.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:i.content.tradeDetails.map((d,j)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:d.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:d.premium})]}),d.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(d.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!d.timestamp)return"N/A";const w=new Date(d.timestamp);return isNaN(w.getTime())?d.timestamp:`${w.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${w.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return d.timestamp||"N/A"}})()})]})]},j))})]})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"volume-profile-chart total-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[l," Total Volume"]}),e.jsxs("div",{className:"header-info",children:[y()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",y()]})]}),c&&e.jsx("span",{className:"expiry-date",children:c})]})]}),e.jsxs("div",{className:"chart-container vertical",children:[e.jsxs("div",{className:"chart-area vertical",style:{height:`${O()}px`},children:[e.jsx("div",{className:"volume-bars vertical",children:h.map(d=>e.jsx("div",{className:"strike-column",style:{left:`${D(d.strike)}%`},children:e.jsx("div",{className:"volume-bar total-bar vertical",style:{height:`${u(d.totalVolume,S.maxTotalVolume)}%`},onMouseEnter:j=>p(j,d.strike),onMouseLeave:x,onMouseMove:v,children:d.totalVolume>0&&e.jsxs("span",{className:"volume-text volume-text-top",children:[E(d.totalVolume),e.jsxs("span",{className:"volume-percentage",children:["(",S.totalVolumeSum>0?(d.totalVolume/S.totalVolumeSum*100).toFixed(1):"0.0","%)"]})]})})},d.strike))}),y()&&e.jsx("div",{className:"current-price-line vertical",style:{left:`${F(y())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"50%",top:"-30px",transform:"translateX(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",y().toFixed(2)]})})]}),e.jsx("div",{className:"x-axis-labels",children:h.map(d=>e.jsx("div",{className:"x-axis-label",style:{left:`${D(d.strike)}%`},children:e.jsx("span",{className:`strike-label ${b(d.strike)?"current-price-label":""}`,children:d.strike})},d.strike))})]}),i.visible&&i.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${i.x+15}px`,top:`${i.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>o(d=>({...d,visible:!0})),onMouseLeave:x,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",i.content.strike]}),i.content.type&&e.jsx("span",{className:`tooltip-type ${i.content.type.toLowerCase()}`,children:i.content.type})]}),e.jsx("div",{className:"tooltip-body",children:i.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:i.content.tradeDetails.map((d,j)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:d.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:d.premium})]}),d.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(d.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!d.timestamp)return"N/A";const w=new Date(d.timestamp);return isNaN(w.getTime())?d.timestamp:`${w.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${w.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return d.timestamp||"N/A"}})()})]})]},j))})]})})]})]})}):e.jsxs("div",{className:"volume-profile-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[l," ",r==="callput"?"Call/Put Volume":"Total Volume"]}),c&&e.jsx("span",{className:"expiry-date",children:c})]}),e.jsx("div",{className:"no-data",children:e.jsxs("p",{children:["No volume data available for this ticker",c?" and expiry date":""]})})]})});W.displayName="VolumeProfileChart";const ie=g.memo(({trade:t})=>{const n=a=>{try{const s=a.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(s){const[,,o,u,,m,p,x]=s;let v=parseInt(m);x.toUpperCase()==="PM"&&v!==12?v+=12:x.toUpperCase()==="AM"&&v===12&&(v=0);const f=`${{january:"01",february:"02",march:"03",april:"04",may:"05",june:"06",july:"07",august:"08",september:"09",october:"10",november:"11",december:"12"}[o.toLowerCase()]||"01"}/${u.padStart(2,"0")}`,h=`${v.toString().padStart(2,"0")}:${p}`;return`${f} ${h}`}const i=new Date(a);return isNaN(i.getTime())?"Unknown":i.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit"})+" "+i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return"Unknown"}},r=(a=>{const s=a.replace(/[$,]/g,""),i=parseFloat(s);return a.includes("M")?i*1e6:a.includes("K")?i*1e3:i})(t.premium)>=1e6;return e.jsxs("div",{className:"trade-row-horizontal",style:{backgroundColor:t.optionType==="Call"?r?"rgba(0, 80, 0, 0.7)":"rgba(0, 100, 0, 0.5)":r?"rgba(100, 0, 0, 0.7)":"rgba(139, 0, 0, 0.5)"},children:[e.jsx("div",{className:"trade-cell-h symbol",children:t.ticker}),e.jsx("div",{className:"trade-cell-h strike",children:t.strike}),e.jsx("div",{className:"trade-cell-h expiry",children:new Date(t.expiry).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})}),e.jsx("div",{className:"trade-cell-h type",children:t.optionType}),e.jsx("div",{className:"trade-cell-h side",children:t.sweepType}),e.jsx("div",{className:"trade-cell-h size",children:E(t.volume)}),e.jsx("div",{className:"trade-cell-h premium",children:t.premium}),e.jsx("div",{className:"trade-cell-h volume",children:E(t.volume)}),e.jsx("div",{className:"trade-cell-h oi",children:E(t.openInterest)}),e.jsx("div",{className:"trade-cell-h exec-time",children:n(t.timestamp)})]})});ie.displayName="TradeRow";const ne=g.memo(({trades:t,ticker:n,expiry:l})=>{const[c,r]=g.useState("trade-date"),a=g.useMemo(()=>[...t].sort((o,u)=>{switch(c){case"trade-date":{const m=H(o.timestamp),p=H(u.timestamp);return!m||!p?0:p.getTime()-m.getTime()}case"expiry-date":{const m=new Date(o.expiry),p=new Date(u.expiry);return m.getTime()-p.getTime()}case"size":return u.volume-o.volume;default:return 0}}),[t,c]),s=g.useMemo(()=>l?a.filter(o=>o.expiry===l):a,[a,l]);if(s.length===0)return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("h3",{children:[n," Trade History"]}),l&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(l).toLocaleDateString()]})]}),e.jsx("div",{className:"no-trades",children:e.jsxs("p",{children:["No trades found for ",n,l?` on ${new Date(l).toLocaleDateString()}`:""]})})]});const i=g.useCallback((o,u)=>`${o.ticker}-${o.strike}-${o.expiry}-${o.timestamp}-${u}`,[]);return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsxs("h3",{children:[n," Trade History"]}),l&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(l).toLocaleDateString()]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"sort-controls",children:[e.jsx(te,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:o=>r(o.target.value),children:[e.jsx("option",{value:"trade-date",children:"Sort by Trade Date (Recent First)"}),e.jsx("option",{value:"expiry-date",children:"Sort by Expiry Date (Earliest First)"}),e.jsx("option",{value:"size",children:"Sort by Size (Largest First)"})]})]}),e.jsxs("div",{className:"trade-count",children:[s.length," trades"]})]})]}),e.jsx("div",{className:"trade-list-content",children:e.jsxs("div",{className:"trade-list-table",children:[e.jsxs("div",{className:"trade-table-header",children:[e.jsx("div",{className:"header-cell",children:"Symbol"}),e.jsx("div",{className:"header-cell",children:"Strike"}),e.jsx("div",{className:"header-cell",children:"Expiration"}),e.jsx("div",{className:"header-cell",children:"Call/Put"}),e.jsx("div",{className:"header-cell",children:"Side"}),e.jsx("div",{className:"header-cell",children:"Size"}),e.jsx("div",{className:"header-cell",children:"Premium"}),e.jsx("div",{className:"header-cell",children:"Volume"}),e.jsx("div",{className:"header-cell",children:"OI"}),e.jsx("div",{className:"header-cell",children:"Exec Time"})]}),e.jsx("div",{className:"trade-table-body",children:s.map((o,u)=>e.jsx(ie,{trade:o,index:u},i(o,u)))})]})})]})});ne.displayName="TradeList";function Ue(t){const n=t.includes("K"),l=t.includes("M"),c=t.replace(/[$,]/g,""),r=parseFloat(c);return l?r*1e6:n?r*1e3:r}const He=({trades:t,currentPrice:n})=>{const{heatmapData:l,strikes:c,expiries:r,maxAbsValue:a}=g.useMemo(()=>{const m=new Map,p=new Set,x=new Set;t.forEach(f=>{const h=`${f.strike}_${f.expiry}`;p.add(f.strike),x.add(f.expiry),m.has(h)||m.set(h,{value:0,volume:0,callVolume:0,putVolume:0,trades:0});const S=m.get(h),D=Ue(f.premium);Math.abs(D)<10&&f.ticker==="TSLA"&&console.log(`Small premium detected: ${f.ticker} ${f.strike} ${f.expiry} ${f.optionType} - Premium: "${f.premium}" -> Parsed: ${D}`),f.optionType==="Call"?(S.value+=D,S.callVolume+=f.volume):(S.value-=D,S.putVolume+=f.volume),S.volume+=f.volume,S.trades+=1});const v=Array.from(p).sort((f,h)=>h-f),y=Array.from(x).sort((f,h)=>{const S=new Date(f),D=new Date(h);return S.getTime()-D.getTime()});let b=0;return m.forEach(f=>{const h=Math.abs(f.value);h>b&&(b=h)}),{heatmapData:m,strikes:v,expiries:y,maxAbsValue:b}},[t]),s=(m,p)=>{if(p===0)return"rgba(255, 255, 255, 0.03)";const v=.2+Math.abs(m)/a*.6;return m>0?`rgba(76, 175, 80, ${v})`:`rgba(244, 67, 54, ${v})`},i=m=>{const p=Math.abs(m);return p>=1e6?`${m>=0?"":"-"}$${(p/1e6).toFixed(1)}M`:p>=1e3?`${m>=0?"":"-"}$${(p/1e3).toFixed(1)}K`:p>=1?`${m>=0?"":"-"}$${p.toFixed(0)}`:`${m>=0?"":"-"}$${p.toFixed(2)}`},o=m=>n?Math.abs(m-n)<2:!1,u=(m,p)=>`${m}_${p}`;return e.jsxs("div",{className:"strike-expiry-heatmap",children:[e.jsxs("div",{className:"heatmap-header",children:[e.jsx("h3",{children:"Strike × Expiry Premium Heatmap"}),e.jsxs("div",{className:"heatmap-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(76, 175, 80, 0.6)"}}),e.jsx("span",{children:"Call Premium"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(244, 67, 54, 0.6)"}}),e.jsx("span",{children:"Put Premium"})]}),n&&e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(255, 193, 7, 0.4)",border:"2px solid #ffc107"}}),e.jsxs("span",{children:["Current Price (~$",n.toFixed(2),")"]})]})]})]}),e.jsx("div",{className:"heatmap-scroll-container",children:e.jsxs("table",{className:"heatmap-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"heatmap-corner",children:"Strike"}),r.map(m=>e.jsx("th",{className:"heatmap-expiry",children:new Date(m).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"})},m))]})}),e.jsx("tbody",{children:c.map(m=>{const p=o(m);return e.jsxs("tr",{className:p?"current-price-row":"",children:[e.jsxs("td",{className:`heatmap-strike ${p?"at-money":""}`,children:[m.toFixed(1),p&&e.jsx("span",{className:"atm-indicator",children:"▶"})]}),r.map(x=>{const v=l.get(u(m,x)),y=v&&v.volume>0;return e.jsx("td",{className:`heatmap-cell ${y?"has-data":""} ${p?"at-money-cell":""}`,style:{background:y?s(v.value,v.volume):void 0},title:y?`Strike: $${m}
Expiry: ${x}
Net Premium: ${i(v.value)}
Volume: ${v.volume}
Calls: ${v.callVolume}
Puts: ${v.putVolume}
Trades: ${v.trades}`:void 0,children:y&&e.jsx("div",{className:"cell-content",children:e.jsx("span",{className:"cell-value",children:i(v.value)})})},`${m}_${x}`)})]},m)})})]})})]})};function oe(t){try{const n=t.match(/options_data_(\d{4}-\d{2}-\d{2})_(\d{2}-\d{2})\.csv/);if(!n)return null;const[,l,c]=n,[r,a,s]=l.split("-").map(Number),[i,o]=c.split("-").map(Number);return new Date(r,a-1,s,i,o)}catch{return null}}async function Be(){try{const t=await fetch("/api/data-files");return t.ok?(await t.json()).map(l=>({filename:l.name,timestamp:oe(l.name)||new Date,size:l.size})).sort((l,c)=>c.timestamp.getTime()-l.timestamp.getTime()):[{filename:"options_data_2024-01-15_10-00.csv",timestamp:new Date("2024-01-15T10:00:00"),size:0}]}catch{return[{filename:"options_data_2024-01-15_10-00.csv",timestamp:new Date("2024-01-15T10:00:00"),size:0}]}}async function J(t,n=!1){try{const l=n?`?t=${Date.now()}`:"",c=await fetch(`/data/${t}${l}`,{cache:n?"no-store":"default",headers:{"Cache-Control":n?"no-cache, no-store, must-revalidate":"default",Pragma:n?"no-cache":"default"}});if(!c.ok)throw new Error(`Failed to load ${t}: ${c.status} ${c.statusText}`);const r=await c.text(),a=oe(t);return{filename:t,timestamp:a||new Date,data:r}}catch(l){return{filename:t,timestamp:new Date,data:"",error:l instanceof Error?l.message:"Unknown error"}}}const U=new Map,ze=5*60*1e3;async function Q(t=!1){try{const n=await Be(),l=Date.now();if(t){const u=n.map(x=>J(x.filename,!0)),m=await Promise.all(u);return m.forEach(x=>{x.error||U.set(x.filename,{data:x,timestamp:l})}),m.filter(x=>!x.error)}const c=[],r=[];n.forEach(u=>{const m=U.get(u.filename);m&&l-m.timestamp<ze?c.push(m.data):r.push(u.filename)});let a=[];if(r.length>0){const u=r.map(m=>J(m,!1));a=await Promise.all(u),a.forEach(m=>{m.error||U.set(m.filename,{data:m,timestamp:l})})}const s=[...c,...a],i=s.filter(u=>!u.error),o=s.filter(u=>u.error);return i}catch(n){return console.error("Failed to load data files:",n),[]}}function Ke(){U.clear()}async function qe(t){var l,c,r,a;const n="d3mgi7hr01qmso33ob30d3mgi7hr01qmso33ob3g";try{const s=`https://finnhub.io/api/v1/quote?symbol=${t}&token=${n}`,i=await fetch(s);if(i.ok){const o=await i.json(),u=o==null?void 0:o.c;if(u&&typeof u=="number"&&u>0)return u}}catch{}try{let s=`https://query1.finance.yahoo.com/v8/finance/chart/${t}?interval=1d&range=1d`,i=await fetch(s,{mode:"cors",headers:{Accept:"application/json"}});if(!i.ok||i.status===0){const m=`https://api.allorigins.win/raw?url=${encodeURIComponent(s)}`;i=await fetch(m)}if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const o=await i.json(),u=(a=(r=(c=(l=o==null?void 0:o.chart)==null?void 0:l.result)==null?void 0:c[0])==null?void 0:r.meta)==null?void 0:a.regularMarketPrice;return u&&typeof u=="number"?u:null}catch{return null}}const Y=new Map,We=9e5;async function ee(t){const n=Y.get(t),l=Date.now();if(n&&l-n.timestamp<We)return{price:n.price,source:"api",cached:!0};const c=await qe(t);return c!==null?(Y.set(t,{price:c,timestamp:l}),{price:c,source:"api",cached:!1}):{price:null,source:"none",cached:!1}}function Ye(){Y.clear()}const Xe=()=>{var I;const[t,n]=g.useState(null),[l,c]=g.useState(null),[r,a]=g.useState([]),[s,i]=g.useState(null),[o,u]=g.useState(!0),[m,p]=g.useState(null),[x,v]=g.useState(null),[y,b]=g.useState("none"),[f,h]=g.useState(!1),[S,D]=g.useState("");g.useEffect(()=>{(async($=!1)=>{try{u(!0),p(null);const k=await Q($);if(k.length===0)throw new Error("No data files found in the data directory");const{mergedData:P,info:M}=G(k.map(L=>({filename:L.filename,data:L.data,timestamp:L.timestamp})));a(P),i(M),u(!1)}catch(k){console.error("Error loading data files:",k),p(k instanceof Error?k.message:"Failed to load data"),u(!1)}})(!1)},[]);const F=g.useMemo(()=>Pe(r),[r]),O=g.useMemo(()=>{if(!S.trim())return F;const N=S.toLowerCase();return F.filter($=>$.ticker.toLowerCase().includes(N))},[F,S]),d=g.useMemo(()=>t?Ce(r,t):[],[r,t]),j=g.useMemo(()=>t?De(r,t,l||void 0):[],[r,t,l]),w=g.useMemo(()=>t?r.filter(N=>{const $=N.ticker===t,k=!l||N.expiry===l;return $&&k}):[],[r,t,l]),V=g.useMemo(()=>t?Me(r,t,l||void 0):null,[r,t,l]),T=g.useMemo(()=>t?r.filter(N=>N.ticker===t&&(!l||N.expiry===l)):[],[r,t,l]),A=g.useCallback(N=>{n(N),c(null)},[]),C=g.useCallback(()=>{n(null),c(null)},[]),R=g.useCallback(N=>{c(N===l?null:N)},[l]),_=g.useCallback(async()=>{try{console.log("🔄 Performing hard refresh..."),Se(),Ye(),Ke();try{localStorage.clear(),sessionStorage.clear()}catch(P){console.warn("Could not clear storage:",P)}console.log("✓ All caches cleared"),console.log("🔄 Reloading data with cache bypass..."),u(!0),p(null);const N=await Q(!0);if(N.length===0)throw new Error("No data files found in the data directory");const{mergedData:$,info:k}=G(N.map(P=>({filename:P.filename,data:P.data,timestamp:P.timestamp})));if(a($),i(k),v(null),b("none"),h(!1),t){const{price:P,source:M,cached:L}=await ee(t);v(P),b(M),h(L)}u(!1),console.log("✓ Data reloaded successfully:",{files:k.totalFiles,records:k.totalRecords,latestData:k.dateRange.latest})}catch(N){console.error("Error during hard refresh:",N),p(N instanceof Error?N.message:"Failed to refresh data"),u(!1)}},[t]);return g.useEffect(()=>{if(!t){v(null),b("none"),h(!1);return}(async()=>{const $=await ee(t);v($.price),b($.source),h($.cached)})()},[t]),o?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading options data from multiple files..."})]}):m?e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error Loading Data"}),e.jsx("p",{children:m}),e.jsx("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"options-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"Option Analysis Dashboard"}),s&&e.jsxs("div",{className:"header-stats",children:[e.jsxs("span",{className:"header-stat",children:[s.totalFiles," files"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsxs("span",{className:"header-stat",children:[s.totalRecords.toLocaleString()," records"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsx("span",{className:"header-stat",children:((I=s.dateRange.latest)==null?void 0:I.toLocaleString())||"Unknown"})]})]}),!t&&e.jsxs("div",{className:"search-container-header",children:[e.jsx(fe,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search tickers...",value:S,onChange:N=>D(N.target.value)}),S&&e.jsx("button",{className:"clear-search",onClick:()=>D(""),title:"Clear search",children:"×"})]}),e.jsxs("button",{className:"refresh-button-compact",onClick:_,title:"Hard Refresh - Clears all caches and reloads data from files",children:[e.jsx(ve,{className:"refresh-icon"}),"Hard Refresh"]})]}),t?e.jsxs("div",{className:"ticker-detail-view",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("button",{className:"back-button",onClick:C,children:[e.jsx(ge,{className:"back-icon"}),"Back to Ticker List"]}),e.jsxs("h2",{children:[t," Options Analysis"]}),x&&y==="api"?e.jsxs("span",{className:"current-price-badge",children:[e.jsx("span",{className:"price-indicator"}),"Current Price: $",x.toFixed(2),e.jsxs("span",{className:"price-status",children:["(",f?"Cached":"Live",")"]})]}):e.jsx("span",{className:"price-unavailable",children:"Price unavailable"})]}),e.jsxs("div",{className:"expiry-filter",children:[e.jsxs("div",{className:"filter-header",children:[e.jsx(se,{className:"filter-icon"}),e.jsx("span",{children:"Filter by Expiry Date:"})]}),e.jsxs("div",{className:"expiry-buttons",children:[e.jsx("button",{className:`expiry-button ${l?"":"active"}`,onClick:()=>c(null),children:"All Expiries"}),d.map(N=>e.jsx("button",{className:`expiry-button ${l===N?"active":""}`,onClick:()=>R(N),children:new Date(N).toLocaleDateString()},N))]})]}),e.jsxs("div",{className:"charts-section",children:[e.jsx("div",{className:"chart-column",children:e.jsx(W,{data:j,highestVolumeData:V,ticker:t,expiry:l||void 0,chartType:"callput",currentPrice:x||void 0,trades:w})}),e.jsx("div",{className:"chart-column",children:e.jsx(W,{data:j,highestVolumeData:V,ticker:t,expiry:l||void 0,chartType:"total",currentPrice:x||void 0,trades:w})})]}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Total Volume"}),e.jsx("p",{children:j.reduce((N,$)=>N+$.totalVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Call Volume"}),e.jsx("p",{children:j.reduce((N,$)=>N+$.callVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Put Volume"}),e.jsx("p",{children:j.reduce((N,$)=>N+$.putVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Open Interest"}),e.jsx("p",{children:j.reduce((N,$)=>N+$.openInterest,0).toLocaleString()})]})]}),e.jsxs("div",{className:"heatmap-trades-section",children:[e.jsx("div",{className:"heatmap-column",children:e.jsx(He,{trades:T,currentPrice:x||void 0})}),e.jsx("div",{className:"trades-column",children:e.jsxs("div",{className:"trade-list-section",children:[e.jsxs("h3",{children:["Trade History for ",t]}),e.jsxs("p",{children:["Found ",T.length," trades"]}),e.jsx(ne,{trades:T,ticker:t,expiry:l||void 0})]})})]})]}):e.jsx(le,{tickers:O,onTickerSelect:A,allData:r})]})};class Ze extends g.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,l){console.error("ErrorBoundary caught an error:",n,l),this.setState({error:n,errorInfo:l})}render(){var n,l;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"An error occurred while rendering this component."}),e.jsxs("details",{className:"error-details",children:[e.jsx("summary",{children:"Error Details"}),e.jsx("pre",{children:(n=this.state.error)==null?void 0:n.toString()}),e.jsx("pre",{children:(l=this.state.errorInfo)==null?void 0:l.componentStack})]}),e.jsx("button",{className:"retry-button",onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),children:"Try Again"})]})}):this.props.children}}function Ge(){return e.jsx("div",{className:"app",children:e.jsx("main",{children:e.jsx(Ze,{children:e.jsx(Xe,{})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{const t="/optionAnalysis/";navigator.serviceWorker.register(`${t}sw.js`).then(n=>{console.log("SW registered: ",n)}).catch(n=>{console.log("SW registration failed: ",n)})});z.createRoot(document.getElementById("root")).render(e.jsx(me.StrictMode,{children:e.jsx(Ge,{})}));
//# sourceMappingURL=index-daa0871a.js.map
