import{r as p,a as Pe,R as Me}from"./vendor-b1791c80-1760994784977.js";import{A as re,T as he,a as pe,C as le,b as xe,Z as Fe,c as fe,S as ve,R as ge,d as je}from"./utils-406c0c1e-1760994784977.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const t of l.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&c(t)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();var Ne={exports:{}},W={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _e=p,Le=Symbol.for("react.element"),Ae=Symbol.for("react.fragment"),Ee=Object.prototype.hasOwnProperty,Ie=_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qe={key:!0,ref:!0,__self:!0,__source:!0};function ye(a,n,r){var c,o={},l=null,t=null;r!==void 0&&(l=""+r),n.key!==void 0&&(l=""+n.key),n.ref!==void 0&&(t=n.ref);for(c in n)Ee.call(n,c)&&!qe.hasOwnProperty(c)&&(o[c]=n[c]);if(a&&a.defaultProps)for(c in n=a.defaultProps,n)o[c]===void 0&&(o[c]=n[c]);return{$$typeof:Le,type:a,key:l,ref:t,props:o,_owner:Ie.current}}W.Fragment=Ae;W.jsx=ye;W.jsxs=ye;Ne.exports=W;var e=Ne.exports,X={},ne=Pe;X.createRoot=ne.createRoot,X.hydrateRoot=ne.hydrateRoot;const Z=new Map,J=new Map;function Re(){Z.clear(),ee.clear()}function Oe(){J.clear(),te.clear()}function U(a){try{if(!a)return null;const n=a.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(!n)return null;const[,,r,c,o,l,t,s]=n,m={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}[r.toLowerCase()];if(m===void 0)return null;let d=parseInt(l);return s.toUpperCase()==="PM"&&d!==12?d+=12:s.toUpperCase()==="AM"&&d===12&&(d=0),new Date(parseInt(o),m,parseInt(c),d,parseInt(t))}catch{return null}}function He(a){try{if(!a)return!1;const n=a.split("/");if(n.length!==3)return!1;const r=parseInt(n[0])-1,c=parseInt(n[1]),o=parseInt(n[2]);return new Date(o,r,c,23,59,59)<new Date}catch{return!1}}function Ue(a,n){var i,m;const r=`${n||"unknown"}_${a.length}_${a.slice(0,100)}`,c=Z.get(r);if(c)return c;const o=a.split(`
`),l=[],t=Math.max(1e3,o.length*.8);l.length=t;let s=0;for(let d=1;d<o.length;d++){const u=o[d].trim();if(!u)continue;const f=ke(u);if(!(f.length<19))try{const v=f[5]||"",g=f[6]||"",N=f[7]||"",y=parseFloat(f[8])||0,x=f[9]||"",k=f[10],D=parseInt(((i=f[12])==null?void 0:i.replace(/,/g,""))||"0"),M=f[13]||"$0",R=parseInt(((m=f[14])==null?void 0:m.replace(/,/g,""))||"0"),h=0,b=["Ask","Above","Bid","Below","Sweep","Block","Trade","Volume","Premium"],$=N&&N.length>=1&&N.length<=10&&!b.includes(N)&&!N.match(/^\d+$/)&&!N.includes(" ")&&/^[A-Z0-9]+$/.test(N),C=He(x);$&&y>0&&x&&k&&D>0&&!C&&(l[s++]={ticker:N,strike:y,expiry:x,optionType:k,volume:D,premium:M,openInterest:R,bidAskSpread:h,timestamp:v,sweepType:g,sourceFile:n})}catch{}}return l.length=s,Z.set(r,l),l}const ee=new Map,te=new Map;function Be(a){const n=`${a.length}_${a.slice(0,3).map(l=>`${l.ticker}_${l.timestamp}`).join("_")}`,r=ee.get(n);if(r)return r;const c=new Map;for(let l=0;l<a.length;l++){const t=a[l];if(!c.has(t.ticker)){const m=U(t.timestamp);c.set(t.ticker,{ticker:t.ticker,totalVolume:0,callVolume:0,putVolume:0,totalPremium:0,uniqueExpiries:[],expirySet:new Set,lastActivity:t.timestamp,lastActivityDate:m,lastTrade:{strike:t.strike,optionType:t.optionType,volume:t.volume,premium:t.premium,sweepType:t.sweepType,timestamp:t.timestamp}})}const s=c.get(t.ticker);s.totalVolume+=t.volume,s.totalPremium+=We(t.premium),t.optionType==="Call"?s.callVolume+=t.volume:s.putVolume+=t.volume,s.expirySet.has(t.expiry)||(s.expirySet.add(t.expiry),s.uniqueExpiries.push(t.expiry));const i=U(t.timestamp);i&&s.lastActivityDate&&i>s.lastActivityDate?(s.lastActivity=t.timestamp,s.lastActivityDate=i,s.lastTrade={strike:t.strike,optionType:t.optionType,volume:t.volume,premium:t.premium,sweepType:t.sweepType,timestamp:t.timestamp}):i&&!s.lastActivityDate&&(s.lastActivity=t.timestamp,s.lastActivityDate=i,s.lastTrade||(s.lastTrade={strike:t.strike,optionType:t.optionType,volume:t.volume,premium:t.premium,sweepType:t.sweepType,timestamp:t.timestamp}))}const o=Array.from(c.values()).map(({expirySet:l,...t})=>t).sort((l,t)=>{const s=l.lastActivityDate,i=t.lastActivityDate;return s&&i&&s.getTime()!==i.getTime()?i.getTime()-s.getTime():t.totalVolume-l.totalVolume});return ee.set(n,o),o}function Ke(a,n,r){const c=a.filter(l=>l.ticker===n&&(!r||l.expiry===r)),o=new Map;return c.forEach(l=>{o.has(l.strike)||o.set(l.strike,{strike:l.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const t=o.get(l.strike);t.totalVolume+=l.volume,t.openInterest+=l.openInterest,l.optionType==="Call"?t.callVolume+=l.volume:t.putVolume+=l.volume}),Array.from(o.values()).sort((l,t)=>l.strike-t.strike)}function ze(a,n){const r=new Set;return a.forEach(c=>{c.ticker===n&&r.add(c.expiry)}),Array.from(r).sort((c,o)=>new Date(c).getTime()-new Date(o).getTime())}function Qe(a,n,r){const c=a.filter(s=>s.ticker===n&&(!r||s.expiry===r));if(!c.length)return null;const o=new Map;c.forEach(s=>{o.has(s.strike)||o.set(s.strike,{strike:s.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const i=o.get(s.strike);i.totalVolume+=s.volume,i.openInterest+=s.openInterest,s.optionType==="Call"?i.callVolume+=s.volume:i.putVolume+=s.volume});const t=Array.from(o.values()).reduce((s,i)=>i.totalVolume>s.totalVolume?i:s);return{strike:t.strike,totalVolume:t.totalVolume,callVolume:t.callVolume,putVolume:t.putVolume,openInterest:t.openInterest}}function We(a){const n=a.replace(/[$,K]/g,""),r=parseFloat(n);return a.includes("K")?r*1e3:a.includes("M")?r*1e6:r}function q(a){return a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(1)}K`:a.toString()}function Ye(a){return a>=1e6?`$${(a/1e6).toFixed(1)}M`:a>=1e3?`$${(a/1e3).toFixed(1)}K`:`$${a.toFixed(0)}`}function oe(a){const n=[],r=[];let c=null,o=null;const l=new Map;a.sort((i,m)=>m.timestamp.getTime()-i.timestamp.getTime()).forEach(i=>{const m=Ue(i.data,i.filename);m.forEach(d=>{const u=`${d.ticker}_${d.strike}_${d.expiry}_${d.optionType}_${d.volume}_${d.premium}_${d.timestamp}`;l.has(u)||l.set(u,d)}),r.push({filename:i.filename,recordCount:m.length,timestamp:i.timestamp}),(!c||i.timestamp<c)&&(c=i.timestamp),(!o||i.timestamp>o)&&(o=i.timestamp)}),n.push(...l.values());const s={totalFiles:a.length,totalRecords:n.length,dateRange:{earliest:c,latest:o},files:r};return{mergedData:n,info:s}}function Ge(a,n,r){if(a.length===0)return null;const c=a.reduce((y,x)=>y+x.volume,0),o=a.reduce((y,x)=>{const k=parseFloat(x.premium.replace(/[$,]/g,""))||0;return y+k},0),l=a.filter(y=>y.optionType==="Call").reduce((y,x)=>y+x.volume,0),t=a.filter(y=>y.optionType==="Put").reduce((y,x)=>y+x.volume,0),s=t>0?l/t:l,i=a.filter(y=>y.sweepType&&y.sweepType.toLowerCase().includes("sweep")).length,m=c/a.length,d=[...new Set(r.map(y=>y.ticker))],u=r.reduce((y,x)=>y+x.volume,0)/d.length,f=r.reduce((y,x)=>{const k=parseFloat(x.premium.replace(/[$,]/g,""))||0;return y+k},0)/d.length,v=[];let g="low",N="volume";return c>u*3?(v.push(`Volume ${(c/u*100).toFixed(0)}% above average`),g="high",N="volume"):c>u*2&&(v.push(`Volume ${(c/u*100).toFixed(0)}% above average`),g="medium"),o>f*3?(v.push(`Premium ${(o/f*100).toFixed(0)}% above average`),g="high",N!=="volume"?N="premium":N="multiple"):o>f*2&&(v.push(`Premium ${(o/f*100).toFixed(0)}% above average`),g!=="high"&&(g="medium")),i>5?(v.push(`${i} sweeps detected`),g="high",N=N==="volume"||N==="premium"?"multiple":"sweep"):i>2&&(v.push(`${i} sweeps detected`),g==="low"&&(g="medium")),s>5?(v.push(`Heavy call bias (${s.toFixed(1)}:1)`),g==="low"&&(g="medium")):s<.2&&(v.push(`Heavy put bias (1:${(1/s).toFixed(1)})`),g==="low"&&(g="medium")),m>5e3&&(v.push(`Large avg trade size: ${q(Math.round(m))}`),g==="low"&&(g="medium")),v.length>0?{ticker:n,alertType:N,severity:g,reason:v.join(" â€¢ "),metrics:{totalVolume:c,totalPremium:o,callPutRatio:s,sweepCount:i,avgTradeSize:m}}:null}function Xe(a,n=5){if(a.length===0)return[];const r=new Map;return a.forEach(o=>{const l=r.get(o.strike)||{volume:0,openInterest:0,premium:0,callVolume:0,putVolume:0},t=parseFloat(o.premium.replace(/[$,]/g,""))||0;l.volume+=o.volume,l.openInterest+=o.openInterest,l.premium+=t,o.optionType==="Call"?l.callVolume+=o.volume:l.putVolume+=o.volume,r.set(o.strike,l)}),Array.from(r.entries()).map(([o,l])=>{const t=Math.max(...Array.from(r.values()).map(N=>N.volume)),s=Math.max(...Array.from(r.values()).map(N=>N.openInterest)),i=Math.max(...Array.from(r.values()).map(N=>N.premium)),m=t>0?l.volume/t:0,d=s>0?l.openInterest/s:0,u=i>0?l.premium/i:0,f=m*.4+d*.4+u*.2;let v="low";f>.7?v="high":f>.4&&(v="medium");let g="both";return l.callVolume>l.putVolume*2?g="call":l.putVolume>l.callVolume*2&&(g="put"),{strike:o,volume:l.volume,openInterest:l.openInterest,premium:l.premium,significance:v,type:g,combinedScore:f}}).sort((o,l)=>l.combinedScore-o.combinedScore).slice(0,n).map(({combinedScore:o,...l})=>l)}function Ze(a,n){if(a.length===0)return[];const r=new Map;return a.forEach(o=>{const l=r.get(o.strike)||{callVolume:0,putVolume:0,callOI:0,putOI:0};o.optionType==="Call"?(l.callVolume+=o.volume,l.callOI+=o.openInterest):(l.putVolume+=o.volume,l.putOI+=o.openInterest),r.set(o.strike,l)}),Array.from(r.entries()).map(([o,l])=>{let t=1;if(n){const u=Math.abs(o-n)/n;u<.05?t=2:u<.1?t=1.5:u>.2&&(t=.5)}const s=(l.putOI-l.callOI)*t,i=Math.abs(s),m=Math.max(...Array.from(r.values()).map(u=>Math.abs(u.putOI-u.callOI)));let d="low";if(m>0){const u=i/m;u>.7?d="extreme":u>.4?d="high":u>.2&&(d="moderate")}return{strike:o,netGammaExposure:s,callVolume:l.callVolume,putVolume:l.putVolume,callOI:l.callOI,putOI:l.putOI,level:d}}).sort((o,l)=>o.strike-l.strike)}function Je(a){if(a.length===0)return null;const n=[...new Set(a.map(l=>l.strike))].sort((l,t)=>l-t),r=new Map;n.forEach(l=>{let t=0;a.forEach(s=>{const{strike:i,optionType:m,openInterest:d}=s;m==="Call"?l<i&&(t+=d*(i-l)):l>i&&(t+=d*(l-i))}),r.set(l,t)});let c=n[0],o=r.get(n[0])||0;return r.forEach((l,t)=>{l>o&&(o=l,c=t)}),c}function et(a,n,r){const c=n.filter(o=>o.ticker===a);return{ticker:a,unusualActivity:Ge(c,a,n),keyPriceLevels:Xe(c,5),gammaExposure:Ze(c,r),maxPainStrike:Je(c),currentPrice:r}}function tt(a,n){var t,s,i,m,d;const r=`${n}-${a.length}`,c=J.get(r);if(c)return c;const o=a.split(`
`),l=[];for(let u=1;u<o.length;u++){const f=o[u].trim();if(f)try{const v=ke(f);if(v.length<14)continue;const g=(t=v[6])==null?void 0:t.replace(/"/g,"").trim(),N=(s=v[7])==null?void 0:s.replace(/"/g,"").replace(/,/g,"").trim(),y=(i=v[8])==null?void 0:i.replace(/"/g,"").trim(),x=(m=v[9])==null?void 0:m.replace(/"/g,"").trim(),k=(d=v[5])==null?void 0:d.replace(/"/g,"").trim();if(!g||g===""||g==="[")continue;const D=parseInt(N);if(isNaN(D)||D<=0)continue;const M=parseFloat(y);if(isNaN(M)||M<=0)continue;const R=U(k);if(!R)continue;l.push({ticker:g,quantity:D,price:M,totalValue:x,timestamp:R.toISOString(),sourceFile:n})}catch{continue}}return J.set(r,l),l}function ke(a){const n=[];let r="",c=!1;for(let o=0;o<a.length;o++){const l=a[o];l==='"'?c=!c:l===","&&!c?(n.push(r),r=""):r+=l}return n.push(r),n}function ce(a){const n=[];let r=0,c=null,o=null;const l=a.map(t=>{const s=tt(t.data,t.filename);return n.push(...s),r+=s.length,s.forEach(i=>{const m=new Date(i.timestamp);(!c||m<c)&&(c=m),(!o||m>o)&&(o=m)}),{filename:t.filename,recordCount:s.length,timestamp:t.timestamp}});return n.sort((t,s)=>new Date(s.timestamp).getTime()-new Date(t.timestamp).getTime()),{mergedData:n,info:{totalFiles:a.length,totalRecords:r,dateRange:{earliest:c,latest:o},files:l}}}function st(a){const n=`${a.length}_${a.slice(0,3).map(l=>`${l.ticker}_${l.timestamp}`).join("_")}`,r=te.get(n);if(r)return r;const c=new Map;a.forEach(l=>{const t=c.get(l.ticker)||{ticker:l.ticker,totalQuantity:0,totalValue:0,tradeCount:0,lastActivityDate:null,largestTrade:null};t.totalQuantity+=l.quantity,t.totalValue+=l.quantity*l.price,t.tradeCount+=1;const s=new Date(l.timestamp);(!t.lastActivityDate||s>t.lastActivityDate)&&(t.lastActivityDate=s),(!t.largestTrade||l.quantity>t.largestTrade.quantity)&&(t.largestTrade={quantity:l.quantity,price:l.price,totalValue:l.totalValue,timestamp:l.timestamp}),c.set(l.ticker,t)});const o=Array.from(c.values()).map(l=>({...l,averagePrice:l.totalValue/l.totalQuantity,lastActivity:l.lastActivityDate?l.lastActivityDate.toLocaleString():"Unknown"})).sort((l,t)=>t.totalValue-l.totalValue);return te.set(n,o),o}const at=(a,n)=>{try{let r;return n?r=n:r=new Date(a),isNaN(r.getTime())?"":r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" "+r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}},be=p.memo(({tickers:a,onTickerSelect:n,allData:r})=>{const[c,o]=p.useState("recent"),l=p.useMemo(()=>{const t=[...a];switch(c){case"recent":return t.sort((s,i)=>s.lastActivityDate&&i.lastActivityDate?i.lastActivityDate.getTime()-s.lastActivityDate.getTime():0);case"oldest":return t.sort((s,i)=>s.lastActivityDate&&i.lastActivityDate?s.lastActivityDate.getTime()-i.lastActivityDate.getTime():0);case"volume-high":return t.sort((s,i)=>i.totalVolume-s.totalVolume);case"volume-low":return t.sort((s,i)=>s.totalVolume-i.totalVolume);case"calls-high":return t.sort((s,i)=>i.callVolume-s.callVolume);case"puts-high":return t.sort((s,i)=>i.putVolume-s.putVolume);case"premium-high":return t.sort((s,i)=>i.totalPremium-s.totalPremium);case"premium-low":return t.sort((s,i)=>s.totalPremium-i.totalPremium);default:return t}},[a,c]);return e.jsxs("div",{className:"ticker-list",children:[e.jsxs("div",{className:"ticker-list-header",children:[e.jsx("div",{className:"header-content",children:e.jsx("h2",{children:"Options Volume Dashboard"})}),e.jsxs("div",{className:"sort-controls",children:[e.jsx(re,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:t=>o(t.target.value),children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"volume-high",children:"Volume (High to Low)"}),e.jsx("option",{value:"volume-low",children:"Volume (Low to High)"}),e.jsx("option",{value:"calls-high",children:"Calls (High to Low)"}),e.jsx("option",{value:"puts-high",children:"Puts (High to Low)"}),e.jsx("option",{value:"premium-high",children:"Premium (High to Low)"}),e.jsx("option",{value:"premium-low",children:"Premium (Low to High)"})]})]})]}),e.jsx("div",{className:"ticker-grid",children:l.map(t=>{const s=t.callVolume>t.putVolume,i=t.putVolume>t.callVolume,m=s?"call-dominant":i?"put-dominant":"balanced",d=et(t.ticker,r);return e.jsxs("div",{className:`ticker-card ${m}`,onClick:()=>n(t.ticker),children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h3",{className:"ticker-symbol",children:t.ticker}),e.jsxs("div",{className:"ticker-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx(he,{className:"metric-icon call"}),e.jsx("span",{className:"metric-label",children:"Calls"}),e.jsx("span",{className:"metric-value",children:q(t.callVolume)})]}),e.jsxs("div",{className:"metric",children:[e.jsx(pe,{className:"metric-icon put"}),e.jsx("span",{className:"metric-label",children:"Puts"}),e.jsx("span",{className:"metric-value",children:q(t.putVolume)})]})]})]}),e.jsxs("div",{className:"ticker-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Volume:"}),e.jsx("span",{className:"detail-value",children:q(t.totalVolume)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Premium:"}),e.jsx("span",{className:"detail-value",children:Ye(t.totalPremium)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(le,{className:"detail-icon"}),e.jsx("span",{className:"detail-label",children:"Expiries:"}),e.jsx("span",{className:"detail-value",children:t.uniqueExpiries.length})]}),t.lastTrade&&e.jsxs("div",{className:"detail-row last-trade-row",children:[e.jsx("span",{className:"detail-label",children:"Last Trade:"}),e.jsxs("span",{className:"detail-value last-trade",children:[t.lastTrade.optionType," $",t.lastTrade.strike,e.jsx("span",{className:`trade-side ${t.lastTrade.optionType.toLowerCase()}`,children:t.lastTrade.optionType==="Call"?"â†—":"â†˜"}),q(t.lastTrade.volume)]})]})]}),(d.keyPriceLevels.length>0||d.maxPainStrike)&&e.jsxs("div",{className:"ticker-analytics",children:[d.keyPriceLevels.length>0&&e.jsxs("div",{className:"analytics-badge key-levels-badge",children:[e.jsx(xe,{size:12}),e.jsx("span",{className:"badge-label",children:"Key Levels:"}),e.jsx("span",{className:"badge-strikes",children:d.keyPriceLevels.slice(0,3).map((u,f)=>e.jsxs("span",{className:`level-strike level-${u.significance}`,title:`${u.type==="call"?"Call":u.type==="put"?"Put":"Call/Put"} - Vol: ${q(u.volume)}, OI: ${q(u.openInterest)}`,children:[f>0&&", ","$",u.strike]},u.strike))})]}),d.maxPainStrike&&e.jsxs("div",{className:"analytics-badge max-pain-badge",children:[e.jsx(Fe,{size:12}),e.jsx("span",{className:"badge-label",children:"Max Pain:"}),e.jsxs("span",{className:"badge-value",children:["$",d.maxPainStrike]})]})]}),e.jsx("div",{className:"ticker-footer",children:e.jsxs("div",{className:"last-activity",children:[e.jsx(fe,{className:"activity-icon"}),e.jsx("span",{children:at(t.lastActivity,t.lastActivityDate)})]})})]},t.ticker)})})]})});be.displayName="TickerList";const se=p.memo(({data:a,highestVolumeData:n,ticker:r,expiry:c,chartType:o,currentPrice:l,trades:t=[]})=>{const[s,i]=p.useState({visible:!1,x:0,y:0,content:null}),m=p.useCallback((h,b)=>b===0?0:Math.min(h/b*46,46),[]),d=p.useCallback((h,b)=>{const $=t.filter(j=>j.strike===h&&(!b||j.optionType===b)),C=$.reduce((j,V)=>j+V.volume,0),P=$.reduce((j,V)=>{const w=V.premium.replace(/[$,]/g,"");return j+(parseFloat(w)||0)},0),T=P>=1e6?(P/1e6).toFixed(2)+"M":P>=1e3?(P/1e3).toFixed(1)+"K":P.toFixed(0),S=P.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),F=[...new Set($.map(j=>j.sweepType))].filter(Boolean),L=$.map(j=>j.volume).sort((j,V)=>V-j),I=[...new Set($.map(j=>j.expiry))].sort(),_=C,A=$.sort((j,V)=>V.volume-j.volume).map(j=>({volume:j.volume,premium:j.premium,timestamp:j.timestamp,expiry:j.expiry}));return{strike:h,type:b,volume:C,trades:$.length,premium:T,premiumFull:S,sweepTypes:F,tradeVolumes:L,expiries:I,size:_,tradeDetails:A}},[t]),u=p.useCallback((h,b,$)=>{const C=h.currentTarget.getBoundingClientRect(),P=d(b,$);i({visible:!0,x:h.clientX,y:C.top-10,content:P})},[d]),f=p.useCallback(()=>{i(h=>({...h,visible:!1}))},[]),v=p.useCallback(h=>{i(b=>({...b,x:h.clientX}))},[]),g=p.useCallback(()=>l||(n==null?void 0:n.strike)||null,[l,n]),N=p.useCallback(h=>{const b=g();return b!==null&&Math.abs(h-b)<.01},[g]),x=p.useCallback(()=>a.sort((h,b)=>h.strike-b.strike),[a])(),k=p.useMemo(()=>{if(!x.length)return{maxVolume:0,minStrike:0,maxStrike:0,maxTotalVolume:0,totalVolumeSum:0};let h=0,b=0,$=1/0,C=-1/0,P=0;for(let T=0;T<x.length;T++){const S=x[T];h=Math.max(h,Math.max(S.callVolume,S.putVolume)),b=Math.max(b,S.totalVolume),$=Math.min($,S.strike),C=Math.max(C,S.strike),P+=S.totalVolume}return{maxVolume:h,minStrike:$===1/0?0:$,maxStrike:C===-1/0?0:C,maxTotalVolume:b,totalVolumeSum:P}},[x]),D=p.useCallback(h=>{if(!x.length||k.maxStrike===k.minStrike)return 50;const b=x.findIndex(P=>P.strike===h);if(b===-1)return 50;const $=x.length,C=100/($+1);if(o==="callput"){const P=$-1-b;return C*(P+1)}else return C*(b+1)},[x,k,o]),M=p.useCallback(h=>{if(!x.length||k.maxStrike===k.minStrike)return 50;const b=k.minStrike,$=k.maxStrike,C=Math.max(b,Math.min($,h));let P=b,T=$,S=0,F=x.length-1;for(let w=0;w<x.length-1;w++){const E=x[w].strike,O=x[w+1].strike;if(E<=C&&C<=O){P=E,T=O,S=w,F=w+1;break}}const L=x.length,I=100/(L+1);let _,A;if(o==="callput"){const w=L-1-S,E=L-1-F;_=I*(w+1),A=I*(E+1)}else _=I*(S+1),A=I*(F+1);if(T===P)return _;const j=(C-P)/(T-P);return _+(A-_)*j},[x,k,o]),R=p.useCallback(()=>Math.max(400,x.length*18+40),[x.length]);return a.length?o==="callput"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"volume-profile-chart modern-mirrored-chart",children:[e.jsxs("div",{className:"chart-header modern-header",children:[e.jsxs("h3",{children:[r," Call/Put Volume"]}),e.jsxs("div",{className:"header-info",children:[g()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",g()]})]}),c&&e.jsx("span",{className:"expiry-date",children:c})]})]}),e.jsx("div",{className:"chart-container modern-container",children:e.jsxs("div",{className:"chart-area modern-chart-area",style:{height:`${R()}px`},children:[e.jsx("div",{className:"center-line"}),e.jsx("div",{className:"strike-axis modern-strike-axis",children:x.map(h=>e.jsx("div",{className:"strike-line modern-strike-line",style:{top:`${D(h.strike)}%`},children:e.jsx("span",{className:`strike-label modern-strike-label ${N(h.strike)?"current-price-label":""}`,children:h.strike})},h.strike))}),e.jsx("div",{className:"volume-bars modern-volume-bars",children:x.map(h=>e.jsxs("div",{className:"strike-row modern-strike-row",style:{top:`${D(h.strike)}%`},children:[e.jsx("div",{className:"volume-bar call-bar modern-call-bar",style:{width:`${m(h.callVolume,k.maxVolume)}%`,right:"52%"},onMouseEnter:b=>u(b,h.strike,"Call"),onMouseLeave:f,onMouseMove:v,children:h.callVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:q(h.callVolume)})}),e.jsx("div",{className:"volume-bar put-bar modern-put-bar",style:{width:`${m(h.putVolume,k.maxVolume)}%`,left:"52%"},onMouseEnter:b=>u(b,h.strike,"Put"),onMouseLeave:f,onMouseMove:v,children:h.putVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:q(h.putVolume)})})]},h.strike))}),g()&&e.jsx("div",{className:"current-price-line",style:{top:`${M(g())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"105%",top:"50%",transform:"translateY(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",g().toFixed(2)]})})]})})]}),s.visible&&s.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${s.x+15}px`,top:`${s.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>i(h=>({...h,visible:!0})),onMouseLeave:f,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",s.content.strike]}),s.content.type&&e.jsx("span",{className:`tooltip-type ${s.content.type.toLowerCase()}`,children:s.content.type})]}),e.jsx("div",{className:"tooltip-body",children:s.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:s.content.tradeDetails.map((h,b)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:h.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:h.premium})]}),h.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(h.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!h.timestamp)return"N/A";const $=new Date(h.timestamp);return isNaN($.getTime())?h.timestamp:`${$.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${$.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return h.timestamp||"N/A"}})()})]})]},b))})]})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"volume-profile-chart total-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[r," Total Volume"]}),e.jsxs("div",{className:"header-info",children:[g()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",g()]})]}),c&&e.jsx("span",{className:"expiry-date",children:c})]})]}),e.jsxs("div",{className:"chart-container vertical",children:[e.jsxs("div",{className:"chart-area vertical",style:{height:`${R()}px`},children:[e.jsx("div",{className:"volume-bars vertical",children:x.map(h=>e.jsx("div",{className:"strike-column",style:{left:`${D(h.strike)}%`},children:e.jsx("div",{className:"volume-bar total-bar vertical",style:{height:`${m(h.totalVolume,k.maxTotalVolume)}%`},onMouseEnter:b=>u(b,h.strike),onMouseLeave:f,onMouseMove:v,children:h.totalVolume>0&&e.jsxs("span",{className:"volume-text volume-text-top",children:[q(h.totalVolume),e.jsxs("span",{className:"volume-percentage",children:["(",k.totalVolumeSum>0?(h.totalVolume/k.totalVolumeSum*100).toFixed(1):"0.0","%)"]})]})})},h.strike))}),g()&&e.jsx("div",{className:"current-price-line vertical",style:{left:`${M(g())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"50%",top:"-30px",transform:"translateX(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",g().toFixed(2)]})})]}),e.jsx("div",{className:"x-axis-labels",children:x.map(h=>e.jsx("div",{className:"x-axis-label",style:{left:`${D(h.strike)}%`},children:e.jsx("span",{className:`strike-label ${N(h.strike)?"current-price-label":""}`,children:h.strike})},h.strike))})]}),s.visible&&s.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${s.x+15}px`,top:`${s.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>i(h=>({...h,visible:!0})),onMouseLeave:f,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",s.content.strike]}),s.content.type&&e.jsx("span",{className:`tooltip-type ${s.content.type.toLowerCase()}`,children:s.content.type})]}),e.jsx("div",{className:"tooltip-body",children:s.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:s.content.tradeDetails.map((h,b)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:h.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:h.premium})]}),h.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(h.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!h.timestamp)return"N/A";const $=new Date(h.timestamp);return isNaN($.getTime())?h.timestamp:`${$.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${$.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return h.timestamp||"N/A"}})()})]})]},b))})]})})]})]})}):e.jsxs("div",{className:"volume-profile-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[r," ",o==="callput"?"Call/Put Volume":"Total Volume"]}),c&&e.jsx("span",{className:"expiry-date",children:c})]}),e.jsx("div",{className:"no-data",children:e.jsxs("p",{children:["No volume data available for this ticker",c?" and expiry date":""]})})]})});se.displayName="VolumeProfileChart";const we=p.memo(({trade:a})=>{const n=l=>{try{const t=l.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(t){const[,,i,m,,d,u,f]=t;let v=parseInt(d);f.toUpperCase()==="PM"&&v!==12?v+=12:f.toUpperCase()==="AM"&&v===12&&(v=0);const y=`${{january:"01",february:"02",march:"03",april:"04",may:"05",june:"06",july:"07",august:"08",september:"09",october:"10",november:"11",december:"12"}[i.toLowerCase()]||"01"}/${m.padStart(2,"0")}`,x=`${v.toString().padStart(2,"0")}:${u}`;return`${y} ${x}`}const s=new Date(l);return isNaN(s.getTime())?"Unknown":s.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit"})+" "+s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return"Unknown"}},o=(l=>{const t=l.replace(/[$,]/g,""),s=parseFloat(t);return l.includes("M")?s*1e6:l.includes("K")?s*1e3:s})(a.premium)>=1e6;return e.jsxs("div",{className:"trade-row-horizontal",style:{backgroundColor:a.optionType==="Call"?o?"rgba(0, 80, 0, 0.7)":"rgba(0, 100, 0, 0.5)":o?"rgba(100, 0, 0, 0.7)":"rgba(139, 0, 0, 0.5)"},children:[e.jsx("div",{className:"trade-cell-h symbol",children:a.ticker}),e.jsx("div",{className:"trade-cell-h strike",children:a.strike}),e.jsx("div",{className:"trade-cell-h expiry",children:new Date(a.expiry).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})}),e.jsx("div",{className:"trade-cell-h type",children:a.optionType}),e.jsx("div",{className:"trade-cell-h side",children:a.sweepType}),e.jsx("div",{className:"trade-cell-h size",children:q(a.volume)}),e.jsx("div",{className:"trade-cell-h premium",children:a.premium}),e.jsx("div",{className:"trade-cell-h volume",children:q(a.volume)}),e.jsx("div",{className:"trade-cell-h oi",children:q(a.openInterest)}),e.jsx("div",{className:"trade-cell-h exec-time",children:n(a.timestamp)})]})});we.displayName="TradeRow";const $e=p.memo(({trades:a,ticker:n,expiry:r})=>{const[c,o]=p.useState("trade-date"),l=p.useMemo(()=>[...a].sort((i,m)=>{switch(c){case"trade-date":{const d=U(i.timestamp),u=U(m.timestamp);return!d||!u?0:u.getTime()-d.getTime()}case"expiry-date":{const d=new Date(i.expiry),u=new Date(m.expiry);return d.getTime()-u.getTime()}case"size":return m.volume-i.volume;default:return 0}}),[a,c]),t=p.useMemo(()=>r?l.filter(i=>i.expiry===r):l,[l,r]);if(t.length===0)return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("h3",{children:[n," Trade History"]}),r&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(r).toLocaleDateString()]})]}),e.jsx("div",{className:"no-trades",children:e.jsxs("p",{children:["No trades found for ",n,r?` on ${new Date(r).toLocaleDateString()}`:""]})})]});const s=p.useCallback((i,m)=>`${i.ticker}-${i.strike}-${i.expiry}-${i.timestamp}-${m}`,[]);return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsxs("h3",{children:[n," Trade History"]}),r&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(r).toLocaleDateString()]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"sort-controls",children:[e.jsx(re,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:i=>o(i.target.value),children:[e.jsx("option",{value:"trade-date",children:"Sort by Trade Date (Recent First)"}),e.jsx("option",{value:"expiry-date",children:"Sort by Expiry Date (Earliest First)"}),e.jsx("option",{value:"size",children:"Sort by Size (Largest First)"})]})]}),e.jsxs("div",{className:"trade-count",children:[t.length," trades"]})]})]}),e.jsx("div",{className:"trade-list-content",children:e.jsxs("div",{className:"trade-list-table",children:[e.jsxs("div",{className:"trade-table-header",children:[e.jsx("div",{className:"header-cell",children:"Symbol"}),e.jsx("div",{className:"header-cell",children:"Strike"}),e.jsx("div",{className:"header-cell",children:"Expiration"}),e.jsx("div",{className:"header-cell",children:"Call/Put"}),e.jsx("div",{className:"header-cell",children:"Side"}),e.jsx("div",{className:"header-cell",children:"Size"}),e.jsx("div",{className:"header-cell",children:"Premium"}),e.jsx("div",{className:"header-cell",children:"Volume"}),e.jsx("div",{className:"header-cell",children:"OI"}),e.jsx("div",{className:"header-cell",children:"Exec Time"})]}),e.jsx("div",{className:"trade-table-body",children:t.map((i,m)=>e.jsx(we,{trade:i,index:m},s(i,m)))})]})})]})});$e.displayName="TradeList";function rt(a){const n=a.includes("K"),r=a.includes("M"),c=a.replace(/[$,]/g,""),o=parseFloat(c);return r?o*1e6:n?o*1e3:o}const lt=({trades:a,currentPrice:n})=>{const{heatmapData:r,strikes:c,expiries:o,maxAbsValue:l}=p.useMemo(()=>{const u=new Map,f=new Set,v=new Set;a.forEach(x=>{const k=`${x.strike}_${x.expiry}`;f.add(x.strike),v.add(x.expiry),u.has(k)||u.set(k,{value:0,volume:0,callVolume:0,putVolume:0,trades:0});const D=u.get(k),M=rt(x.premium);Math.abs(M)<10&&x.ticker==="TSLA"&&console.log(`Small premium detected: ${x.ticker} ${x.strike} ${x.expiry} ${x.optionType} - Premium: "${x.premium}" -> Parsed: ${M}`),x.optionType==="Call"?(D.value+=M,D.callVolume+=x.volume):(D.value-=M,D.putVolume+=x.volume),D.volume+=x.volume,D.trades+=1});const g=Array.from(f).sort((x,k)=>k-x),N=Array.from(v).sort((x,k)=>{const D=new Date(x),M=new Date(k);return D.getTime()-M.getTime()});let y=0;return u.forEach(x=>{const k=Math.abs(x.value);k>y&&(y=k)}),{heatmapData:u,strikes:g,expiries:N,maxAbsValue:y}},[a]),t=(u,f)=>{if(f===0)return"rgba(255, 255, 255, 0.03)";const g=.2+Math.abs(u)/l*.6;return u>0?`rgba(76, 175, 80, ${g})`:`rgba(244, 67, 54, ${g})`},s=u=>{const f=Math.abs(u);return f>=1e6?`${u>=0?"":"-"}$${(f/1e6).toFixed(1)}M`:f>=1e3?`${u>=0?"":"-"}$${(f/1e3).toFixed(1)}K`:f>=1?`${u>=0?"":"-"}$${f.toFixed(0)}`:`${u>=0?"":"-"}$${f.toFixed(2)}`},i=u=>n?Math.abs(u-n)<2:!1,m=(u,f)=>`${u}_${f}`,d=c.length>0&&o.length>0;return e.jsxs("div",{className:"strike-expiry-heatmap",children:[e.jsxs("div",{className:"heatmap-header",children:[e.jsx("h3",{children:"Strike Ã— Expiry Premium Heatmap"}),e.jsxs("div",{className:"heatmap-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(76, 175, 80, 0.6)"}}),e.jsx("span",{children:"Call Premium"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(244, 67, 54, 0.6)"}}),e.jsx("span",{children:"Put Premium"})]}),n&&e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(255, 193, 7, 0.4)",border:"2px solid #ffc107"}}),e.jsxs("span",{children:["Current Price (~$",n.toFixed(2),")"]})]})]})]}),e.jsx("div",{className:"heatmap-scroll-container",children:d?e.jsxs("table",{className:"heatmap-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"heatmap-corner",children:"Strike"}),o.map(u=>e.jsx("th",{className:"heatmap-expiry",children:new Date(u).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"})},u))]})}),e.jsx("tbody",{children:c.map(u=>{const f=i(u);return e.jsxs("tr",{className:f?"current-price-row":"",children:[e.jsxs("td",{className:`heatmap-strike ${f?"at-money":""}`,children:[u.toFixed(1),f&&e.jsx("span",{className:"atm-indicator",children:"â–¶"})]}),o.map(v=>{const g=r.get(m(u,v)),N=g&&g.volume>0;return e.jsx("td",{className:`heatmap-cell ${N?"has-data":""} ${f?"at-money-cell":""}`,style:{background:N?t(g.value,g.volume):void 0},title:N?`Strike: $${u}
Expiry: ${v}
Net Premium: ${s(g.value)}
Volume: ${g.volume}
Calls: ${g.callVolume}
Puts: ${g.putVolume}
Trades: ${g.trades}`:void 0,children:N&&e.jsx("div",{className:"cell-content",children:e.jsx("span",{className:"cell-value",children:s(g.value)})})},`${u}_${v}`)})]},u)})})]}):e.jsxs("div",{className:"heatmap-no-data",children:[e.jsx("p",{children:"No heatmap data available"}),e.jsx("p",{children:"Select a ticker with options data to view the heatmap"})]})})]})};function ie(a){try{const n=a.match(/(?:options_data|option_data|darkpool_data)_(\d{4}-\d{2}-\d{2})_(\d{2}-\d{2})\.csv/);if(!n)return null;const[,r,c]=n,[o,l,t]=r.split("-").map(Number),[s,i]=c.split("-").map(Number);return new Date(o,l-1,t,s,i)}catch{return null}}async function it(){return["options_data_2025-10-20_16-00.csv","options_data_2025-10-17_15-45.csv","options_data_2025-10-15_TSLA.csv","options_data_2025-10-16_16-00.csv","options_data_2025-10-16_15-00.csv","options_data_2025-10-16_12-00.csv","options_data_2025-10-16_10-30.csv","options_data_2025-10-15_16-00.csv","options_data_2025-10-15_14-00.csv","options_data_2025-10-15_11-30.csv","options_data_2025-10-15_10-00.csv","options_data_2025-10-14_16-00.csv","options_data_2025-10-14_15-00.csv","options_data_2025-10-14_11-00.csv","options_data_2025-10-14_01-00.csv","options_data_2025-10-13_13-20.csv","options_data_2025-10-13_13-00.csv","options_data_2025-10-13_10-50.csv","options_data_2025-10-13_10-00.csv","options_data_2025-10-13_05-30.csv","options_data_2024-01-15_16-00.csv","options_data_2024-01-15_11-30.csv","options_data_2024-01-15_11-00.csv","options_data_2024-01-15_10-00.csv","options_data_2024-01-15_02-30.csv"].map(n=>({filename:n,timestamp:ie(n)||new Date,size:0})).sort((n,r)=>r.timestamp.getTime()-n.timestamp.getTime())}async function nt(){return["darkpool_data_2025-10-17_15-00.csv"].map(n=>({filename:n,timestamp:ie(n)||new Date,size:0})).sort((n,r)=>r.timestamp.getTime()-n.timestamp.getTime())}async function z(a,n=!1){try{const r=n?`?t=${Date.now()}`:"",o=await fetch(`/optionAnalysis/data/${a}${r}`,{cache:n?"no-store":"default",headers:{"Cache-Control":n?"no-cache, no-store, must-revalidate":"default",Pragma:n?"no-cache":"default"}});if(!o.ok)throw new Error(`Failed to load ${a}: ${o.status} ${o.statusText}`);const l=await o.text(),t=ie(a);return{filename:a,timestamp:t||new Date,data:l}}catch(r){return{filename:a,timestamp:new Date,data:"",error:r instanceof Error?r.message:"Unknown error"}}}const B=new Map,K=new Map,Se=5*60*1e3;async function me(a=!1){try{const n=await it(),r=Date.now();if(a){const m=n.map(f=>z(f.filename,!0)),d=await Promise.all(m);return d.forEach(f=>{f.error||B.set(f.filename,{data:f,timestamp:r})}),d.filter(f=>!f.error)}const c=[],o=[];n.forEach(m=>{const d=B.get(m.filename);d&&r-d.timestamp<Se?c.push(d.data):o.push(m.filename)});let l=[];if(o.length>0){const m=o.map(d=>z(d,!1));l=await Promise.all(m),l.forEach(d=>{d.error||B.set(d.filename,{data:d,timestamp:r})})}const t=[...c,...l],s=t.filter(m=>!m.error),i=t.filter(m=>m.error);return s}catch(n){return console.error("Failed to load data files:",n),[]}}async function de(a=!1){try{const n=await nt(),r=Date.now();if(a){const m=n.map(f=>z(f.filename,!0)),d=await Promise.all(m);return d.forEach(f=>{f.error||K.set(f.filename,{data:f,timestamp:r})}),d.filter(f=>!f.error)}const c=[],o=[];n.forEach(m=>{const d=K.get(m.filename);d&&r-d.timestamp<Se?c.push(d.data):o.push(m.filename)});let l=[];if(o.length>0){const m=o.map(d=>z(d,!1));l=await Promise.all(m),l.forEach(d=>{d.error||K.set(d.filename,{data:d,timestamp:r})})}const t=[...c,...l],s=t.filter(m=>!m.error),i=t.filter(m=>m.error);return s}catch(n){return console.error("Failed to load dark pool data files:",n),[]}}function ot(){B.clear()}function ct(){K.clear()}async function mt(a){var r,c,o,l;const n="d3mgi7hr01qmso33ob30d3mgi7hr01qmso33ob3g";try{const t=`https://finnhub.io/api/v1/quote?symbol=${a}&token=${n}`,s=await fetch(t);if(s.ok){const i=await s.json(),m=i==null?void 0:i.c;if(m&&typeof m=="number"&&m>0)return m}}catch{}try{let t=`https://query1.finance.yahoo.com/v8/finance/chart/${a}?interval=1d&range=1d`,s=await fetch(t,{mode:"cors",headers:{Accept:"application/json"}});if(!s.ok||s.status===0){const d=`https://api.allorigins.win/raw?url=${encodeURIComponent(t)}`;s=await fetch(d)}if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json(),m=(l=(o=(c=(r=i==null?void 0:i.chart)==null?void 0:r.result)==null?void 0:c[0])==null?void 0:o.meta)==null?void 0:l.regularMarketPrice;return m&&typeof m=="number"?m:null}catch{return null}}const ae=new Map,dt=9e5;async function Q(a){const n=ae.get(a),r=Date.now();if(n&&r-n.timestamp<dt)return{price:n.price,source:"api",cached:!0};const c=await mt(a);return c!==null?(ae.set(a,{price:c,timestamp:r}),{price:c,source:"api",cached:!1}):{price:null,source:"none",cached:!1}}function Te(){ae.clear()}const ut=({activeDashboard:a,setActiveDashboard:n})=>{var A;const[r,c]=p.useState(null),[o,l]=p.useState(null),[t,s]=p.useState([]),[i,m]=p.useState(null),[d,u]=p.useState(!0),[f,v]=p.useState(null),[g,N]=p.useState(null),[y,x]=p.useState("none"),[k,D]=p.useState(!1),[M,R]=p.useState("");p.useEffect(()=>{(async(V=!1)=>{try{u(!0),v(null);const w=await me(V);if(w.length===0)throw new Error("No data files found in the data directory");const{mergedData:E,info:O}=oe(w.map(H=>({filename:H.filename,data:H.data,timestamp:H.timestamp})));s(E),m(O),u(!1)}catch(w){console.error("Error loading data files:",w),v(w instanceof Error?w.message:"Failed to load data"),u(!1)}})(!1)},[]);const h=p.useMemo(()=>Be(t),[t]),b=p.useMemo(()=>{if(!M.trim())return h;const j=M.toLowerCase();return h.filter(V=>V.ticker.toLowerCase().includes(j))},[h,M]),$=p.useMemo(()=>r?ze(t,r):[],[t,r]),C=p.useMemo(()=>r?Ke(t,r,o||void 0):[],[t,r,o]),P=p.useMemo(()=>r?t.filter(j=>{const V=j.ticker===r,w=!o||j.expiry===o;return V&&w}):[],[t,r,o]),T=p.useMemo(()=>r?Qe(t,r,o||void 0):null,[t,r,o]),S=p.useMemo(()=>r?t.filter(j=>j.ticker===r&&(!o||j.expiry===o)):[],[t,r,o]),F=p.useCallback(j=>{c(j),l(null)},[]),L=p.useCallback(()=>{c(null),l(null)},[]),I=p.useCallback(j=>{l(j===o?null:j)},[o]),_=p.useCallback(async()=>{try{console.log("ðŸ”„ Performing hard refresh for options data..."),Re(),ot(),Te(),console.log("âœ“ Options caches cleared"),console.log("ðŸ”„ Reloading options data with cache bypass..."),u(!0),v(null);const j=await me(!0);if(j.length===0)throw new Error("No data files found in the data directory");const{mergedData:V,info:w}=oe(j.map(E=>({filename:E.filename,data:E.data,timestamp:E.timestamp})));if(s(V),m(w),N(null),x("none"),D(!1),r){const{price:E,source:O,cached:H}=await Q(r);N(E),x(O),D(H)}u(!1),console.log("âœ“ Data reloaded successfully:",{files:w.totalFiles,records:w.totalRecords,latestData:w.dateRange.latest})}catch(j){console.error("Error during hard refresh:",j),v(j instanceof Error?j.message:"Failed to refresh data"),u(!1)}},[r]);return p.useEffect(()=>{if(!r){N(null),x("none"),D(!1);return}(async()=>{const V=await Q(r);N(V.price),x(V.source),D(V.cached)})()},[r]),d?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading options data from multiple files..."})]}):f?e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h3",{children:"Error Loading Data"}),e.jsx("p",{children:f}),e.jsx("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"options-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"Market Analysis Dashboard"}),i&&e.jsxs("div",{className:"header-stats",children:[e.jsxs("span",{className:"header-stat",children:[i.totalFiles," files"]}),e.jsx("span",{className:"stat-separator",children:"â€¢"}),e.jsxs("span",{className:"header-stat",children:[i.totalRecords.toLocaleString()," records"]}),e.jsx("span",{className:"stat-separator",children:"â€¢"}),e.jsx("span",{className:"header-stat",children:((A=i.dateRange.latest)==null?void 0:A.toLocaleString())||""})]})]}),e.jsxs("div",{className:"header-right",children:[!r&&e.jsxs("div",{className:"search-container-header",children:[e.jsx(ve,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search tickers...",value:M,onChange:j=>R(j.target.value)}),M&&e.jsx("button",{className:"clear-search",onClick:()=>R(""),title:"Clear search",children:"Ã—"})]}),e.jsxs("div",{className:"nav-buttons",children:[e.jsx("button",{className:`nav-button ${a==="options"?"active":""}`,onClick:()=>n("options"),children:"Options Analysis"}),e.jsx("button",{className:`nav-button ${a==="darkpool"?"active":""}`,onClick:()=>n("darkpool"),children:"Dark Pool Analysis"})]}),e.jsxs("button",{className:"refresh-button-compact",onClick:_,title:"Hard Refresh - Clears all caches and reloads data from files",children:[e.jsx(ge,{className:"refresh-icon"}),"Hard Refresh"]})]})]}),r?e.jsxs("div",{className:"ticker-detail-view",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("button",{className:"back-button",onClick:L,children:[e.jsx(je,{className:"back-icon"}),"Back to Ticker List"]}),e.jsxs("h2",{children:[r," Options Analysis"]}),g&&y==="api"?e.jsxs("span",{className:"current-price-badge",children:[e.jsx("span",{className:"price-indicator"}),"Current Price: $",g.toFixed(2),e.jsxs("span",{className:"price-status",children:["(",k?"Cached":"Live",")"]})]}):e.jsx("span",{className:"price-unavailable",children:"Price unavailable"})]}),e.jsxs("div",{className:"expiry-filter",children:[e.jsxs("div",{className:"filter-header",children:[e.jsx(le,{className:"filter-icon"}),e.jsx("span",{children:"Filter by Expiry Date:"})]}),e.jsxs("div",{className:"expiry-buttons",children:[e.jsx("button",{className:`expiry-button ${o?"":"active"}`,onClick:()=>l(null),children:"All Expiries"}),$.map(j=>e.jsx("button",{className:`expiry-button ${o===j?"active":""}`,onClick:()=>I(j),children:new Date(j).toLocaleDateString()},j))]})]}),e.jsxs("div",{className:"charts-section",children:[e.jsx("div",{className:"chart-column",children:e.jsx(se,{data:C,highestVolumeData:T,ticker:r,expiry:o||void 0,chartType:"callput",currentPrice:g||void 0,trades:P})}),e.jsx("div",{className:"chart-column",children:e.jsx(se,{data:C,highestVolumeData:T,ticker:r,expiry:o||void 0,chartType:"total",currentPrice:g||void 0,trades:P})})]}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Total Volume"}),e.jsx("p",{children:C.reduce((j,V)=>j+V.totalVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Call Volume"}),e.jsx("p",{children:C.reduce((j,V)=>j+V.callVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Put Volume"}),e.jsx("p",{children:C.reduce((j,V)=>j+V.putVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Open Interest"}),e.jsx("p",{children:C.reduce((j,V)=>j+V.openInterest,0).toLocaleString()})]})]}),e.jsxs("div",{className:"heatmap-trades-section",children:[e.jsx("div",{className:"heatmap-column",children:e.jsx(lt,{trades:S,currentPrice:g||void 0})}),e.jsx("div",{className:"trades-column",children:e.jsxs("div",{className:"trade-list-section",children:[e.jsxs("h3",{children:["Trade History for ",r]}),e.jsxs("p",{children:["Found ",S.length," trades"]}),e.jsx($e,{trades:S,ticker:r,expiry:o||void 0})]})})]})]}):e.jsx(be,{tickers:b,onTickerSelect:F,allData:t})]})},Ve=p.memo(({trade:a,volumeStats:n,valueStats:r})=>{const c=i=>{try{return new Date(i).toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}catch{return"Unknown"}},o=i=>i>=1e6?`${(i/1e6).toFixed(1)}M`:i>=1e3?`${(i/1e3).toFixed(1)}K`:i.toLocaleString(),t=(i=>{const m=i.replace(/[$,]/g,""),d=parseFloat(m);return i.includes("M")?d*1e6:i.includes("K")?d*1e3:d})(a.totalValue),s=()=>a.quantity>=n.q90||t>=r.q90?"rgba(0, 200, 0, 0.6)":"rgba(255, 255, 255, 0.1)";return e.jsxs("div",{className:"darkpool-row-horizontal",style:{backgroundColor:s(),borderLeft:a.quantity>=n.q90||t>=r.q90?"4px solid #00c800":"none"},children:[e.jsx("div",{className:"darkpool-cell-h symbol",children:a.ticker}),e.jsx("div",{className:"darkpool-cell-h quantity",children:o(a.quantity)}),e.jsxs("div",{className:"darkpool-cell-h price",children:["$",a.price.toFixed(2)]}),e.jsx("div",{className:"darkpool-cell-h total-value",children:a.totalValue}),e.jsx("div",{className:"darkpool-cell-h exec-time",children:c(a.timestamp)})]})});Ve.displayName="DarkPoolRow";const ue=a=>{const n=[...a].sort((i,m)=>i-m),r=a.reduce((i,m)=>i+m,0)/a.length,c=a.reduce((i,m)=>i+Math.pow(m-r,2),0)/a.length,o=Math.sqrt(c),l=Math.floor(n.length*.75),t=Math.floor(n.length*.9),s=Math.floor(n.length*.95);return{mean:r,stdDev:o,q75:n[l]||0,q90:n[t]||0,q95:n[s]||0}},De=p.memo(({trades:a,ticker:n})=>{const[r,c]=p.useState("timestamp"),[o,l]=p.useState("desc"),{volumeStats:t,valueStats:s}=p.useMemo(()=>{if(a.length===0)return{volumeStats:{mean:0,stdDev:0,q75:0,q90:0,q95:0},valueStats:{mean:0,stdDev:0,q75:0,q90:0,q95:0}};const v=a.map(N=>N.quantity),g=a.map(N=>{const y=N.totalValue.replace(/[$,]/g,""),x=parseFloat(y);return N.totalValue.includes("M")?x*1e6:N.totalValue.includes("K")?x*1e3:x});return{volumeStats:ue(v),valueStats:ue(g)}},[a]),i=p.useMemo(()=>[...a].sort((g,N)=>{let y=0;switch(r){case"timestamp":y=new Date(g.timestamp).getTime()-new Date(N.timestamp).getTime();break;case"quantity":y=g.quantity-N.quantity;break;case"price":y=g.price-N.price;break;case"total-value":const x=parseFloat(g.totalValue.replace(/[$,]/g,"")),k=parseFloat(N.totalValue.replace(/[$,]/g,""));y=x-k;break;default:y=0}return o==="asc"?y:-y}),[a,r,o]),m=v=>{r===v?l(o==="asc"?"desc":"asc"):(c(v),l("desc"))},d=v=>r!==v?"â†•ï¸":o==="asc"?"â†‘":"â†“",u=a.reduce((v,g)=>{const N=parseFloat(g.totalValue.replace(/[$,]/g,""));return v+N},0),f=v=>v>=1e9?`$${(v/1e9).toFixed(1)}B`:v>=1e6?`$${(v/1e6).toFixed(1)}M`:v>=1e3?`$${(v/1e3).toFixed(1)}K`:`$${v.toFixed(0)}`;return e.jsxs("div",{className:"darkpool-list-container",children:[e.jsxs("div",{className:"darkpool-list-header",children:[e.jsxs("h3",{children:["Dark Pool Trades",n?` for ${n}`:""]}),e.jsxs("div",{className:"darkpool-stats",children:[e.jsxs("span",{className:"stat-item",children:[e.jsx("strong",{children:a.length})," trades"]}),e.jsxs("span",{className:"stat-item",children:[e.jsx("strong",{children:f(u)})," total value"]})]})]}),e.jsxs("div",{className:"darkpool-legend",children:[e.jsx("div",{className:"legend-title",children:"Trade Volume/Value Indicators:"}),e.jsxs("div",{className:"legend-items",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color unusual"}),e.jsx("span",{children:"Unusual (Top 10%)"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color normal"}),e.jsx("span",{children:"Normal"})]})]})]}),e.jsxs("div",{className:"darkpool-list-table",children:[e.jsxs("div",{className:"darkpool-header-row",children:[e.jsxs("div",{className:"darkpool-header-cell symbol",onClick:()=>m("timestamp"),children:["Symbol ",d("timestamp")]}),e.jsxs("div",{className:"darkpool-header-cell quantity",onClick:()=>m("quantity"),children:["Quantity ",d("quantity")]}),e.jsxs("div",{className:"darkpool-header-cell price",onClick:()=>m("price"),children:["Price ",d("price")]}),e.jsxs("div",{className:"darkpool-header-cell total-value",onClick:()=>m("total-value"),children:["Total Value ",d("total-value")]}),e.jsxs("div",{className:"darkpool-header-cell exec-time",onClick:()=>m("timestamp"),children:["Execution Time ",d("timestamp")]})]}),e.jsx("div",{className:"darkpool-trades-container",children:i.map((v,g)=>e.jsx(Ve,{trade:v,volumeStats:t,valueStats:s},`${v.ticker}-${v.timestamp}-${g}`))})]}),a.length===0&&e.jsx("div",{className:"no-trades-message",children:e.jsxs("p",{children:["No dark pool trades found",n?` for ${n}`:"","."]})})]})});De.displayName="DarkPoolList";const ht=a=>{try{const n=new Date(a);return isNaN(n.getTime())?"":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" "+n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}},Y=a=>a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(1)}K`:a.toString(),G=a=>a>=1e9?`$${(a/1e9).toFixed(1)}B`:a>=1e6?`$${(a/1e6).toFixed(1)}M`:a>=1e3?`$${(a/1e3).toFixed(1)}K`:`$${a.toFixed(2)}`,Ce=p.memo(({tickers:a,onTickerSelect:n,allData:r})=>{const[c,o]=p.useState("recent"),l=p.useMemo(()=>{const t=[...a];switch(c){case"recent":return t.sort((s,i)=>new Date(i.lastActivity).getTime()-new Date(s.lastActivity).getTime());case"oldest":return t.sort((s,i)=>new Date(s.lastActivity).getTime()-new Date(i.lastActivity).getTime());case"value-high":return t.sort((s,i)=>i.totalValue-s.totalValue);case"value-low":return t.sort((s,i)=>s.totalValue-i.totalValue);case"quantity-high":return t.sort((s,i)=>i.totalQuantity-s.totalQuantity);case"quantity-low":return t.sort((s,i)=>s.totalQuantity-i.totalQuantity);case"trades-high":return t.sort((s,i)=>i.tradeCount-s.tradeCount);case"trades-low":return t.sort((s,i)=>s.tradeCount-i.tradeCount);case"volume-high":return t.sort((s,i)=>i.highestVolumeQuantity-s.highestVolumeQuantity);case"volume-low":return t.sort((s,i)=>s.highestVolumeQuantity-i.highestVolumeQuantity);default:return t}},[a,c]);return e.jsxs("div",{className:"ticker-list-container",children:[e.jsxs("div",{className:"ticker-list-header",children:[e.jsx("h2",{children:"Dark Pool Tickers"}),e.jsx("p",{children:"Select a ticker to view detailed dark pool activity"}),e.jsxs("div",{className:"sort-controls",children:[e.jsx(re,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:t=>o(t.target.value),children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"value-high",children:"Value (High to Low)"}),e.jsx("option",{value:"value-low",children:"Value (Low to High)"}),e.jsx("option",{value:"quantity-high",children:"Quantity (High to Low)"}),e.jsx("option",{value:"quantity-low",children:"Quantity (Low to High)"}),e.jsx("option",{value:"trades-high",children:"Trades (High to Low)"}),e.jsx("option",{value:"trades-low",children:"Trades (Low to High)"}),e.jsx("option",{value:"volume-high",children:"High Volume (High to Low)"}),e.jsx("option",{value:"volume-low",children:"High Volume (Low to High)"})]})]})]}),e.jsx("div",{className:"ticker-grid",children:l.map(t=>{const s=r.filter(i=>i.ticker===t.ticker).sort((i,m)=>new Date(m.timestamp).getTime()-new Date(i.timestamp).getTime())[0];return e.jsxs("div",{className:"ticker-card darkpool-card",onClick:()=>n(t.ticker),children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h3",{className:"ticker-symbol",children:t.ticker}),e.jsxs("div",{className:"ticker-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx(he,{className:"metric-icon value"}),e.jsx("span",{className:"metric-label",children:"Total Value"}),e.jsx("span",{className:"metric-value",children:G(t.totalValue)})]}),e.jsxs("div",{className:"metric",children:[e.jsx(pe,{className:"metric-icon quantity"}),e.jsx("span",{className:"metric-label",children:"Quantity"}),e.jsx("span",{className:"metric-value",children:Y(t.totalQuantity)})]})]})]}),e.jsxs("div",{className:"ticker-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Trades:"}),e.jsx("span",{className:"detail-value",children:t.tradeCount})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Avg Price:"}),e.jsxs("span",{className:"detail-value",children:["$",t.averagePrice.toFixed(2)]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(le,{className:"detail-icon"}),e.jsx("span",{className:"detail-label",children:"Max Trade:"}),e.jsx("span",{className:"detail-value",children:G(t.maxTradeValue)})]}),s&&e.jsxs("div",{className:"detail-row last-trade-row",children:[e.jsx("span",{className:"detail-label",children:"Last Trade:"}),e.jsxs("span",{className:"detail-value last-trade",children:[G(s.price*s.quantity),e.jsxs("span",{className:"trade-side",children:[Y(s.quantity)," @ $",s.price.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"ticker-analytics",children:[e.jsxs("div",{className:"analytics-badge key-levels-badge",children:[e.jsx(xe,{size:12}),e.jsx("span",{className:"badge-label",children:"High Volume:"}),e.jsxs("span",{className:"badge-strikes",children:[Y(t.highestVolumeQuantity)," @ $",t.highestVolumePrice.toFixed(2)]})]}),e.jsxs("div",{className:"analytics-badge max-pain-badge",children:[e.jsx(fe,{size:12}),e.jsx("span",{className:"badge-label",children:"Peak Time:"}),e.jsx("span",{className:"badge-strikes",children:ht(t.highestVolumeTime)})]})]})]},t.ticker)})}),l.length===0&&e.jsx("div",{className:"no-tickers",children:e.jsx("p",{children:"No dark pool tickers found"})})]})});Ce.displayName="DarkPoolTickerList";const pt=({trades:a})=>{const n=p.useMemo(()=>{if(!a||a.length===0)return[];const t=[...a].sort((i,m)=>i.price-m.price),s=new Map;return t.forEach(i=>{const m=Math.round(i.price*100)/100;if(s.has(m)){const d=s.get(m);d.volume+=i.quantity,d.value+=i.price*i.quantity,new Date(i.timestamp)>new Date(d.timestamp)&&(d.timestamp=i.timestamp)}else s.set(m,{price:m,volume:i.quantity,timestamp:i.timestamp,value:i.price*i.quantity})}),Array.from(s.values()).sort((i,m)=>i.price-m.price)},[a]),r=p.useMemo(()=>Math.max(...n.map(t=>t.volume),1),[n]),c=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),o=t=>t>=1e9?`$${(t/1e9).toFixed(1)}B`:t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(2)}`,l=t=>{try{const s=new Date(t);return isNaN(s.getTime())?"":s.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}};return n.length===0?e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Trade Distribution Chart"}),e.jsx("div",{className:"no-data",children:"No trade data available for charting"})]}):e.jsx("div",{className:"chart-container",children:e.jsxs("div",{className:"chart-content",children:[e.jsxs("div",{className:"chart-y-axis",children:[e.jsx("div",{className:"y-label",children:"Volume"}),e.jsxs("div",{className:"y-scale",children:[e.jsx("div",{className:"scale-value",children:c(r)}),e.jsx("div",{className:"scale-value",children:c(r*.75)}),e.jsx("div",{className:"scale-value",children:c(r*.5)}),e.jsx("div",{className:"scale-value",children:c(r*.25)}),e.jsx("div",{className:"scale-value",children:"0"})]})]}),e.jsxs("div",{className:"chart-main",children:[e.jsx("div",{className:"chart-bars",children:n.map((t,s)=>{const i=t.volume/r*100,m=t.volume>r*.8;return e.jsx("div",{className:`chart-bar ${m?"high-volume":""}`,style:{height:`${i}%`},title:`Price: $${t.price.toFixed(2)}
Volume: ${c(t.volume)}
Value: ${o(t.value)}
Time: ${l(t.timestamp)}`,children:e.jsx("div",{className:"bar-value",children:c(t.volume)})},`${t.price}-${s}`)})}),e.jsxs("div",{className:"chart-x-axis",children:[e.jsx("div",{className:"x-label",children:"Price ($)"}),e.jsx("div",{className:"x-scale",children:n.map((t,s)=>e.jsx("div",{className:"x-tick",children:e.jsxs("span",{className:"price-label",children:["$",t.price.toFixed(2)]})},`price-${s}`))})]})]})]})})},xt=({trades:a})=>{const n=p.useMemo(()=>{if(!a||a.length===0)return[];const t=new Map;return a.forEach(s=>{const i=new Date(s.timestamp),m=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")} ${String(i.getHours()).padStart(2,"0")}:00`;if(t.has(m)){const d=t.get(m);d.volume+=s.quantity,d.tradeCount+=1,d.totalValue+=s.price*s.quantity,d.avgPrice=d.totalValue/d.volume}else t.set(m,{time:m,volume:s.quantity,tradeCount:1,avgPrice:s.price,totalValue:s.price*s.quantity})}),Array.from(t.values()).sort((s,i)=>new Date(s.time).getTime()-new Date(i.time).getTime())},[a]),r=p.useMemo(()=>Math.max(...n.map(t=>t.volume),1),[n]),c=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),o=t=>t>=1e9?`$${(t/1e9).toFixed(1)}B`:t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(2)}`,l=t=>{try{const s=new Date(t);if(isNaN(s.getTime()))return"";const i=String(s.getMonth()+1).padStart(2,"0"),m=String(s.getDate()).padStart(2,"0"),d=String(s.getHours()).padStart(2,"0"),u=String(s.getMinutes()).padStart(2,"0");return`${i}/${m}-${d}:${u}`}catch{return""}};return n.length===0?e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Volume Over Time"}),e.jsx("div",{className:"no-data",children:"No trade data available for time analysis"})]}):e.jsx("div",{className:"chart-container",children:e.jsxs("div",{className:"chart-content",children:[e.jsxs("div",{className:"chart-y-axis",children:[e.jsx("div",{className:"y-label",children:"Volume"}),e.jsxs("div",{className:"y-scale",children:[e.jsx("div",{className:"scale-value",children:c(r)}),e.jsx("div",{className:"scale-value",children:c(r*.75)}),e.jsx("div",{className:"scale-value",children:c(r*.5)}),e.jsx("div",{className:"scale-value",children:c(r*.25)}),e.jsx("div",{className:"scale-value",children:"0"})]})]}),e.jsxs("div",{className:"chart-main",children:[e.jsx("div",{className:"chart-bars",children:n.map((t,s)=>{const i=t.volume/r*100,m=t.volume>r*.8;return e.jsx("div",{className:`chart-bar ${m?"high-volume":""}`,style:{height:`${i}%`},title:`Time: ${l(t.time)}
Volume: ${c(t.volume)}
Trades: ${t.tradeCount}
Avg Price: $${t.avgPrice.toFixed(2)}
Total Value: ${o(t.totalValue)}`,children:e.jsx("div",{className:"bar-value",children:c(t.volume)})},`${t.time}-${s}`)})}),e.jsxs("div",{className:"chart-x-axis",children:[e.jsx("div",{className:"x-label",children:"Time"}),e.jsx("div",{className:"x-scale",children:n.map((t,s)=>e.jsx("div",{className:"x-tick",children:e.jsx("span",{className:"time-label",children:l(t.time)})},`time-${s}`))})]})]})]})})},ft=({activeDashboard:a,setActiveDashboard:n})=>{var P;const[r,c]=p.useState(null),[o,l]=p.useState([]),[t,s]=p.useState(null),[i,m]=p.useState(!0),[d,u]=p.useState(null),[f,v]=p.useState(null),[g,N]=p.useState("none"),[y,x]=p.useState(!1),[k,D]=p.useState("");p.useEffect(()=>{(async(S=!1)=>{try{m(!0),u(null);const F=await de(S);if(F.length===0)throw new Error("No dark pool data files found in the data directory");const{mergedData:L,info:I}=ce(F.map(_=>({filename:_.filename,data:_.data,timestamp:_.timestamp})));l(L),s(I),m(!1)}catch(F){console.error("Error loading dark pool data files:",F),u(F instanceof Error?F.message:"Failed to load dark pool data"),m(!1)}})(!1)},[]);const M=p.useMemo(()=>st(o).map(S=>{const F=o.filter(w=>w.ticker===S.ticker),L=F.map(w=>w.quantity),I=F.map(w=>w.price*w.quantity),_=F.map(w=>w.price),A=F.reduce((w,E)=>E.quantity>w.quantity?E:w,F[0]),j=S.totalValue/S.tradeCount,V=_.length>1?Math.sqrt(_.reduce((w,E)=>w+Math.pow(E-S.averagePrice,2),0)/_.length):0;return{ticker:S.ticker,totalValue:S.totalValue,totalQuantity:S.totalQuantity,tradeCount:S.tradeCount,averagePrice:S.averagePrice,lastActivity:S.lastActivity,maxTradeValue:Math.max(...I),minTradeValue:Math.min(...I),maxQuantity:Math.max(...L),minQuantity:Math.min(...L),avgTradeSize:j,priceVolatility:V,highestVolumePrice:(A==null?void 0:A.price)||0,highestVolumeTime:(A==null?void 0:A.timestamp)||"",highestVolumeQuantity:(A==null?void 0:A.quantity)||0}}),[o]),R=p.useMemo(()=>{if(!k.trim())return M;const T=k.toLowerCase();return M.filter(S=>S.ticker.toLowerCase().includes(T))},[M,k]),h=p.useMemo(()=>r?o.filter(T=>T.ticker===r):[],[o,r]),b=p.useCallback(T=>{c(T)},[]),$=p.useCallback(()=>{c(null)},[]),C=p.useCallback(async()=>{try{console.log("ðŸ”„ Performing hard refresh for dark pool data..."),Oe(),ct(),Te(),console.log("âœ“ Dark pool caches cleared"),console.log("ðŸ”„ Reloading dark pool data with cache bypass..."),m(!0),u(null);const T=await de(!0);if(T.length===0)throw new Error("No dark pool data files found in the data directory");const{mergedData:S,info:F}=ce(T.map(L=>({filename:L.filename,data:L.data,timestamp:L.timestamp})));if(l(S),s(F),v(null),N("none"),x(!1),r){const{price:L,source:I,cached:_}=await Q(r);v(L),N(I),x(_)}m(!1),console.log("âœ“ Dark pool data reloaded successfully:",{files:F.totalFiles,records:F.totalRecords,latestData:F.dateRange.latest})}catch(T){console.error("Error during hard refresh:",T),u(T instanceof Error?T.message:"Failed to refresh dark pool data"),m(!1)}},[r]);return p.useEffect(()=>{if(!r){v(null),N("none"),x(!1);return}(async()=>{const S=await Q(r);v(S.price),N(S.source),x(S.cached)})()},[r]),i?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading dark pool data from multiple files..."})]}):d?e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h3",{children:"Error Loading Dark Pool Data"}),e.jsx("p",{children:d}),e.jsx("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"darkpool-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"Market Analysis Dashboard"}),t&&e.jsxs("div",{className:"header-stats",children:[e.jsxs("span",{className:"header-stat",children:[t.totalFiles," files"]}),e.jsx("span",{className:"stat-separator",children:"â€¢"}),e.jsxs("span",{className:"header-stat",children:[t.totalRecords.toLocaleString()," records"]}),e.jsx("span",{className:"stat-separator",children:"â€¢"}),e.jsx("span",{className:"header-stat",children:((P=t.dateRange.latest)==null?void 0:P.toLocaleString())||""})]})]}),e.jsxs("div",{className:"header-right",children:[!r&&e.jsxs("div",{className:"search-container-header",children:[e.jsx(ve,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search tickers...",value:k,onChange:T=>D(T.target.value)}),k&&e.jsx("button",{className:"clear-search",onClick:()=>D(""),title:"Clear search",children:"Ã—"})]}),e.jsxs("div",{className:"nav-buttons",children:[e.jsx("button",{className:`nav-button ${a==="options"?"active":""}`,onClick:()=>n("options"),children:"Options Analysis"}),e.jsx("button",{className:`nav-button ${a==="darkpool"?"active":""}`,onClick:()=>n("darkpool"),children:"Dark Pool Analysis"})]}),e.jsxs("button",{className:"refresh-button-compact",onClick:C,title:"Hard Refresh - Clears all caches and reloads data from files",children:[e.jsx(ge,{className:"refresh-icon"}),"Hard Refresh"]})]})]}),r?e.jsxs("div",{className:"ticker-detail-view",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("button",{className:"back-button",onClick:$,children:[e.jsx(je,{className:"back-icon"}),"Back to Ticker List"]}),e.jsxs("h2",{children:[r," Dark Pool Analysis"]}),f&&g==="api"?e.jsxs("span",{className:"current-price-badge",children:[e.jsx("span",{className:"price-indicator"}),"Current Price: $",f.toFixed(2),e.jsxs("span",{className:"price-status",children:["(",y?"Cached":"Live",")"]})]}):e.jsx("span",{className:"price-unavailable",children:"Price unavailable"})]}),e.jsxs("div",{className:"charts-container",children:[e.jsx("div",{className:"chart-column",children:e.jsx(pt,{trades:h,ticker:r})}),e.jsx("div",{className:"chart-column",children:e.jsx(xt,{trades:h,ticker:r})})]}),e.jsx("div",{className:"darkpool-trades-section",children:e.jsx(De,{trades:h,ticker:r})})]}):e.jsx(Ce,{tickers:R,onTickerSelect:b,allData:o})]})};class vt extends p.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,r){console.error("ErrorBoundary caught an error:",n,r),this.setState({error:n,errorInfo:r})}render(){var n,r;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"An error occurred while rendering this component."}),e.jsxs("details",{className:"error-details",children:[e.jsx("summary",{children:"Error Details"}),e.jsx("pre",{children:(n=this.state.error)==null?void 0:n.toString()}),e.jsx("pre",{children:(r=this.state.errorInfo)==null?void 0:r.componentStack})]}),e.jsx("button",{className:"retry-button",onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),children:"Try Again"})]})}):this.props.children}}function gt(){const[a,n]=p.useState("options");return e.jsx("div",{className:"app",children:e.jsx("main",{children:e.jsx(vt,{children:a==="options"?e.jsx(ut,{activeDashboard:a,setActiveDashboard:n}):e.jsx(ft,{activeDashboard:a,setActiveDashboard:n})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{const a="/optionAnalysis/";navigator.serviceWorker.register(`${a}sw.js`).then(n=>{console.log("SW registered: ",n)}).catch(n=>{console.log("SW registration failed: ",n)})});X.createRoot(document.getElementById("root")).render(e.jsx(Me.StrictMode,{children:e.jsx(gt,{})}));
//# sourceMappingURL=index-0aa8e0e1-1760994784977.js.map
