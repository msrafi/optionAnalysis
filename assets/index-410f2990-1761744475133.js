import{r as g,a as We,R as Je}from"./vendor-b1791c80-1761744475133.js";import{A as xe,T as Ve,a as Pe,C as fe,b as Me,S as Ae,R as z,c as Q,d as Ge,e as we}from"./utils-ee37ff07-1761744475133.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}})();var Ee={exports:{}},oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xe=g,Ze=Symbol.for("react.element"),et=Symbol.for("react.fragment"),tt=Object.prototype.hasOwnProperty,st=Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,at={key:!0,ref:!0,__self:!0,__source:!0};function Fe(t,s,a){var o,n={},c=null,l=null;a!==void 0&&(c=""+a),s.key!==void 0&&(c=""+s.key),s.ref!==void 0&&(l=s.ref);for(o in s)tt.call(s,o)&&!at.hasOwnProperty(o)&&(n[o]=s[o]);if(t&&t.defaultProps)for(o in s=t.defaultProps,s)n[o]===void 0&&(n[o]=s[o]);return{$$typeof:Ze,type:t,key:c,ref:l,props:n,_owner:st.current}}oe.Fragment=et;oe.jsx=Fe;oe.jsxs=Fe;Ee.exports=oe;var e=Ee.exports,ue={},ke=We;ue.createRoot=ke.createRoot,ue.hydrateRoot=ke.hydrateRoot;const X="optionAnalysis_parseCache",Z="optionAnalysis_darkPoolParseCache",ee="optionAnalysis_tickerSummaryCache",te="optionAnalysis_darkPoolTickerSummaryCache";function rt(t){try{const s=sessionStorage.getItem(t);if(s){const a=JSON.parse(s),o=new Map;for(const[n,c]of Object.entries(a))o.set(n,c);return o}}catch{}return new Map}function lt(t,s){try{const a=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(a))}catch{}}function it(t){try{const s=sessionStorage.getItem(t);if(s){const a=JSON.parse(s),o=new Map;for(const[n,c]of Object.entries(a))o.set(n,c);return o}}catch{}return new Map}function nt(t,s){try{const a=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(a))}catch{}}function ot(t){try{const s=sessionStorage.getItem(t);if(s){const a=JSON.parse(s),o=new Map;for(const[n,c]of Object.entries(a))o.set(n,c);return o}}catch{}return new Map}function ct(t,s){try{const a=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(a))}catch{}}function dt(t){try{const s=sessionStorage.getItem(t);if(s){const a=JSON.parse(s),o=new Map;for(const[n,c]of Object.entries(a))o.set(n,c);return o}}catch{}return new Map}function mt(t,s){try{const a=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(a))}catch{}}function B(t){try{sessionStorage.removeItem(t)}catch{}}function he(){B(X),B(ee)}function ut(){B(Z),B(te)}function ht(){B(X),B(Z),B(ee),B(te)}function U(t){try{if(!t)return null;const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),o={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},n=(l,r)=>{let i=parseInt(l);return r.toUpperCase()==="PM"&&i!==12?i+=12:r.toUpperCase()==="AM"&&i===12&&(i=0),i};let c=t.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(c){const[,,l,r,i,u,d,m]=c,x=o[l.toLowerCase()];if(x===void 0)return null;const h=n(u,m);return new Date(parseInt(i),x,parseInt(r),h,parseInt(d))}if(c=t.match(/Yesterday at (\d+):(\d+)\s+(AM|PM)/i),c){const[,l,r,i]=c,u=n(l,i),d=new Date(a);return d.setDate(d.getDate()-1),new Date(d.getFullYear(),d.getMonth(),d.getDate(),u,parseInt(r))}if(c=t.match(/(\d+):(\d+)\s+(AM|PM)/i),c){const[,l,r,i]=c,u=n(l,i);return new Date(a.getFullYear(),a.getMonth(),a.getDate(),u,parseInt(r))}return null}catch{return null}}function pt(t){try{if(!t)return!1;const s=t.split("/");if(s.length!==3)return!1;const a=parseInt(s[0])-1,o=parseInt(s[1]),n=parseInt(s[2]);return new Date(n,a,o,23,59,59)<new Date}catch{return!1}}function xt(t,s){var u,d;const a=`${s||"unknown"}_${t.length}_${t.slice(0,100)}`,o=rt(X),n=o.get(a);if(n)return n;const c=t.split(`
`),l=[],r=Math.max(1e3,c.length*.8);l.length=r;let i=0;for(let m=1;m<c.length;m++){const x=c[m].trim();if(!x)continue;const h=_e(x);if(!(h.length<19))try{const f=h[5]||"",w=h[6]||"",P=h[7]||"",y=parseFloat(h[8])||0,k=h[9]||"",v=h[10],j=parseInt(((u=h[12])==null?void 0:u.replace(/,/g,""))||"0"),D=h[13]||"$0",p=parseInt(((d=h[14])==null?void 0:d.replace(/,/g,""))||"0"),N=0,T=["Ask","Above","Bid","Below","Sweep","Block","Trade","Volume","Premium"],M=P&&P.length>=1&&P.length<=10&&!T.includes(P)&&!P.match(/^\d+$/)&&!P.includes(" ")&&/^[A-Z0-9]+$/.test(P),C=pt(k);M&&y>0&&k&&v&&j>0&&!C&&(l[i++]={ticker:P,strike:y,expiry:k,optionType:v,volume:j,premium:D,openInterest:p,bidAskSpread:N,timestamp:f,sweepType:w,sourceFile:s})}catch{}}return l.length=i,o.set(a,l),lt(X,o),l}function ft(t){const s=`${t.length}_${t.slice(0,3).map(l=>`${l.ticker}_${l.timestamp}`).join("_")}`,a=ot(ee),o=a.get(s);if(o)return o;const n=new Map;for(let l=0;l<t.length;l++){const r=t[l];if(!n.has(r.ticker)){const d=U(r.timestamp);n.set(r.ticker,{ticker:r.ticker,totalVolume:0,callVolume:0,putVolume:0,totalPremium:0,uniqueExpiries:[],expirySet:new Set,lastActivity:r.timestamp,lastActivityDate:d,lastTrade:{strike:r.strike,optionType:r.optionType,volume:r.volume,premium:r.premium,sweepType:r.sweepType,timestamp:r.timestamp}})}const i=n.get(r.ticker);i.totalVolume+=r.volume,i.totalPremium+=ge(r.premium),r.optionType==="Call"?i.callVolume+=r.volume:i.putVolume+=r.volume,i.expirySet.has(r.expiry)||(i.expirySet.add(r.expiry),i.uniqueExpiries.push(r.expiry));const u=U(r.timestamp);u&&i.lastActivityDate&&u>i.lastActivityDate?(i.lastActivity=r.timestamp,i.lastActivityDate=u,i.lastTrade={strike:r.strike,optionType:r.optionType,volume:r.volume,premium:r.premium,sweepType:r.sweepType,timestamp:r.timestamp}):u&&!i.lastActivityDate&&(i.lastActivity=r.timestamp,i.lastActivityDate=u,i.lastTrade||(i.lastTrade={strike:r.strike,optionType:r.optionType,volume:r.volume,premium:r.premium,sweepType:r.sweepType,timestamp:r.timestamp}))}const c=Array.from(n.values()).map(({expirySet:l,...r})=>r).sort((l,r)=>{const i=l.lastActivityDate instanceof Date?l.lastActivityDate:l.lastActivityDate?new Date(l.lastActivityDate):null,u=r.lastActivityDate instanceof Date?r.lastActivityDate:r.lastActivityDate?new Date(r.lastActivityDate):null;return i&&u&&i.getTime()!==u.getTime()?u.getTime()-i.getTime():r.totalVolume-l.totalVolume});return a.set(s,c),ct(ee,a),c}function gt(t,s,a){const o=t.filter(c=>c.ticker===s&&(!a||c.expiry===a)),n=new Map;return o.forEach(c=>{n.has(c.strike)||n.set(c.strike,{strike:c.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const l=n.get(c.strike);l.totalVolume+=c.volume,l.openInterest+=c.openInterest,c.optionType==="Call"?l.callVolume+=c.volume:l.putVolume+=c.volume}),Array.from(n.values()).sort((c,l)=>c.strike-l.strike)}function yt(t,s){const a=new Set;return t.forEach(o=>{o.ticker===s&&a.add(o.expiry)}),Array.from(a).sort((o,n)=>new Date(o).getTime()-new Date(n).getTime())}function vt(t,s,a){const o=t.filter(r=>r.ticker===s&&(!a||r.expiry===a));if(!o.length)return null;const n=new Map;o.forEach(r=>{n.has(r.strike)||n.set(r.strike,{strike:r.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const i=n.get(r.strike);i.totalVolume+=r.volume,i.openInterest+=r.openInterest,r.optionType==="Call"?i.callVolume+=r.volume:i.putVolume+=r.volume});const l=Array.from(n.values()).reduce((r,i)=>i.totalVolume>r.totalVolume?i:r);return{strike:l.strike,totalVolume:l.totalVolume,callVolume:l.callVolume,putVolume:l.putVolume,openInterest:l.openInterest}}function ge(t){const s=t.replace(/[$,K]/g,""),a=parseFloat(s);return t.includes("K")?a*1e3:t.includes("M")?a*1e6:a}function O(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function K(t){return t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(0)}`}function se(t){const s=[],a=[];let o=null,n=null;const c=new Map;t.sort((i,u)=>{const d=i.timestamp instanceof Date?i.timestamp:new Date(i.timestamp);return(u.timestamp instanceof Date?u.timestamp:new Date(u.timestamp)).getTime()-d.getTime()}).forEach(i=>{const u=xt(i.data,i.filename);u.forEach(m=>{const x=`${m.ticker}_${m.strike}_${m.expiry}_${m.optionType}_${m.volume}_${m.premium}_${m.timestamp}`;c.has(x)||c.set(x,m)}),a.push({filename:i.filename,recordCount:u.length,timestamp:i.timestamp});const d=i.timestamp instanceof Date?i.timestamp:new Date(i.timestamp);(!o||d<o)&&(o=d),(!n||d>n)&&(n=d)}),s.push(...c.values());const r={totalFiles:t.length,totalRecords:s.length,dateRange:{earliest:o,latest:n},files:a};return{mergedData:s,info:r}}function jt(t,s){var r,i,u,d,m;const a=`${s}-${t.length}`,o=it(Z),n=o.get(a);if(n)return n;const c=t.split(`
`),l=[];for(let x=1;x<c.length;x++){const h=c[x].trim();if(h)try{const f=_e(h);if(f.length<14)continue;const w=(r=f[6])==null?void 0:r.replace(/"/g,"").trim(),P=(i=f[7])==null?void 0:i.replace(/"/g,"").replace(/,/g,"").trim(),y=(u=f[8])==null?void 0:u.replace(/"/g,"").trim(),k=(d=f[9])==null?void 0:d.replace(/"/g,"").trim(),v=(m=f[5])==null?void 0:m.replace(/"/g,"").trim();if(!w||w===""||w==="[")continue;const j=parseInt(P);if(isNaN(j)||j<=0)continue;const D=parseFloat(y);if(isNaN(D)||D<=0)continue;const p=U(v);if(!p)continue;l.push({ticker:w,quantity:j,price:D,totalValue:k,timestamp:p.toISOString(),sourceFile:s})}catch{continue}}return o.set(a,l),nt(Z,o),l}function _e(t){const s=[];let a="",o=!1;for(let n=0;n<t.length;n++){const c=t[n];c==='"'?o=!o:c===","&&!o?(s.push(a),a=""):a+=c}return s.push(a),s}function be(t){const s=[];let a=0,o=null,n=null;const c=t.map(l=>{const r=jt(l.data,l.filename);return s.push(...r),a+=r.length,r.forEach(i=>{const u=new Date(i.timestamp);(!o||u<o)&&(o=u),(!n||u>n)&&(n=u)}),{filename:l.filename,recordCount:r.length,timestamp:l.timestamp}});return s.sort((l,r)=>new Date(r.timestamp).getTime()-new Date(l.timestamp).getTime()),{mergedData:s,info:{totalFiles:t.length,totalRecords:a,dateRange:{earliest:o,latest:n},files:c}}}function Nt(t){const s=`${t.length}_${t.slice(0,3).map(l=>`${l.ticker}_${l.timestamp}`).join("_")}`,a=dt(te),o=a.get(s);if(o)return o;const n=new Map;t.forEach(l=>{const r=n.get(l.ticker)||{ticker:l.ticker,totalQuantity:0,totalValue:0,tradeCount:0,lastActivityDate:null,largestTrade:null};r.totalQuantity+=l.quantity,r.totalValue+=l.quantity*l.price,r.tradeCount+=1;const i=new Date(l.timestamp);(!r.lastActivityDate||i>r.lastActivityDate)&&(r.lastActivityDate=i),(!r.largestTrade||l.quantity>r.largestTrade.quantity)&&(r.largestTrade={quantity:l.quantity,price:l.price,totalValue:l.totalValue,timestamp:l.timestamp}),n.set(l.ticker,r)});const c=Array.from(n.values()).map(l=>({...l,averagePrice:l.totalValue/l.totalQuantity,lastActivity:l.lastActivityDate?l.lastActivityDate.toLocaleString():"Unknown"})).sort((l,r)=>r.totalValue-l.totalValue);return a.set(s,c),mt(te,a),c}const wt=(t,s)=>{try{let a;if(s)a=s;else{const o=new Date,n=new Date(o.getFullYear(),o.getMonth(),o.getDate()),c={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},l=(i,u)=>{let d=parseInt(i);return u.toUpperCase()==="PM"&&d!==12?d+=12:u.toUpperCase()==="AM"&&d===12&&(d=0),d};let r=t.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(r){const[,,i,u,d,m,x,h]=r,f=c[i.toLowerCase()];if(f!==void 0){const w=l(m,h);a=new Date(parseInt(d),f,parseInt(u),w,parseInt(x))}else a=new Date(t)}else if(r=t.match(/Yesterday at (\d+):(\d+)\s+(AM|PM)/i)){const[,i,u,d]=r,m=l(i,d),x=new Date(n);x.setDate(x.getDate()-1),a=new Date(x.getFullYear(),x.getMonth(),x.getDate(),m,parseInt(u))}else if(r=t.match(/(\d+):(\d+)\s+(AM|PM)/i)){const[,i,u,d]=r,m=l(i,d);a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),m,parseInt(u))}else a=new Date(t)}return isNaN(a.getTime())?"":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" "+a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}},Le=g.memo(({tickers:t,onTickerSelect:s,allData:a})=>{const[o,n]=g.useState("recent"),c=r=>{const i=a.filter(m=>m.ticker===r),u=new Date;u.setHours(0,0,0,0);let d=0;return i.forEach(m=>{let x;try{const h=m.timestamp,f=new Date,w=new Date(f.getFullYear(),f.getMonth(),f.getDate()),P={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},y=(j,D)=>{let p=parseInt(j);return D.toUpperCase()==="PM"&&p!==12?p+=12:D.toUpperCase()==="AM"&&p===12&&(p=0),p};let k=h.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(k){const[,,j,D,p,N,T,M]=k,C=P[j.toLowerCase()];if(C!==void 0){const V=y(N,M);x=new Date(parseInt(p),C,parseInt(D),V,parseInt(T))}else return}else if(k=h.match(/Yesterday at (\d+):(\d+)\s+(AM|PM)/i)){const[,j,D,p]=k,N=y(j,p),T=new Date(w);T.setDate(T.getDate()-1),x=new Date(T.getFullYear(),T.getMonth(),T.getDate(),N,parseInt(D))}else if(k=h.match(/(\d+):(\d+)\s+(AM|PM)/i)){const[,j,D,p]=k,N=y(j,p);x=new Date(w.getFullYear(),w.getMonth(),w.getDate(),N,parseInt(D))}else return;x.setHours(0,0,0,0),Math.floor((u.getTime()-x.getTime())/(1e3*60*60*24))===0&&(d+=m.volume)}catch{}}),d},l=g.useMemo(()=>{const r=[...t];switch(o){case"recent":return r.sort((i,u)=>{const d=i.lastActivityDate instanceof Date?i.lastActivityDate:i.lastActivityDate?new Date(i.lastActivityDate):null,m=u.lastActivityDate instanceof Date?u.lastActivityDate:u.lastActivityDate?new Date(u.lastActivityDate):null;return d&&m?m.getTime()-d.getTime():0});case"oldest":return r.sort((i,u)=>{const d=i.lastActivityDate instanceof Date?i.lastActivityDate:i.lastActivityDate?new Date(i.lastActivityDate):null,m=u.lastActivityDate instanceof Date?u.lastActivityDate:u.lastActivityDate?new Date(u.lastActivityDate):null;return d&&m?d.getTime()-m.getTime():0});case"volume-high":return r.sort((i,u)=>u.totalVolume-i.totalVolume);case"volume-low":return r.sort((i,u)=>i.totalVolume-u.totalVolume);case"calls-high":return r.sort((i,u)=>u.callVolume-i.callVolume);case"puts-high":return r.sort((i,u)=>u.putVolume-i.putVolume);case"premium-high":return r.sort((i,u)=>u.totalPremium-i.totalPremium);case"premium-low":return r.sort((i,u)=>i.totalPremium-u.totalPremium);case"today-volume-high":return r.sort((i,u)=>c(u.ticker)-c(i.ticker));case"today-volume-low":return r.sort((i,u)=>c(i.ticker)-c(u.ticker));default:return r}},[t,o]);return e.jsxs("div",{className:"ticker-list",children:[e.jsxs("div",{className:"ticker-list-header",children:[e.jsx("div",{className:"header-content",children:e.jsx("h2",{children:"Options Volume Dashboard"})}),e.jsxs("div",{className:"sort-controls",children:[e.jsx(xe,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:o,onChange:r=>n(r.target.value),children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"volume-high",children:"Volume (High to Low)"}),e.jsx("option",{value:"volume-low",children:"Volume (Low to High)"}),e.jsx("option",{value:"today-volume-high",children:"Today's Volume (High to Low)"}),e.jsx("option",{value:"today-volume-low",children:"Today's Volume (Low to High)"}),e.jsx("option",{value:"calls-high",children:"Calls (High to Low)"}),e.jsx("option",{value:"puts-high",children:"Puts (High to Low)"}),e.jsx("option",{value:"premium-high",children:"Premium (High to Low)"}),e.jsx("option",{value:"premium-low",children:"Premium (Low to High)"})]})]})]}),e.jsx("div",{className:"ticker-grid",children:l.map(r=>{const i=r.callVolume>r.putVolume,u=r.putVolume>r.callVolume,d=i?"call-dominant":u?"put-dominant":"balanced";return e.jsxs("div",{className:`ticker-card ${d}`,onClick:()=>s(r.ticker),children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h3",{className:"ticker-symbol",children:r.ticker}),e.jsxs("div",{className:"ticker-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx(Ve,{className:"metric-icon call"}),e.jsx("span",{className:"metric-label",children:"Calls"}),e.jsx("span",{className:"metric-value",children:O(r.callVolume)})]}),e.jsxs("div",{className:"metric",children:[e.jsx(Pe,{className:"metric-icon put"}),e.jsx("span",{className:"metric-label",children:"Puts"}),e.jsx("span",{className:"metric-value",children:O(r.putVolume)})]})]})]}),e.jsxs("div",{className:"ticker-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Volume:"}),e.jsx("span",{className:"detail-value",children:O(r.totalVolume)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Premium:"}),e.jsx("span",{className:"detail-value",children:K(r.totalPremium)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(fe,{className:"detail-icon"}),e.jsx("span",{className:"detail-label",children:"Expiries:"}),e.jsx("span",{className:"detail-value",children:r.uniqueExpiries.length})]}),(()=>{const m=a.filter(y=>y.ticker===r.ticker),x=new Date,h=new Date(x.getFullYear(),x.getMonth(),x.getDate()),f=[0,0,0],w=[0,0,0],P=[0,0,0];return m.forEach(y=>{let k;try{const j=y.timestamp,D={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},p=(T,M)=>{let C=parseInt(T);return M.toUpperCase()==="PM"&&C!==12?C+=12:M.toUpperCase()==="AM"&&C===12&&(C=0),C};let N=j.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(N){const[,,T,M,C,V,$,A]=N,E=D[T.toLowerCase()];if(E!==void 0){const R=p(V,A);k=new Date(parseInt(C),E,parseInt(M),R,parseInt($))}else k=new Date(j)}else if(N=j.match(/Yesterday at (\d+):(\d+)\s+(AM|PM)/i)){const[,T,M,C]=N,V=p(T,C),$=new Date(h);$.setDate($.getDate()-1),k=new Date($.getFullYear(),$.getMonth(),$.getDate(),V,parseInt(M))}else if(N=j.match(/(\d+):(\d+)\s+(AM|PM)/i)){const[,T,M,C]=N,V=p(T,C);k=new Date(h.getFullYear(),h.getMonth(),h.getDate(),V,parseInt(M))}else k=new Date(j)}catch{return}k.setHours(0,0,0,0);const v=Math.floor((h.getTime()-k.getTime())/(1e3*60*60*24));v>=0&&v<=2&&(f[2-v]+=y.volume,y.optionType==="Call"?w[2-v]+=y.volume:P[2-v]+=y.volume)}),e.jsxs("div",{className:"detail-row volume-3day",children:[e.jsx("span",{className:"detail-label",children:"3-Day Volume:"}),e.jsxs("div",{className:"volume-breakdown",children:[e.jsxs("span",{className:"day-volume",children:[e.jsx("span",{className:"day-label",children:"Today:"}),e.jsx("span",{className:"day-value",children:O(f[2])})]}),e.jsxs("span",{className:"day-volume",children:[e.jsx("span",{className:"day-label",children:"-1:"}),e.jsx("span",{className:"day-value",children:O(f[1])})]}),e.jsxs("span",{className:"day-volume",children:[e.jsx("span",{className:"day-label",children:"-2:"}),e.jsx("span",{className:"day-value",children:O(f[0])})]})]})]})})()]}),(()=>{const m=a.filter(v=>v.ticker===r.ticker),x=new Date,h=new Date(x),f=new Date(x),w=x.getDay();h.setDate(x.getDate()-(w===0?6:w-1)),h.setHours(0,0,0,0),f.setDate(h.getDate()+6),f.setHours(23,59,59,999);const P=v=>{try{const j=v.split("/");if(j.length===3){const p=parseInt(j[0])-1,N=parseInt(j[1]),T=parseInt(j[2]);return new Date(T,p,N)}const D=v.match(/(\d{4})-(\d{2})-(\d{2})/);return D?new Date(parseInt(D[1]),parseInt(D[2])-1,parseInt(D[3])):null}catch{return null}},y=new Map;m.forEach(v=>{try{const j=P(v.expiry);if(!j)return;if(j>=h&&j<=f){const D=v.strike;y.has(D)||y.set(D,{volume:0,callVolume:0,putVolume:0,premium:0});const p=y.get(D);p.volume+=v.volume,p.premium+=ge(v.premium),v.optionType==="Call"?p.callVolume+=v.volume:p.putVolume+=v.volume}}catch{}});const k=Array.from(y.entries()).sort((v,j)=>j[1].volume-v[1].volume).slice(0,3);return k.length>0?e.jsx("div",{className:"ticker-analytics",children:e.jsxs("div",{className:"analytics-badge key-levels-badge",children:[e.jsx(Me,{size:12}),e.jsx("span",{className:"badge-label",children:"Top Strikes (Expiring This Week):"}),e.jsx("span",{className:"badge-strikes",children:k.map(([v,j],D)=>e.jsxs("span",{className:"level-strike level-high",title:`Strike: ${v}, Vol: ${O(j.volume)}, Premium: ${K(j.premium)}, Calls: ${O(j.callVolume)}, Puts: ${O(j.putVolume)}`,children:[D>0&&"","$",v," (Vol: ",O(j.volume),", Prem: ",K(j.premium),")"]},v))})]})}):null})(),r.lastTrade&&e.jsxs("div",{className:"detail-row last-trade-row",children:[e.jsx("span",{className:"detail-label",children:"Last Trade:"}),e.jsxs("span",{className:"detail-value last-trade",children:[r.lastTrade.optionType," $",r.lastTrade.strike,e.jsx("span",{className:`trade-side ${r.lastTrade.optionType.toLowerCase()}`,children:r.lastTrade.optionType==="Call"?"↗":"↘"}),O(r.lastTrade.volume),e.jsx("span",{className:"trade-timestamp",children:wt(r.lastTrade.timestamp)})]})]})]},r.ticker)})})]})});Le.displayName="TickerList";const pe=g.memo(({data:t,highestVolumeData:s,ticker:a,expiry:o,chartType:n,currentPrice:c,trades:l=[]})=>{const[r,i]=g.useState({visible:!1,x:0,y:0,content:null}),u=g.useCallback((p,N)=>N===0?0:Math.min(p/N*46,46),[]),d=g.useCallback((p,N)=>{const T=l.filter(S=>S.strike===p&&(!N||S.optionType===N)),M=T.reduce((S,F)=>S+F.volume,0),C=T.reduce((S,F)=>{const b=F.premium.replace(/[$,]/g,"");return S+(parseFloat(b)||0)},0),V=C>=1e6?(C/1e6).toFixed(2)+"M":C>=1e3?(C/1e3).toFixed(1)+"K":C.toFixed(0),$=C.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),A=[...new Set(T.map(S=>S.sweepType))].filter(Boolean),E=T.map(S=>S.volume).sort((S,F)=>F-S),R=[...new Set(T.map(S=>S.expiry))].sort(),L=M,I=T.sort((S,F)=>F.volume-S.volume).map(S=>({volume:S.volume,premium:S.premium,timestamp:S.timestamp,expiry:S.expiry}));return{strike:p,type:N,volume:M,trades:T.length,premium:V,premiumFull:$,sweepTypes:A,tradeVolumes:E,expiries:R,size:L,tradeDetails:I}},[l]),m=g.useCallback((p,N,T)=>{const M=p.currentTarget.getBoundingClientRect(),C=d(N,T);i({visible:!0,x:p.clientX,y:M.top-10,content:C})},[d]),x=g.useCallback(()=>{i(p=>({...p,visible:!1}))},[]),h=g.useCallback(p=>{i(N=>({...N,x:p.clientX}))},[]),f=g.useCallback(()=>c||(s==null?void 0:s.strike)||null,[c,s]),w=g.useCallback(p=>{const N=f();return N!==null&&Math.abs(p-N)<.01},[f]),y=g.useCallback(()=>t.sort((p,N)=>p.strike-N.strike),[t])(),k=g.useMemo(()=>{if(!y.length)return{maxVolume:0,minStrike:0,maxStrike:0,maxTotalVolume:0,totalVolumeSum:0};let p=0,N=0,T=1/0,M=-1/0,C=0;for(let V=0;V<y.length;V++){const $=y[V];p=Math.max(p,Math.max($.callVolume,$.putVolume)),N=Math.max(N,$.totalVolume),T=Math.min(T,$.strike),M=Math.max(M,$.strike),C+=$.totalVolume}return{maxVolume:p,minStrike:T===1/0?0:T,maxStrike:M===-1/0?0:M,maxTotalVolume:N,totalVolumeSum:C}},[y]),v=g.useCallback(p=>{if(!y.length||k.maxStrike===k.minStrike)return 50;const N=y.findIndex(C=>C.strike===p);if(N===-1)return 50;const T=y.length,M=100/(T+1);if(n==="callput"){const C=T-1-N;return M*(C+1)}else return M*(N+1)},[y,k,n]),j=g.useCallback(p=>{if(!y.length||k.maxStrike===k.minStrike)return 50;const N=k.minStrike,T=k.maxStrike,M=Math.max(N,Math.min(T,p));let C=N,V=T,$=0,A=y.length-1;for(let b=0;b<y.length-1;b++){const _=y[b].strike,H=y[b+1].strike;if(_<=M&&M<=H){C=_,V=H,$=b,A=b+1;break}}const E=y.length,R=100/(E+1);let L,I;if(n==="callput"){const b=E-1-$,_=E-1-A;L=R*(b+1),I=R*(_+1)}else L=R*($+1),I=R*(A+1);if(V===C)return L;const S=(M-C)/(V-C);return L+(I-L)*S},[y,k,n]),D=g.useCallback(()=>Math.max(400,y.length*18+40),[y.length]);return t.length?n==="callput"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"volume-profile-chart modern-mirrored-chart",children:[e.jsxs("div",{className:"chart-header modern-header",children:[e.jsxs("h3",{children:[a," Call/Put Volume"]}),e.jsxs("div",{className:"header-info",children:[f()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",f()]})]}),o&&e.jsx("span",{className:"expiry-date",children:o})]})]}),e.jsx("div",{className:"chart-container modern-container",children:e.jsxs("div",{className:"chart-area modern-chart-area",style:{height:`${D()}px`},children:[e.jsx("div",{className:"center-line"}),e.jsx("div",{className:"strike-axis modern-strike-axis",children:y.map(p=>e.jsx("div",{className:"strike-line modern-strike-line",style:{top:`${v(p.strike)}%`},children:e.jsx("span",{className:`strike-label modern-strike-label ${w(p.strike)?"current-price-label":""}`,children:p.strike})},p.strike))}),e.jsx("div",{className:"volume-bars modern-volume-bars",children:y.map(p=>e.jsxs("div",{className:"strike-row modern-strike-row",style:{top:`${v(p.strike)}%`},children:[e.jsx("div",{className:"volume-bar call-bar modern-call-bar",style:{width:`${u(p.callVolume,k.maxVolume)}%`,right:"52%"},onMouseEnter:N=>m(N,p.strike,"Call"),onMouseLeave:x,onMouseMove:h,children:p.callVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:O(p.callVolume)})}),e.jsx("div",{className:"volume-bar put-bar modern-put-bar",style:{width:`${u(p.putVolume,k.maxVolume)}%`,left:"52%"},onMouseEnter:N=>m(N,p.strike,"Put"),onMouseLeave:x,onMouseMove:h,children:p.putVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:O(p.putVolume)})})]},p.strike))}),f()&&e.jsx("div",{className:"current-price-line",style:{top:`${j(f())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"105%",top:"50%",transform:"translateY(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",f().toFixed(2)]})})]})})]}),r.visible&&r.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${r.x+15}px`,top:`${r.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>i(p=>({...p,visible:!0})),onMouseLeave:x,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",r.content.strike]}),r.content.type&&e.jsx("span",{className:`tooltip-type ${r.content.type.toLowerCase()}`,children:r.content.type})]}),e.jsx("div",{className:"tooltip-body",children:r.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:r.content.tradeDetails.map((p,N)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:p.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:p.premium})]}),p.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(p.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!p.timestamp)return"N/A";const T=new Date(p.timestamp);return isNaN(T.getTime())?p.timestamp:`${T.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${T.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return p.timestamp||"N/A"}})()})]})]},N))})]})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"volume-profile-chart total-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[a," Total Volume"]}),e.jsxs("div",{className:"header-info",children:[f()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",f()]})]}),o&&e.jsx("span",{className:"expiry-date",children:o})]})]}),e.jsxs("div",{className:"chart-container vertical",children:[e.jsxs("div",{className:"chart-area vertical",style:{height:`${D()}px`},children:[e.jsx("div",{className:"volume-bars vertical",children:y.map(p=>e.jsx("div",{className:"strike-column",style:{left:`${v(p.strike)}%`},children:e.jsx("div",{className:"volume-bar total-bar vertical",style:{height:`${u(p.totalVolume,k.maxTotalVolume)}%`},onMouseEnter:N=>m(N,p.strike),onMouseLeave:x,onMouseMove:h,children:p.totalVolume>0&&e.jsxs("span",{className:"volume-text volume-text-top",children:[O(p.totalVolume),e.jsxs("span",{className:"volume-percentage",children:["(",k.totalVolumeSum>0?(p.totalVolume/k.totalVolumeSum*100).toFixed(1):"0.0","%)"]})]})})},p.strike))}),f()&&e.jsx("div",{className:"current-price-line vertical",style:{left:`${j(f())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"50%",top:"-30px",transform:"translateX(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",f().toFixed(2)]})})]}),e.jsx("div",{className:"x-axis-labels",children:y.map(p=>e.jsx("div",{className:"x-axis-label",style:{left:`${v(p.strike)}%`},children:e.jsx("span",{className:`strike-label ${w(p.strike)?"current-price-label":""}`,children:p.strike})},p.strike))})]}),r.visible&&r.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${r.x+15}px`,top:`${r.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>i(p=>({...p,visible:!0})),onMouseLeave:x,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",r.content.strike]}),r.content.type&&e.jsx("span",{className:`tooltip-type ${r.content.type.toLowerCase()}`,children:r.content.type})]}),e.jsx("div",{className:"tooltip-body",children:r.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:r.content.tradeDetails.map((p,N)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:p.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:p.premium})]}),p.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(p.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!p.timestamp)return"N/A";const T=new Date(p.timestamp);return isNaN(T.getTime())?p.timestamp:`${T.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${T.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return p.timestamp||"N/A"}})()})]})]},N))})]})})]})]})}):e.jsxs("div",{className:"volume-profile-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[a," ",n==="callput"?"Call/Put Volume":"Total Volume"]}),o&&e.jsx("span",{className:"expiry-date",children:o})]}),e.jsx("div",{className:"no-data",children:e.jsxs("p",{children:["No volume data available for this ticker",o?" and expiry date":""]})})]})});pe.displayName="VolumeProfileChart";const Ie=g.memo(({trade:t})=>{const s=c=>{try{const l=c.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(l){const[,,i,u,,d,m,x]=l;let h=parseInt(d);x.toUpperCase()==="PM"&&h!==12?h+=12:x.toUpperCase()==="AM"&&h===12&&(h=0);const P=`${{january:"01",february:"02",march:"03",april:"04",may:"05",june:"06",july:"07",august:"08",september:"09",october:"10",november:"11",december:"12"}[i.toLowerCase()]||"01"}/${u.padStart(2,"0")}`,y=`${h.toString().padStart(2,"0")}:${m}`;return`${P} ${y}`}const r=new Date(c);return isNaN(r.getTime())?"Unknown":r.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit"})+" "+r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return"Unknown"}},n=(c=>{const l=c.replace(/[$,]/g,""),r=parseFloat(l);return c.includes("M")?r*1e6:c.includes("K")?r*1e3:r})(t.premium)>=1e6;return e.jsxs("div",{className:"trade-row-horizontal",style:{backgroundColor:t.optionType==="Call"?n?"rgba(0, 80, 0, 0.7)":"rgba(0, 100, 0, 0.5)":n?"rgba(100, 0, 0, 0.7)":"rgba(139, 0, 0, 0.5)"},children:[e.jsx("div",{className:"trade-cell-h symbol",children:t.ticker}),e.jsx("div",{className:"trade-cell-h strike",children:t.strike}),e.jsx("div",{className:"trade-cell-h expiry",children:new Date(t.expiry).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})}),e.jsx("div",{className:"trade-cell-h type",children:t.optionType}),e.jsx("div",{className:"trade-cell-h side",children:t.sweepType}),e.jsx("div",{className:"trade-cell-h size",children:O(t.volume)}),e.jsx("div",{className:"trade-cell-h premium",children:t.premium}),e.jsx("div",{className:"trade-cell-h volume",children:O(t.volume)}),e.jsx("div",{className:"trade-cell-h oi",children:O(t.openInterest)}),e.jsx("div",{className:"trade-cell-h exec-time",children:s(t.timestamp)})]})});Ie.displayName="TradeRow";const Re=g.memo(({trades:t,ticker:s,expiry:a})=>{const[o,n]=g.useState("trade-date"),c=g.useMemo(()=>[...t].sort((i,u)=>{switch(o){case"trade-date":{const d=U(i.timestamp),m=U(u.timestamp);return!d||!m?0:m.getTime()-d.getTime()}case"expiry-date":{const d=new Date(i.expiry),m=new Date(u.expiry);return d.getTime()-m.getTime()}case"size":return u.volume-i.volume;default:return 0}}),[t,o]),l=g.useMemo(()=>a?c.filter(i=>i.expiry===a):c,[c,a]);if(l.length===0)return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("h3",{children:[s," Trade History"]}),a&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(a).toLocaleDateString()]})]}),e.jsx("div",{className:"no-trades",children:e.jsxs("p",{children:["No trades found for ",s,a?` on ${new Date(a).toLocaleDateString()}`:""]})})]});const r=g.useCallback((i,u)=>`${i.ticker}-${i.strike}-${i.expiry}-${i.timestamp}-${u}`,[]);return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsxs("h3",{children:[s," Trade History"]}),a&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(a).toLocaleDateString()]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"sort-controls",children:[e.jsx(xe,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:o,onChange:i=>n(i.target.value),children:[e.jsx("option",{value:"trade-date",children:"Sort by Trade Date (Recent First)"}),e.jsx("option",{value:"expiry-date",children:"Sort by Expiry Date (Earliest First)"}),e.jsx("option",{value:"size",children:"Sort by Size (Largest First)"})]})]}),e.jsxs("div",{className:"trade-count",children:[l.length," trades"]})]})]}),e.jsx("div",{className:"trade-list-content",children:e.jsxs("div",{className:"trade-list-table",children:[e.jsxs("div",{className:"trade-table-header",children:[e.jsx("div",{className:"header-cell",children:"Symbol"}),e.jsx("div",{className:"header-cell",children:"Strike"}),e.jsx("div",{className:"header-cell",children:"Expiration"}),e.jsx("div",{className:"header-cell",children:"Call/Put"}),e.jsx("div",{className:"header-cell",children:"Side"}),e.jsx("div",{className:"header-cell",children:"Size"}),e.jsx("div",{className:"header-cell",children:"Premium"}),e.jsx("div",{className:"header-cell",children:"Volume"}),e.jsx("div",{className:"header-cell",children:"OI"}),e.jsx("div",{className:"header-cell",children:"Exec Time"})]}),e.jsx("div",{className:"trade-table-body",children:l.map((i,u)=>e.jsx(Ie,{trade:i,index:u},r(i,u)))})]})})]})});Re.displayName="TradeList";function kt(t){const s=t.includes("K"),a=t.includes("M"),o=t.replace(/[$,]/g,""),n=parseFloat(o);return a?n*1e6:s?n*1e3:n}const bt=({trades:t,currentPrice:s})=>{const{heatmapData:a,strikes:o,expiries:n,maxAbsValue:c}=g.useMemo(()=>{const m=new Map,x=new Set,h=new Set;t.forEach(y=>{const k=`${y.strike}_${y.expiry}`;x.add(y.strike),h.add(y.expiry),m.has(k)||m.set(k,{value:0,volume:0,callVolume:0,putVolume:0,trades:0});const v=m.get(k),j=kt(y.premium);Math.abs(j)<10&&y.ticker==="TSLA"&&console.log(`Small premium detected: ${y.ticker} ${y.strike} ${y.expiry} ${y.optionType} - Premium: "${y.premium}" -> Parsed: ${j}`),y.optionType==="Call"?(v.value+=j,v.callVolume+=y.volume):(v.value-=j,v.putVolume+=y.volume),v.volume+=y.volume,v.trades+=1});const f=Array.from(x).sort((y,k)=>k-y),w=Array.from(h).sort((y,k)=>{const v=new Date(y),j=new Date(k);return v.getTime()-j.getTime()});let P=0;return m.forEach(y=>{const k=Math.abs(y.value);k>P&&(P=k)}),{heatmapData:m,strikes:f,expiries:w,maxAbsValue:P}},[t]),l=(m,x)=>{if(x===0)return"rgba(255, 255, 255, 0.03)";const f=.2+Math.abs(m)/c*.6;return m>0?`rgba(76, 175, 80, ${f})`:`rgba(244, 67, 54, ${f})`},r=m=>{const x=Math.abs(m);return x>=1e6?`${m>=0?"":"-"}$${(x/1e6).toFixed(1)}M`:x>=1e3?`${m>=0?"":"-"}$${(x/1e3).toFixed(1)}K`:x>=1?`${m>=0?"":"-"}$${x.toFixed(0)}`:`${m>=0?"":"-"}$${x.toFixed(2)}`},i=m=>s?Math.abs(m-s)<2:!1,u=(m,x)=>`${m}_${x}`,d=o.length>0&&n.length>0;return e.jsxs("div",{className:"strike-expiry-heatmap",children:[e.jsxs("div",{className:"heatmap-header",children:[e.jsx("h3",{children:"Strike × Expiry Premium Heatmap"}),e.jsxs("div",{className:"heatmap-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(76, 175, 80, 0.6)"}}),e.jsx("span",{children:"Call Premium"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(244, 67, 54, 0.6)"}}),e.jsx("span",{children:"Put Premium"})]}),s&&e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(255, 193, 7, 0.4)",border:"2px solid #ffc107"}}),e.jsxs("span",{children:["Current Price (~$",s.toFixed(2),")"]})]})]})]}),e.jsx("div",{className:"heatmap-scroll-container",children:d?e.jsxs("table",{className:"heatmap-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"heatmap-corner",children:"Strike"}),n.map(m=>e.jsx("th",{className:"heatmap-expiry",children:new Date(m).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"})},m))]})}),e.jsx("tbody",{children:o.map(m=>{const x=i(m);return e.jsxs("tr",{className:x?"current-price-row":"",children:[e.jsxs("td",{className:`heatmap-strike ${x?"at-money":""}`,children:[m.toFixed(1),x&&e.jsx("span",{className:"atm-indicator",children:"▶"})]}),n.map(h=>{const f=a.get(u(m,h)),w=f&&f.volume>0;return e.jsx("td",{className:`heatmap-cell ${w?"has-data":""} ${x?"at-money-cell":""}`,style:{background:w?l(f.value,f.volume):void 0},title:w?`Strike: $${m}
Expiry: ${h}
Net Premium: ${r(f.value)}
Volume: ${f.volume}
Calls: ${f.callVolume}
Puts: ${f.putVolume}
Trades: ${f.trades}`:void 0,children:w&&e.jsx("div",{className:"cell-content",children:e.jsx("span",{className:"cell-value",children:r(f.value)})})},`${m}_${h}`)})]},m)})})]}):e.jsxs("div",{className:"heatmap-no-data",children:[e.jsx("p",{children:"No heatmap data available"}),e.jsx("p",{children:"Select a ticker with options data to view the heatmap"})]})})]})};function St(t){const s=t.replace(/[$,K]/g,""),a=parseFloat(s);return t.includes("K")?a*1e3:t.includes("M")?a*1e6:a}function Oe(t){const{callPutRatio:s,premiumCallPutRatio:a,sweepCount:o,unusualSweepCount:n,highlyUnusualSweepCount:c,totalVolume:l,totalTrades:r}=t;let i="neutral";s>1.5&&a>1.3?i="bullish":s<.7&&a<.8?i="bearish":Math.abs(s-1)<.3&&Math.abs(a-1)<.3?i="neutral":i="mixed";let u="low";const d=o+n+c;d>5||c>0||l>5e4?u="high":(d>2||n>0||l>2e4)&&(u="medium");let m="low";r>20||l>3e4?m="high":(r>10||l>15e3)&&(m="medium");let x="low";c>0||d>8?x="high":(n>0||d>3)&&(x="medium");let h="";return i==="bullish"?h=`Strong bullish sentiment with ${s.toFixed(1)}:1 call/put ratio`:i==="bearish"?h=`Strong bearish sentiment with ${(1/s).toFixed(1)}:1 put/call ratio`:i==="mixed"?h="Mixed sentiment with conflicting signals":h="Neutral sentiment with balanced activity",x==="high"?h+=` and high sweep activity (${d} sweeps)`:x==="medium"&&(h+=` and moderate sweep activity (${d} sweeps)`),m==="high"?h+=" - High volume trading":m==="medium"&&(h+=" - Moderate activity"),{sentiment:i,confidence:u,activity:m,sweepIntensity:x,description:h}}function Tt(t){return t>=9.5&&t<=16.25}function He(){const t=[];for(let s=9.5;s<=16.25;s+=.5)t.push(s);return t}function Dt(t,s){const a=new Map;return He().forEach(n=>{a.set(n,{totalVolume:0,callVolume:0,putVolume:0,totalTrades:0,callTrades:0,putTrades:0,totalPremium:0,callPremium:0,putPremium:0,sweepCount:0,unusualSweepCount:0,highlyUnusualSweepCount:0,trades:[]})}),t.forEach(n=>{const c=U(n.timestamp);if(c&&c.getFullYear()===s.getFullYear()&&c.getMonth()===s.getMonth()&&c.getDate()===s.getDate()){const l=c.getHours()+c.getMinutes()/60;if(!Tt(l))return;const r=Math.round(l*2)/2,i=a.get(r);if(!i)return;i.trades.push(n),i.totalVolume+=n.volume,i.totalTrades+=1;const u=St(n.premium);if(i.totalPremium+=u,n.optionType==="Call"?(i.callVolume+=n.volume,i.callTrades+=1,i.callPremium+=u):(i.putVolume+=n.volume,i.putTrades+=1,i.putPremium+=u),n.sweepType){const d=n.sweepType.toLowerCase();d.includes("highly unusual")?i.highlyUnusualSweepCount+=1:d.includes("unusual")?i.unusualSweepCount+=1:d.includes("sweep")&&(i.sweepCount+=1)}}}),Array.from(a.entries()).map(([n,c])=>{const l=c.putVolume>0?c.callVolume/c.putVolume:c.callVolume,r=c.putPremium>0?c.callPremium/c.putPremium:c.callPremium,i=c.totalTrades>0?c.totalVolume/c.totalTrades:0,u={hour:n,totalVolume:c.totalVolume,callVolume:c.callVolume,putVolume:c.putVolume,totalTrades:c.totalTrades,callTrades:c.callTrades,putTrades:c.putTrades,totalPremium:c.totalPremium,callPremium:c.callPremium,putPremium:c.putPremium,sweepCount:c.sweepCount,unusualSweepCount:c.unusualSweepCount,highlyUnusualSweepCount:c.highlyUnusualSweepCount,avgTradeSize:i,callPutRatio:l,premiumCallPutRatio:r,trades:c.trades,psychology:{sentiment:"neutral",confidence:"low",activity:"low",sweepIntensity:"low",description:""}};return u.psychology=Oe(u),u}).filter(n=>n!=null).sort((n,c)=>n.hour-c.hour)}function Ct(t,s){const a=Dt(t,s);if(!a||a.length===0)return{date:s.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),dayOfWeek:s.toLocaleDateString("en-US",{weekday:"long"}),hourlyData:[],dailySummary:{totalVolume:0,totalTrades:0,totalPremium:0,callPutRatio:0,peakVolume:0,peakHour:0,peakTrades:0,sweepCount:0,uniqueExpiries:[],psychology:{sentiment:"neutral",confidence:"low",activity:"low",sweepIntensity:"low",description:"No trading data available"}}};const o=a.reduce((d,m)=>(d.totalVolume+=m.totalVolume,d.totalTrades+=m.totalTrades,d.totalPremium+=m.totalPremium,d.sweepCount+=m.sweepCount+m.unusualSweepCount+m.highlyUnusualSweepCount,m.totalVolume>d.peakVolume&&(d.peakVolume=m.totalVolume,d.peakHour=m.hour),m.totalTrades>d.peakTrades&&(d.peakTrades=m.totalTrades),d),{totalVolume:0,totalTrades:0,totalPremium:0,callPutRatio:0,sweepCount:0,uniqueExpiries:[],psychology:{sentiment:"neutral",confidence:"low",activity:"low",sweepIntensity:"low",description:""},peakHour:0,peakVolume:0,peakTrades:0}),n=a.reduce((d,m)=>d+m.callVolume,0),c=a.reduce((d,m)=>d+m.putVolume,0);o.callPutRatio=c>0?n/c:n;const l=new Set;t.forEach(d=>{const m=U(d.timestamp);m&&m.toISOString().split("T")[0]===s.toISOString().split("T")[0]&&l.add(d.expiry)}),o.uniqueExpiries=Array.from(l).sort((d,m)=>new Date(d).getTime()-new Date(m).getTime());const r={hour:0,totalVolume:o.totalVolume,callVolume:n,putVolume:c,totalTrades:o.totalTrades,callTrades:a.reduce((d,m)=>d+m.callTrades,0),putTrades:a.reduce((d,m)=>d+m.putTrades,0),totalPremium:o.totalPremium,callPremium:a.reduce((d,m)=>d+m.callPremium,0),putPremium:a.reduce((d,m)=>d+m.putPremium,0),sweepCount:a.reduce((d,m)=>d+m.sweepCount,0),unusualSweepCount:a.reduce((d,m)=>d+m.unusualSweepCount,0),highlyUnusualSweepCount:a.reduce((d,m)=>d+m.highlyUnusualSweepCount,0),avgTradeSize:o.totalTrades>0?o.totalVolume/o.totalTrades:0,callPutRatio:o.callPutRatio,premiumCallPutRatio:0,trades:t.filter(d=>{const m=U(d.timestamp);return m&&m.toISOString().split("T")[0]===s.toISOString().split("T")[0]}),psychology:{sentiment:"neutral",confidence:"low",activity:"low",sweepIntensity:"low",description:""}};o.psychology=Oe(r);const i=s.toISOString().split("T")[0],u=s.toLocaleDateString("en-US",{weekday:"long"});return{date:i,dayOfWeek:u,hourlyData:a,dailySummary:o}}function Se(t){const s=new Date(t);return s.setDate(t.getDate()-1),s.getDay()===0?s.setDate(s.getDate()-2):s.getDay()===6&&s.setDate(s.getDate()-1),s}function $t(t){const s=t.getDay();return s>=1&&s<=5}function Vt(t){let s=new Date(0);return t.forEach(a=>{const o=U(a.timestamp);o&&o>s&&(s=o)}),s}function Pt(t){const s=[],a=Vt(t);let o=new Date(a);$t(o)||(o=Se(o));for(let l=0;l<5;l++){const r=new Date(o);r.setHours(0,0,0,0);const i=Ct(t,r);s.push(i),o=Se(o)}s.reverse();const n=Mt(s),c=At(s);return{days:s,overallTrend:n,hourlyPatterns:c}}function Mt(t){if(t.length===0)return{sentiment:"neutral",confidence:"low",activity:"stable",description:"No data available"};const s=t.map(x=>x.dailySummary.psychology.sentiment),a=t.map(x=>x.dailySummary.totalVolume),o=t.map(x=>x.dailySummary.psychology.confidence),n=s.reduce((x,h)=>(x[h]=(x[h]||0)+1,x),{}),c=Object.entries(n).sort(([,x],[,h])=>h-x)[0][0],l=o.filter(x=>x==="high").length,r=l>=2?"high":l>=1?"medium":"low",i=a[a.length-1]-a[0],u=a.reduce((x,h)=>x+h,0)/a.length,d=i>u*.2?"increasing":i<-u*.2?"decreasing":"stable";let m=`Overall ${c} sentiment over 5 trading days`;return r==="high"?m+=" with high confidence":r==="medium"&&(m+=" with moderate confidence"),d==="increasing"?m+=" and increasing activity":d==="decreasing"?m+=" and decreasing activity":m+=" with stable activity",{sentiment:c,confidence:r,activity:d,description:m}}function At(t){const s={},a=He();return a.forEach(o=>{s[o]={avgVolume:0,avgTrades:0,sentiment:"neutral",consistency:0}}),a.forEach(o=>{const n=t.map(x=>x.hourlyData.find(h=>h.hour===o)).filter(x=>x!==void 0);if(n.length===0)return;const c=n.reduce((x,h)=>x+h.totalVolume,0)/n.length,l=n.reduce((x,h)=>x+h.totalTrades,0)/n.length,i=n.map(x=>x.psychology.sentiment).reduce((x,h)=>(x[h]=(x[h]||0)+1,x),{}),u=Object.entries(i).sort(([,x],[,h])=>h-x)[0][0],m=Math.max(...Object.values(i))/n.length;s[o]={avgVolume:c,avgTrades:l,sentiment:u,consistency:m}}),s}function Et(t){const s=t.getDay(),a=t.getDate()-s+(s===0?-6:1);return new Date(t.setDate(a))}function Ft(t){const s=new Date(t);return s.setDate(t.getDate()+4),s}function ce(t){return t.toISOString().split("T")[0]}function _t(t){const{callPutRatio:s,premiumCallPutRatio:a,sweepCount:o,unusualSweepCount:n,highlyUnusualSweepCount:c,totalVolume:l,totalTrades:r}=t;let i="neutral";s>1.5&&a>1.3?i="bullish":s<.7&&a<.8?i="bearish":Math.abs(s-1)<.3&&Math.abs(a-1)<.3?i="neutral":i="mixed";let u="low";l>1e5||r>1e3?u="high":(l>1e4||r>100)&&(u="medium");let d="low";const m=o+n+c;m>50||c>10?d="high":(m>10||n>5)&&(d="medium");let x="low";const h=5e4,f=500;l>h&&r>f&&m>20?x="high":l>h/2&&r>f/2&&m>5&&(x="medium");let w="";return i==="bullish"?w=`Strong bullish sentiment with ${s.toFixed(1)}:1 call/put ratio and high call premium dominance`:i==="bearish"?w=`Bearish sentiment with ${s.toFixed(1)}:1 call/put ratio indicating put buying pressure`:i==="neutral"?w="Balanced sentiment with neutral call/put ratios around 1:1":w="Mixed sentiment with varying call/put ratios indicating uncertainty",d==="high"?w+=` and high sweep activity (${m} sweeps)`:d==="medium"&&(w+=" with moderate sweep activity"),{sentiment:i,confidence:x,activity:u,sweepIntensity:d,description:w}}function Ue(t){const s=new Map;t.forEach(o=>{s.has(o.ticker)||s.set(o.ticker,[]),s.get(o.ticker).push(o)});const a=[];return s.forEach((o,n)=>{const c=new Map;o.forEach(h=>{const f=U(h.timestamp);if(f){const w=Et(new Date(f)),P=ce(w);c.has(P)||c.set(P,[]),c.get(P).push(h)}});const l=[];c.forEach((h,f)=>{const w=new Date(f),P=Ft(new Date(w)),y=h.reduce((b,_)=>b+_.volume,0),k=h.filter(b=>b.optionType==="Call"),v=h.filter(b=>b.optionType==="Put"),j=k.reduce((b,_)=>b+_.volume,0),D=v.reduce((b,_)=>b+_.volume,0),p=h.length,N=k.length,T=v.length,M=h.reduce((b,_)=>{const H=parseFloat(_.premium.replace(/[$,]/g,""));return b+(isNaN(H)?0:H)},0),C=k.reduce((b,_)=>{const H=parseFloat(_.premium.replace(/[$,]/g,""));return b+(isNaN(H)?0:H)},0),V=v.reduce((b,_)=>{const H=parseFloat(_.premium.replace(/[$,]/g,""));return b+(isNaN(H)?0:H)},0),$=D>0?j/D:j,A=V>0?C/V:C,E=h.filter(b=>b.sweepType&&b.sweepType.toLowerCase().includes("sweep")).length,R=h.filter(b=>b.sweepType&&b.sweepType.toLowerCase().includes("unusual")).length,L=h.filter(b=>b.sweepType&&b.sweepType.toLowerCase().includes("highly unusual")).length,I=p>0?y/p:0,S=[...new Set(h.map(b=>b.expiry))],F=_t({callPutRatio:$,premiumCallPutRatio:A,totalVolume:y,totalTrades:p,sweepCount:E,unusualSweepCount:R,highlyUnusualSweepCount:L,avgTradeSize:I});l.push({weekStart:ce(w),weekEnd:ce(P),ticker:n,totalVolume:y,callVolume:j,putVolume:D,totalTrades:p,callTrades:N,putTrades:T,totalPremium:M,callPremium:C,putPremium:V,callPutRatio:$,premiumCallPutRatio:A,sweepCount:E,unusualSweepCount:R,highlyUnusualSweepCount:L,avgTradeSize:I,uniqueExpiries:S,psychology:F})}),l.sort((h,f)=>{const w=new Date(h.weekStart);return new Date(f.weekStart).getTime()-w.getTime()});const r=l.map(h=>h.psychology.sentiment),i=r.reduce((h,f)=>(h[f]=(h[f]||0)+1,h),{}),u=Object.entries(i).sort(([,h],[,f])=>f-h)[0][0];let d="stable";if(l.length>=2){const h=l[0].psychology.sentiment,f=l[1].psychology.sentiment;h==="bullish"&&f!=="bullish"||h==="bearish"&&f!=="bearish"?d="improving":(h==="bearish"&&f==="bullish"||h==="neutral"&&f==="bullish")&&(d="declining")}const m=Math.max(...Object.values(i)),x=m/r.length>.7?"high":m/r.length>.5?"medium":"low";a.push({ticker:n,weeks:l,overallSentiment:u,trendDirection:d,confidence:x})}),a.sort((o,n)=>{const c=o.weeks.reduce((r,i)=>r+i.totalVolume,0);return n.weeks.reduce((r,i)=>r+i.totalVolume,0)-c}),a}const Lt=({ticker:t,trades:s})=>{const[a,o]=g.useState(0),[n,c]=g.useState({visible:!1,x:0,y:0,content:null}),l=g.useMemo(()=>!s||s.length===0?null:Pt(s),[s]),r=(d,m)=>{const x=d.currentTarget.getBoundingClientRect();c({visible:!0,x:x.left+x.width/2,y:x.top,content:m})},i=()=>{c(d=>({...d,visible:!1}))};if(!l||l.days.length===0)return e.jsxs("div",{className:"ticker-psychology-analysis",children:[e.jsxs("div",{className:"psychology-header",children:[e.jsxs("h3",{children:[t," Trade Psychology"]}),e.jsx("p",{children:"5-Day Trading Psychology Analysis"})]}),e.jsx("div",{className:"no-data",children:e.jsxs("p",{children:["No trade data available for ",t," psychology analysis"]})})]});const u=l.days[a];return e.jsxs("div",{className:"ticker-psychology-analysis",children:[e.jsxs("div",{className:"psychology-header",children:[e.jsxs("h3",{children:[t," Trade Psychology"]}),e.jsx("p",{children:"5-Day Trading Psychology Analysis"}),e.jsxs("div",{className:"overall-trend",children:[e.jsxs("div",{className:`trend-indicator ${l.overallTrend.sentiment}`,children:[e.jsx("span",{className:"trend-sentiment",children:l.overallTrend.sentiment.toUpperCase()}),e.jsxs("span",{className:"trend-confidence",children:[l.overallTrend.confidence," confidence"]})]}),e.jsx("p",{className:"trend-description",children:l.overallTrend.description})]})]}),e.jsx("div",{className:"four-day-layout",children:l.days.map((d,m)=>e.jsx(It,{day:d,isSelected:m===a,onClick:()=>o(m),index:m},d.date))}),e.jsxs("div",{className:"hourly-chart",children:[e.jsxs("h4",{children:["Hourly Breakdown: ",u.dayOfWeek,", ",u.date]}),e.jsx("div",{className:"chart-container",children:e.jsx("div",{className:"chart-grid",children:u.hourlyData.map(d=>e.jsx(Rt,{hourData:d,maxVolume:Math.max(...u.hourlyData.map(m=>m.totalVolume)),onMouseEnter:m=>r(m,d),onMouseLeave:i},d.hour))})})]}),n.visible&&n.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${n.x+15}px`,top:`${n.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>c(d=>({...d,visible:!0})),onMouseLeave:i,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsx("span",{className:"tooltip-strike",children:ye(n.content.hour)}),e.jsx("span",{className:`tooltip-type ${n.content.psychology.sentiment}`,children:n.content.psychology.sentiment.toUpperCase()})]}),e.jsxs("div",{className:"tooltip-body",children:[e.jsxs("div",{className:"tooltip-section",children:[e.jsx("div",{className:"tooltip-section-title",children:"Summary"}),e.jsxs("div",{className:"tooltip-row",children:[e.jsx("span",{className:"tooltip-label",children:"Total Volume"}),e.jsx("span",{className:"tooltip-value",children:q(n.content.totalVolume)})]}),e.jsxs("div",{className:"tooltip-row",children:[e.jsx("span",{className:"tooltip-label",children:"Total Trades"}),e.jsx("span",{className:"tooltip-value",children:n.content.totalTrades})]}),e.jsxs("div",{className:"tooltip-row",children:[e.jsx("span",{className:"tooltip-label",children:"Call/Put Ratio"}),e.jsxs("span",{className:"tooltip-value",children:[n.content.callPutRatio.toFixed(2),":1"]})]}),e.jsxs("div",{className:"tooltip-row",children:[e.jsx("span",{className:"tooltip-label",children:"Total Premium"}),e.jsx("span",{className:"tooltip-value",children:K(n.content.totalPremium)})]})]}),n.content.trades&&n.content.trades.length>0&&e.jsxs("div",{className:"tooltip-section",children:[e.jsx("div",{className:"tooltip-section-title",children:"Individual Trades"}),e.jsxs("div",{className:"trades-list",children:[n.content.trades.slice(0,5).map((d,m)=>e.jsxs("div",{className:`trade-item ${d.optionType.toLowerCase()}-trade`,children:[e.jsxs("div",{className:"trade-header",children:[e.jsx("span",{className:`trade-type ${d.optionType.toLowerCase()}`,children:d.optionType}),e.jsxs("span",{className:"trade-strike",children:["$",d.strike]}),e.jsx("span",{className:"trade-expiry",children:new Date(d.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"trade-details",children:[e.jsxs("span",{className:"trade-volume",children:["Vol: ",d.volume]}),e.jsxs("span",{className:"trade-premium",children:["Premium: ",K(ge(d.premium))]}),d.sweepType&&e.jsx("span",{className:"trade-sweep",children:d.sweepType})]}),e.jsx("div",{className:"trade-time",children:new Date(U(d.timestamp)||d.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]},m)),n.content.trades.length>5&&e.jsxs("div",{className:"more-trades",children:["+",n.content.trades.length-5," more trades"]})]})]})]})]})]})},It=({day:t,isSelected:s,onClick:a})=>e.jsxs("div",{className:`day-column ${s?"selected":""}`,onClick:a,children:[e.jsxs("div",{className:"day-header",children:[e.jsx("h4",{children:t.dayOfWeek}),e.jsx("p",{className:"day-date-short",children:t.date})]}),e.jsxs("div",{className:"day-metrics",children:[e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Volume"}),e.jsx("span",{className:"metric-value",children:q(t.dailySummary.totalVolume)})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Trades"}),e.jsx("span",{className:"metric-value",children:t.dailySummary.totalTrades})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"C/P Ratio"}),e.jsx("span",{className:"metric-value",children:t.dailySummary.callPutRatio.toFixed(1)})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Sweeps"}),e.jsx("span",{className:"metric-value",children:t.dailySummary.sweepCount})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Premium"}),e.jsx("span",{className:"metric-value",children:K(t.dailySummary.totalPremium)})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Expiries"}),e.jsx("span",{className:"metric-value",children:t.dailySummary.uniqueExpiries.length})]})]}),e.jsxs("div",{className:`psychology-indicator ${t.dailySummary.psychology.sentiment}`,children:[e.jsx("span",{className:"psychology-sentiment",children:t.dailySummary.psychology.sentiment.toUpperCase()}),e.jsx("span",{className:"psychology-confidence",children:t.dailySummary.psychology.confidence})]}),e.jsx("div",{className:"mini-chart",children:t.hourlyData.map(o=>e.jsx("div",{className:`mini-hour-bar ${o.psychology.sentiment}`,style:{height:`${Math.max(2,o.totalVolume/Math.max(...t.hourlyData.map(n=>n.totalVolume))*100)}%`},title:`${ye(o.hour)}: ${q(o.totalVolume)} volume, ${o.psychology.sentiment} sentiment`},o.hour))})]}),Rt=({hourData:t,maxVolume:s,onMouseEnter:a,onMouseLeave:o})=>{const n=s>0?t.totalVolume/s*100:0,c=t.totalVolume>0;return e.jsxs("div",{className:"hour-bar-container",children:[e.jsx("div",{className:"hour-label",children:ye(t.hour)}),e.jsx("div",{className:"hour-bar-wrapper",children:e.jsx("div",{className:`hour-bar ${c?`${t.psychology.sentiment} ${t.psychology.activity}`:"no-trades"}`,style:c?{height:`${Math.max(5,n)}%`}:{},onMouseEnter:c?a:void 0,onMouseLeave:c?o:void 0,children:e.jsxs("div",{className:"bar-content",children:[e.jsxs("div",{className:"volume-info",children:[e.jsx("span",{className:"volume",children:q(t.totalVolume)}),e.jsx("span",{className:"trades",children:t.totalTrades})]}),e.jsxs("div",{className:"call-put-info",children:[e.jsxs("span",{className:"call-volume",children:["C: ",q(t.callVolume)]}),e.jsxs("span",{className:"put-volume",children:["P: ",q(t.putVolume)]})]})]})})}),e.jsxs("div",{className:"hour-details",children:[e.jsxs("div",{className:"cp-ratio",children:["C/P: ",t.callPutRatio.toFixed(1)]}),e.jsxs("div",{className:"volume-breakdown",children:["C: ",q(t.callVolume)," | P: ",q(t.putVolume)]})]})]})};function q(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function ye(t){const s=t%1===.5,a=Math.floor(t);return a===0?s?"12:30AM":"12AM":a<12?s?`${a}:30AM`:`${a}AM`:a===12?s?"12:30PM":"12PM":s?`${a-12}:30PM`:`${a-12}PM`}function ve(t){try{const s=t.match(/(?:options_data|option_data|darkpool_data)_(\d{4}-\d{2}-\d{2})_(\d{2}-\d{2})\.csv/);if(!s)return null;const[,a,o]=s,[n,c,l]=a.split("-").map(Number),[r,i]=o.split("-").map(Number);return new Date(n,c-1,l,r,i)}catch{return null}}async function Ot(){try{const a=await fetch("/optionAnalysis/api/data-files.json");if(a.ok){const o=await a.json();if(Array.isArray(o)&&o.length>0)return o.map(n=>({filename:n.name,timestamp:new Date(n.timestamp),size:n.size}))}}catch{}return["options_data_2025-10-21_16-51.csv","options_data_2025-10-21_15-00.csv","options_data_2025-10-20_16-00.csv","options_data_2025-10-17_15-45.csv","options_data_2025-10-15_TSLA.csv","options_data_2025-10-16_16-00.csv","options_data_2025-10-16_15-00.csv","options_data_2025-10-16_12-00.csv","options_data_2025-10-16_10-30.csv","options_data_2025-10-15_16-00.csv","options_data_2025-10-15_14-00.csv","options_data_2025-10-15_11-30.csv","options_data_2025-10-15_10-00.csv","options_data_2025-10-14_16-00.csv","options_data_2025-10-14_15-00.csv","options_data_2025-10-14_11-00.csv","options_data_2025-10-14_01-00.csv","options_data_2025-10-13_13-20.csv","options_data_2025-10-13_13-00.csv","options_data_2025-10-13_10-50.csv","options_data_2025-10-13_10-00.csv","options_data_2025-10-13_05-30.csv","options_data_2024-01-15_16-00.csv","options_data_2024-01-15_11-30.csv","options_data_2024-01-15_11-00.csv","options_data_2024-01-15_10-00.csv","options_data_2024-01-15_02-30.csv"].map(s=>({filename:s,timestamp:ve(s)||new Date,size:0})).sort((s,a)=>a.timestamp.getTime()-s.timestamp.getTime())}async function Ht(){return["darkpool_data_2025-10-17_15-00.csv"].map(s=>({filename:s,timestamp:ve(s)||new Date,size:0})).sort((s,a)=>a.timestamp.getTime()-s.timestamp.getTime())}async function ae(t,s=!1){try{const a=s?`?t=${Date.now()}`:"",n=await fetch(`/optionAnalysis/data/${t}${a}`,{cache:s?"no-store":"default",headers:{"Cache-Control":s?"no-cache, no-store, must-revalidate":"default",Pragma:s?"no-cache":"default"}});if(!n.ok)throw new Error(`Failed to load ${t}: ${n.status} ${n.statusText}`);const c=await n.text(),l=ve(t);return{filename:t,timestamp:l||new Date,data:c}}catch(a){return{filename:t,timestamp:new Date,data:"",error:a instanceof Error?a.message:"Unknown error"}}}const W="optionAnalysis_fileCache",J="optionAnalysis_darkPoolFileCache",qe=5*60*1e3;function Be(t){try{const s=sessionStorage.getItem(t);if(s){const a=JSON.parse(s),o=new Map;for(const[n,c]of Object.entries(a))o.set(n,c);return o}}catch{}return new Map}function re(t,s){try{const a=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(a))}catch{}}function le(t){try{sessionStorage.removeItem(t)}catch{}}function Ut(){le(W),le(J)}function qt(){le(W)}function Bt(){le(J)}async function ie(t=!1){try{const s=await Ot(),a=Date.now(),o=Be(W);if(t){const d=s.map(h=>ae(h.filename,!0)),m=await Promise.all(d);return m.forEach(h=>{h.error||o.set(h.filename,{data:h,timestamp:a})}),re(W,o),m.filter(h=>!h.error)}const n=[],c=[];s.forEach(d=>{const m=o.get(d.filename);m&&a-m.timestamp<qe?n.push(m.data):c.push(d.filename)});let l=[];if(c.length>0){const d=c.map(m=>ae(m,!1));l=await Promise.all(d),l.forEach(m=>{m.error||o.set(m.filename,{data:m,timestamp:a})}),re(W,o)}const r=[...n,...l],i=r.filter(d=>!d.error),u=r.filter(d=>d.error);return i}catch(s){return console.error("Failed to load data files:",s),[]}}async function Te(t=!1){try{const s=await Ht(),a=Date.now(),o=Be(J);if(t){const d=s.map(h=>ae(h.filename,!0)),m=await Promise.all(d);return m.forEach(h=>{h.error||o.set(h.filename,{data:h,timestamp:a})}),re(J,o),m.filter(h=>!h.error)}const n=[],c=[];s.forEach(d=>{const m=o.get(d.filename);m&&a-m.timestamp<qe?n.push(m.data):c.push(d.filename)});let l=[];if(c.length>0){const d=c.map(m=>ae(m,!1));l=await Promise.all(d),l.forEach(m=>{m.error||o.set(m.filename,{data:m,timestamp:a})}),re(J,o)}const r=[...n,...l],i=r.filter(d=>!d.error),u=r.filter(d=>d.error);return i}catch(s){return console.error("Failed to load dark pool data files:",s),[]}}async function Kt(t){var a,o,n,c;const s="d3mgi7hr01qmso33ob30d3mgi7hr01qmso33ob3g";try{const l=`https://finnhub.io/api/v1/quote?symbol=${t}&token=${s}`,r=await fetch(l);if(r.ok){const i=await r.json(),u=i==null?void 0:i.c;if(u&&typeof u=="number"&&u>0)return u}}catch{}try{let l=`https://query1.finance.yahoo.com/v8/finance/chart/${t}?interval=1d&range=1d`,r=await fetch(l,{mode:"cors",headers:{Accept:"application/json"}});if(!r.ok||r.status===0){const d=`https://api.allorigins.win/raw?url=${encodeURIComponent(l)}`;r=await fetch(d)}if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.json(),u=(c=(n=(o=(a=i==null?void 0:i.chart)==null?void 0:a.result)==null?void 0:o[0])==null?void 0:n.meta)==null?void 0:c.regularMarketPrice;return u&&typeof u=="number"?u:null}catch{return null}}const je="optionAnalysis_priceCache",zt=9e5;function Yt(){try{const t=sessionStorage.getItem(je);if(t){const s=JSON.parse(t),a=new Map;for(const[o,n]of Object.entries(s))a.set(o,n);return a}}catch{}return new Map}function Qt(t){try{const s=Object.fromEntries(t);sessionStorage.setItem(je,JSON.stringify(s))}catch{}}function Wt(){try{sessionStorage.removeItem(je)}catch{}}async function ne(t){const s=Yt(),a=s.get(t),o=Date.now();if(a&&o-a.timestamp<zt)return{price:a.price,source:"api",cached:!0};const n=await Kt(t);return n!==null?(s.set(t,{price:n,timestamp:o}),Qt(s),{price:n,source:"api",cached:!1}):{price:null,source:"none",cached:!1}}function Ne(){Wt()}const Jt=({activeDashboard:t,setActiveDashboard:s})=>{var I;const[a,o]=g.useState(null),[n,c]=g.useState(null),[l,r]=g.useState([]),[i,u]=g.useState(null),[d,m]=g.useState(!0),[x,h]=g.useState(null),[f,w]=g.useState(null),[P,y]=g.useState("none"),[k,v]=g.useState(!1),[j,D]=g.useState("");g.useEffect(()=>{(async(F=!1)=>{try{m(!0),h(null);const b=await ie(F);if(b.length===0)throw new Error("No data files found in the data directory");const{mergedData:_,info:H}=se(b.map(Y=>({filename:Y.filename,data:Y.data,timestamp:Y.timestamp})));r(_),u(H),m(!1)}catch(b){console.error("Error loading data files:",b),h(b instanceof Error?b.message:"Failed to load data"),m(!1)}})(!1)},[]);const p=g.useMemo(()=>ft(l),[l]),N=g.useMemo(()=>{if(!j.trim())return p;const S=j.toLowerCase();return p.filter(F=>F.ticker.toLowerCase().includes(S))},[p,j]),T=g.useMemo(()=>a?yt(l,a):[],[l,a]),M=g.useMemo(()=>a?gt(l,a,n||void 0):[],[l,a,n]),C=g.useMemo(()=>a?l.filter(S=>{const F=S.ticker===a,b=!n||S.expiry===n;return F&&b}):[],[l,a,n]),V=g.useMemo(()=>a?vt(l,a,n||void 0):null,[l,a,n]),$=g.useMemo(()=>a?l.filter(S=>S.ticker===a&&(!n||S.expiry===n)):[],[l,a,n]),A=g.useCallback(S=>{o(S),c(null)},[]),E=g.useCallback(()=>{o(null),c(null)},[]),R=g.useCallback(S=>{c(S===n?null:S)},[n]),L=g.useCallback(async()=>{try{console.log("🔄 Performing hard refresh for options data..."),he(),qt(),Ne(),console.log("✓ Options caches cleared (parsed data, file cache, and price cache)"),console.log("🔄 Reloading options data with cache bypass..."),m(!0),h(null);const S=await ie(!0);if(S.length===0)throw new Error("No data files found in the data directory");const{mergedData:F,info:b}=se(S.map(_=>({filename:_.filename,data:_.data,timestamp:_.timestamp})));if(r(F),u(b),w(null),y("none"),v(!1),a){const{price:_,source:H,cached:Y}=await ne(a);w(_),y(H),v(Y)}m(!1),console.log("✓ Data reloaded successfully:",{files:b.totalFiles,records:b.totalRecords,latestData:b.dateRange.latest})}catch(S){console.error("Error during hard refresh:",S),h(S instanceof Error?S.message:"Failed to refresh data"),m(!1)}},[a]);return g.useEffect(()=>{if(!a){w(null),y("none"),v(!1);return}(async()=>{const F=await ne(a);w(F.price),y(F.source),v(F.cached)})()},[a]),d?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading options data from multiple files..."})]}):x?e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error Loading Data"}),e.jsx("p",{children:x}),e.jsx("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"options-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"Market Analysis Dashboard"}),i&&e.jsxs("div",{className:"header-stats",children:[e.jsxs("span",{className:"header-stat",children:[i.totalFiles," files"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsxs("span",{className:"header-stat",children:[i.totalRecords.toLocaleString()," records"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsx("span",{className:"header-stat",children:i.files&&i.files.length>0?i.files[0].timestamp.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):((I=i.dateRange.latest)==null?void 0:I.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}))||""})]})]}),e.jsxs("div",{className:"header-right",children:[!a&&e.jsxs("div",{className:"search-container-header",children:[e.jsx(Ae,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search tickers...",value:j,onChange:S=>D(S.target.value)}),j&&e.jsx("button",{className:"clear-search",onClick:()=>D(""),title:"Clear search",children:"×"})]}),e.jsxs("div",{className:"nav-buttons",children:[e.jsx("button",{className:`nav-button ${t==="options"?"active":""}`,onClick:()=>s("options"),children:"Options Analysis"}),e.jsx("button",{className:`nav-button ${t==="darkpool"?"active":""}`,onClick:()=>s("darkpool"),children:"Dark Pool Analysis"}),e.jsx("button",{className:`nav-button ${t==="psychology"?"active":""}`,onClick:()=>s("psychology"),children:"Overall Analysis"})]}),e.jsxs("button",{className:"refresh-button-compact",onClick:L,title:"Hard Refresh - Clears all caches and reloads data from files",children:[e.jsx(z,{className:"refresh-icon"}),"Hard Refresh"]})]})]}),a?e.jsxs("div",{className:"ticker-detail-view",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("button",{className:"back-button",onClick:E,children:[e.jsx(Q,{className:"back-icon"}),"Back to Ticker List"]}),e.jsxs("h2",{children:[a," Options Analysis"]}),f&&P==="api"?e.jsxs("span",{className:"current-price-badge",children:[e.jsx("span",{className:"price-indicator"}),"Current Price: $",f.toFixed(2),e.jsxs("span",{className:"price-status",children:["(",k?"Cached":"Live",")"]})]}):e.jsx("span",{className:"price-unavailable",children:"Price unavailable"})]}),e.jsxs("div",{className:"expiry-filter",children:[e.jsxs("div",{className:"filter-header",children:[e.jsx(fe,{className:"filter-icon"}),e.jsx("span",{children:"Filter by Expiry Date:"})]}),e.jsxs("div",{className:"expiry-buttons",children:[e.jsx("button",{className:`expiry-button ${n?"":"active"}`,onClick:()=>c(null),children:"All Expiries"}),T.map(S=>e.jsx("button",{className:`expiry-button ${n===S?"active":""}`,onClick:()=>R(S),children:new Date(S).toLocaleDateString()},S))]})]}),e.jsxs("div",{className:"charts-section",children:[e.jsx("div",{className:"chart-column",children:e.jsx(pe,{data:M,highestVolumeData:V,ticker:a,expiry:n||void 0,chartType:"callput",currentPrice:f||void 0,trades:C})}),e.jsx("div",{className:"chart-column",children:e.jsx(pe,{data:M,highestVolumeData:V,ticker:a,expiry:n||void 0,chartType:"total",currentPrice:f||void 0,trades:C})})]}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Total Volume"}),e.jsx("p",{children:M.reduce((S,F)=>S+F.totalVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Call Volume"}),e.jsx("p",{children:M.reduce((S,F)=>S+F.callVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Put Volume"}),e.jsx("p",{children:M.reduce((S,F)=>S+F.putVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Open Interest"}),e.jsx("p",{children:M.reduce((S,F)=>S+F.openInterest,0).toLocaleString()})]})]}),e.jsx(Lt,{ticker:a,trades:$}),e.jsxs("div",{className:"heatmap-trades-section",children:[e.jsx("div",{className:"heatmap-column",children:e.jsx(bt,{trades:$,currentPrice:f||void 0})}),e.jsx("div",{className:"trades-column",children:e.jsxs("div",{className:"trade-list-section",children:[e.jsxs("h3",{children:["Trade History for ",a]}),e.jsxs("p",{children:["Found ",$.length," trades"]}),e.jsx(Re,{trades:$,ticker:a,expiry:n||void 0})]})})]})]}):e.jsx(Le,{tickers:N,onTickerSelect:A,allData:l})]})},Ke=g.memo(({trade:t,volumeStats:s,valueStats:a})=>{const o=i=>{try{return new Date(i).toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}catch{return"Unknown"}},n=i=>i>=1e6?`${(i/1e6).toFixed(1)}M`:i>=1e3?`${(i/1e3).toFixed(1)}K`:i.toLocaleString(),l=(i=>{const u=i.replace(/[$,]/g,""),d=parseFloat(u);return i.includes("M")?d*1e6:i.includes("K")?d*1e3:d})(t.totalValue),r=()=>t.quantity>=s.q90||l>=a.q90?"rgba(0, 200, 0, 0.6)":"rgba(255, 255, 255, 0.1)";return e.jsxs("div",{className:"darkpool-row-horizontal",style:{backgroundColor:r(),borderLeft:t.quantity>=s.q90||l>=a.q90?"4px solid #00c800":"none"},children:[e.jsx("div",{className:"darkpool-cell-h symbol",children:t.ticker}),e.jsx("div",{className:"darkpool-cell-h quantity",children:n(t.quantity)}),e.jsxs("div",{className:"darkpool-cell-h price",children:["$",t.price.toFixed(2)]}),e.jsx("div",{className:"darkpool-cell-h total-value",children:t.totalValue}),e.jsx("div",{className:"darkpool-cell-h exec-time",children:o(t.timestamp)})]})});Ke.displayName="DarkPoolRow";const De=t=>{const s=[...t].sort((i,u)=>i-u),a=t.reduce((i,u)=>i+u,0)/t.length,o=t.reduce((i,u)=>i+Math.pow(u-a,2),0)/t.length,n=Math.sqrt(o),c=Math.floor(s.length*.75),l=Math.floor(s.length*.9),r=Math.floor(s.length*.95);return{mean:a,stdDev:n,q75:s[c]||0,q90:s[l]||0,q95:s[r]||0}},ze=g.memo(({trades:t,ticker:s})=>{const[a,o]=g.useState("timestamp"),[n,c]=g.useState("desc"),{volumeStats:l,valueStats:r}=g.useMemo(()=>{if(t.length===0)return{volumeStats:{mean:0,stdDev:0,q75:0,q90:0,q95:0},valueStats:{mean:0,stdDev:0,q75:0,q90:0,q95:0}};const h=t.map(w=>w.quantity),f=t.map(w=>{const P=w.totalValue.replace(/[$,]/g,""),y=parseFloat(P);return w.totalValue.includes("M")?y*1e6:w.totalValue.includes("K")?y*1e3:y});return{volumeStats:De(h),valueStats:De(f)}},[t]),i=g.useMemo(()=>[...t].sort((f,w)=>{let P=0;switch(a){case"timestamp":P=new Date(f.timestamp).getTime()-new Date(w.timestamp).getTime();break;case"quantity":P=f.quantity-w.quantity;break;case"price":P=f.price-w.price;break;case"total-value":const y=parseFloat(f.totalValue.replace(/[$,]/g,"")),k=parseFloat(w.totalValue.replace(/[$,]/g,""));P=y-k;break;default:P=0}return n==="asc"?P:-P}),[t,a,n]),u=h=>{a===h?c(n==="asc"?"desc":"asc"):(o(h),c("desc"))},d=h=>a!==h?"↕️":n==="asc"?"↑":"↓",m=t.reduce((h,f)=>{const w=parseFloat(f.totalValue.replace(/[$,]/g,""));return h+w},0),x=h=>h>=1e9?`$${(h/1e9).toFixed(1)}B`:h>=1e6?`$${(h/1e6).toFixed(1)}M`:h>=1e3?`$${(h/1e3).toFixed(1)}K`:`$${h.toFixed(0)}`;return e.jsxs("div",{className:"darkpool-list-container",children:[e.jsxs("div",{className:"darkpool-list-header",children:[e.jsxs("h3",{children:["Dark Pool Trades",s?` for ${s}`:""]}),e.jsxs("div",{className:"darkpool-stats",children:[e.jsxs("span",{className:"stat-item",children:[e.jsx("strong",{children:t.length})," trades"]}),e.jsxs("span",{className:"stat-item",children:[e.jsx("strong",{children:x(m)})," total value"]})]})]}),e.jsxs("div",{className:"darkpool-legend",children:[e.jsx("div",{className:"legend-title",children:"Trade Volume/Value Indicators:"}),e.jsxs("div",{className:"legend-items",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color unusual"}),e.jsx("span",{children:"Unusual (Top 10%)"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color normal"}),e.jsx("span",{children:"Normal"})]})]})]}),e.jsxs("div",{className:"darkpool-list-table",children:[e.jsxs("div",{className:"darkpool-header-row",children:[e.jsxs("div",{className:"darkpool-header-cell symbol",onClick:()=>u("timestamp"),children:["Symbol ",d("timestamp")]}),e.jsxs("div",{className:"darkpool-header-cell quantity",onClick:()=>u("quantity"),children:["Quantity ",d("quantity")]}),e.jsxs("div",{className:"darkpool-header-cell price",onClick:()=>u("price"),children:["Price ",d("price")]}),e.jsxs("div",{className:"darkpool-header-cell total-value",onClick:()=>u("total-value"),children:["Total Value ",d("total-value")]}),e.jsxs("div",{className:"darkpool-header-cell exec-time",onClick:()=>u("timestamp"),children:["Execution Time ",d("timestamp")]})]}),e.jsx("div",{className:"darkpool-trades-container",children:i.map((h,f)=>e.jsx(Ke,{trade:h,volumeStats:l,valueStats:r},`${h.ticker}-${h.timestamp}-${f}`))})]}),t.length===0&&e.jsx("div",{className:"no-trades-message",children:e.jsxs("p",{children:["No dark pool trades found",s?` for ${s}`:"","."]})})]})});ze.displayName="DarkPoolList";const Ce=t=>{try{const s=new Date(t);return isNaN(s.getTime())?"":s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" "+s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}},de=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),me=t=>t>=1e9?`$${(t/1e9).toFixed(1)}B`:t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(2)}`,Ye=g.memo(({tickers:t,onTickerSelect:s,allData:a})=>{const[o,n]=g.useState("recent"),c=g.useMemo(()=>{const l=[...t];switch(o){case"recent":return l.sort((r,i)=>new Date(i.lastActivity).getTime()-new Date(r.lastActivity).getTime());case"oldest":return l.sort((r,i)=>new Date(r.lastActivity).getTime()-new Date(i.lastActivity).getTime());case"value-high":return l.sort((r,i)=>i.totalValue-r.totalValue);case"value-low":return l.sort((r,i)=>r.totalValue-i.totalValue);case"quantity-high":return l.sort((r,i)=>i.totalQuantity-r.totalQuantity);case"quantity-low":return l.sort((r,i)=>r.totalQuantity-i.totalQuantity);case"trades-high":return l.sort((r,i)=>i.tradeCount-r.tradeCount);case"trades-low":return l.sort((r,i)=>r.tradeCount-i.tradeCount);case"volume-high":return l.sort((r,i)=>i.highestVolumeQuantity-r.highestVolumeQuantity);case"volume-low":return l.sort((r,i)=>r.highestVolumeQuantity-i.highestVolumeQuantity);default:return l}},[t,o]);return e.jsxs("div",{className:"ticker-list-container",children:[e.jsxs("div",{className:"ticker-list-header",children:[e.jsx("h2",{children:"Dark Pool Tickers"}),e.jsx("p",{children:"Select a ticker to view detailed dark pool activity"}),e.jsxs("div",{className:"sort-controls",children:[e.jsx(xe,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:o,onChange:l=>n(l.target.value),children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"value-high",children:"Value (High to Low)"}),e.jsx("option",{value:"value-low",children:"Value (Low to High)"}),e.jsx("option",{value:"quantity-high",children:"Quantity (High to Low)"}),e.jsx("option",{value:"quantity-low",children:"Quantity (Low to High)"}),e.jsx("option",{value:"trades-high",children:"Trades (High to Low)"}),e.jsx("option",{value:"trades-low",children:"Trades (Low to High)"}),e.jsx("option",{value:"volume-high",children:"High Volume (High to Low)"}),e.jsx("option",{value:"volume-low",children:"High Volume (Low to High)"})]})]})]}),e.jsx("div",{className:"ticker-grid",children:c.map(l=>{const r=a.filter(i=>i.ticker===l.ticker).sort((i,u)=>new Date(u.timestamp).getTime()-new Date(i.timestamp).getTime())[0];return e.jsxs("div",{className:"ticker-card darkpool-card",onClick:()=>s(l.ticker),children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h3",{className:"ticker-symbol",children:l.ticker}),e.jsxs("div",{className:"ticker-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx(Ve,{className:"metric-icon value"}),e.jsx("span",{className:"metric-label",children:"Total Value"}),e.jsx("span",{className:"metric-value",children:me(l.totalValue)})]}),e.jsxs("div",{className:"metric",children:[e.jsx(Pe,{className:"metric-icon quantity"}),e.jsx("span",{className:"metric-label",children:"Quantity"}),e.jsx("span",{className:"metric-value",children:de(l.totalQuantity)})]})]})]}),e.jsxs("div",{className:"ticker-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Trades:"}),e.jsx("span",{className:"detail-value",children:l.tradeCount})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Avg Price:"}),e.jsxs("span",{className:"detail-value",children:["$",l.averagePrice.toFixed(2)]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(fe,{className:"detail-icon"}),e.jsx("span",{className:"detail-label",children:"Max Trade:"}),e.jsx("span",{className:"detail-value",children:me(l.maxTradeValue)})]})]}),e.jsxs("div",{className:"ticker-analytics",children:[e.jsxs("div",{className:"analytics-badge key-levels-badge",children:[e.jsx(Me,{size:12}),e.jsx("span",{className:"badge-label",children:"High Volume:"}),e.jsxs("span",{className:"badge-strikes",children:[de(l.highestVolumeQuantity)," @ $",l.highestVolumePrice.toFixed(2)]})]}),e.jsxs("div",{className:"analytics-badge max-pain-badge",children:[e.jsx(Ge,{size:12}),e.jsx("span",{className:"badge-label",children:"Peak Time:"}),e.jsx("span",{className:"badge-strikes",children:Ce(l.highestVolumeTime)})]})]}),r&&e.jsxs("div",{className:"detail-row last-trade-row",children:[e.jsx("span",{className:"detail-label",children:"Last Trade:"}),e.jsxs("span",{className:"detail-value last-trade",children:[me(r.price*r.quantity),e.jsxs("span",{className:"trade-side",children:[de(r.quantity)," @ $",r.price.toFixed(2)]}),e.jsx("span",{className:"trade-timestamp",children:Ce(r.timestamp)})]})]})]},l.ticker)})}),c.length===0&&e.jsx("div",{className:"no-tickers",children:e.jsx("p",{children:"No dark pool tickers found"})})]})});Ye.displayName="DarkPoolTickerList";const Gt=({trades:t})=>{const s=g.useMemo(()=>{if(!t||t.length===0)return[];const l=[...t].sort((i,u)=>i.price-u.price),r=new Map;return l.forEach(i=>{const u=Math.round(i.price*100)/100;if(r.has(u)){const d=r.get(u);d.volume+=i.quantity,d.value+=i.price*i.quantity,new Date(i.timestamp)>new Date(d.timestamp)&&(d.timestamp=i.timestamp)}else r.set(u,{price:u,volume:i.quantity,timestamp:i.timestamp,value:i.price*i.quantity})}),Array.from(r.values()).sort((i,u)=>i.price-u.price)},[t]),a=g.useMemo(()=>Math.max(...s.map(l=>l.volume),1),[s]),o=l=>l>=1e6?`${(l/1e6).toFixed(1)}M`:l>=1e3?`${(l/1e3).toFixed(1)}K`:l.toString(),n=l=>l>=1e9?`$${(l/1e9).toFixed(1)}B`:l>=1e6?`$${(l/1e6).toFixed(1)}M`:l>=1e3?`$${(l/1e3).toFixed(1)}K`:`$${l.toFixed(2)}`,c=l=>{try{const r=new Date(l);return isNaN(r.getTime())?"":r.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}};return s.length===0?e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Trade Distribution Chart"}),e.jsx("div",{className:"no-data",children:"No trade data available for charting"})]}):e.jsx("div",{className:"chart-container",children:e.jsxs("div",{className:"chart-content",children:[e.jsxs("div",{className:"chart-y-axis",children:[e.jsx("div",{className:"y-label",children:"Volume"}),e.jsxs("div",{className:"y-scale",children:[e.jsx("div",{className:"scale-value",children:o(a)}),e.jsx("div",{className:"scale-value",children:o(a*.75)}),e.jsx("div",{className:"scale-value",children:o(a*.5)}),e.jsx("div",{className:"scale-value",children:o(a*.25)}),e.jsx("div",{className:"scale-value",children:"0"})]})]}),e.jsxs("div",{className:"chart-main",children:[e.jsx("div",{className:"chart-bars",children:s.map((l,r)=>{const i=l.volume/a*100,u=l.volume>a*.8;return e.jsx("div",{className:`chart-bar ${u?"high-volume":""}`,style:{height:`${i}%`},title:`Price: $${l.price.toFixed(2)}
Volume: ${o(l.volume)}
Value: ${n(l.value)}
Time: ${c(l.timestamp)}`,children:e.jsx("div",{className:"bar-value",children:o(l.volume)})},`${l.price}-${r}`)})}),e.jsxs("div",{className:"chart-x-axis",children:[e.jsx("div",{className:"x-label",children:"Price ($)"}),e.jsx("div",{className:"x-scale",children:s.map((l,r)=>e.jsx("div",{className:"x-tick",children:e.jsxs("span",{className:"price-label",children:["$",l.price.toFixed(2)]})},`price-${r}`))})]})]})]})})},Xt=({trades:t})=>{const s=g.useMemo(()=>{if(!t||t.length===0)return[];const l=new Map;return t.forEach(r=>{const i=new Date(r.timestamp),u=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")} ${String(i.getHours()).padStart(2,"0")}:00`;if(l.has(u)){const d=l.get(u);d.volume+=r.quantity,d.tradeCount+=1,d.totalValue+=r.price*r.quantity,d.avgPrice=d.totalValue/d.volume}else l.set(u,{time:u,volume:r.quantity,tradeCount:1,avgPrice:r.price,totalValue:r.price*r.quantity})}),Array.from(l.values()).sort((r,i)=>new Date(r.time).getTime()-new Date(i.time).getTime())},[t]),a=g.useMemo(()=>Math.max(...s.map(l=>l.volume),1),[s]),o=l=>l>=1e6?`${(l/1e6).toFixed(1)}M`:l>=1e3?`${(l/1e3).toFixed(1)}K`:l.toString(),n=l=>l>=1e9?`$${(l/1e9).toFixed(1)}B`:l>=1e6?`$${(l/1e6).toFixed(1)}M`:l>=1e3?`$${(l/1e3).toFixed(1)}K`:`$${l.toFixed(2)}`,c=l=>{try{const r=new Date(l);if(isNaN(r.getTime()))return"";const i=String(r.getMonth()+1).padStart(2,"0"),u=String(r.getDate()).padStart(2,"0"),d=String(r.getHours()).padStart(2,"0"),m=String(r.getMinutes()).padStart(2,"0");return`${i}/${u}-${d}:${m}`}catch{return""}};return s.length===0?e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Volume Over Time"}),e.jsx("div",{className:"no-data",children:"No trade data available for time analysis"})]}):e.jsx("div",{className:"chart-container",children:e.jsxs("div",{className:"chart-content",children:[e.jsxs("div",{className:"chart-y-axis",children:[e.jsx("div",{className:"y-label",children:"Volume"}),e.jsxs("div",{className:"y-scale",children:[e.jsx("div",{className:"scale-value",children:o(a)}),e.jsx("div",{className:"scale-value",children:o(a*.75)}),e.jsx("div",{className:"scale-value",children:o(a*.5)}),e.jsx("div",{className:"scale-value",children:o(a*.25)}),e.jsx("div",{className:"scale-value",children:"0"})]})]}),e.jsxs("div",{className:"chart-main",children:[e.jsx("div",{className:"chart-bars",children:s.map((l,r)=>{const i=l.volume/a*100,u=l.volume>a*.8;return e.jsx("div",{className:`chart-bar ${u?"high-volume":""}`,style:{height:`${i}%`},title:`Time: ${c(l.time)}
Volume: ${o(l.volume)}
Trades: ${l.tradeCount}
Avg Price: $${l.avgPrice.toFixed(2)}
Total Value: ${n(l.totalValue)}`,children:e.jsx("div",{className:"bar-value",children:o(l.volume)})},`${l.time}-${r}`)})}),e.jsxs("div",{className:"chart-x-axis",children:[e.jsx("div",{className:"x-label",children:"Time"}),e.jsx("div",{className:"x-scale",children:s.map((l,r)=>e.jsx("div",{className:"x-tick",children:e.jsx("span",{className:"time-label",children:c(l.time)})},`time-${r}`))})]})]})]})})},Zt=({activeDashboard:t,setActiveDashboard:s})=>{var C;const[a,o]=g.useState(null),[n,c]=g.useState([]),[l,r]=g.useState(null),[i,u]=g.useState(!0),[d,m]=g.useState(null),[x,h]=g.useState(null),[f,w]=g.useState("none"),[P,y]=g.useState(!1),[k,v]=g.useState("");g.useEffect(()=>{(async($=!1)=>{try{u(!0),m(null);const A=await Te($);if(A.length===0)throw new Error("No dark pool data files found in the data directory");const{mergedData:E,info:R}=be(A.map(L=>({filename:L.filename,data:L.data,timestamp:L.timestamp})));c(E),r(R),u(!1)}catch(A){console.error("Error loading dark pool data files:",A),m(A instanceof Error?A.message:"Failed to load dark pool data"),u(!1)}})(!1)},[]);const j=g.useMemo(()=>Nt(n).map($=>{const A=n.filter(b=>b.ticker===$.ticker),E=A.map(b=>b.quantity),R=A.map(b=>b.price*b.quantity),L=A.map(b=>b.price),I=A.reduce((b,_)=>_.quantity>b.quantity?_:b,A[0]),S=$.totalValue/$.tradeCount,F=L.length>1?Math.sqrt(L.reduce((b,_)=>b+Math.pow(_-$.averagePrice,2),0)/L.length):0;return{ticker:$.ticker,totalValue:$.totalValue,totalQuantity:$.totalQuantity,tradeCount:$.tradeCount,averagePrice:$.averagePrice,lastActivity:$.lastActivity,maxTradeValue:Math.max(...R),minTradeValue:Math.min(...R),maxQuantity:Math.max(...E),minQuantity:Math.min(...E),avgTradeSize:S,priceVolatility:F,highestVolumePrice:(I==null?void 0:I.price)||0,highestVolumeTime:(I==null?void 0:I.timestamp)||"",highestVolumeQuantity:(I==null?void 0:I.quantity)||0}}),[n]),D=g.useMemo(()=>{if(!k.trim())return j;const V=k.toLowerCase();return j.filter($=>$.ticker.toLowerCase().includes(V))},[j,k]),p=g.useMemo(()=>a?n.filter(V=>V.ticker===a):[],[n,a]),N=g.useCallback(V=>{o(V)},[]),T=g.useCallback(()=>{o(null)},[]),M=g.useCallback(async()=>{try{console.log("🔄 Performing hard refresh for dark pool data..."),ut(),Bt(),Ne(),console.log("✓ Dark pool caches cleared (parsed data, file cache, and price cache)"),console.log("🔄 Reloading dark pool data with cache bypass..."),u(!0),m(null);const V=await Te(!0);if(V.length===0)throw new Error("No dark pool data files found in the data directory");const{mergedData:$,info:A}=be(V.map(E=>({filename:E.filename,data:E.data,timestamp:E.timestamp})));if(c($),r(A),h(null),w("none"),y(!1),a){const{price:E,source:R,cached:L}=await ne(a);h(E),w(R),y(L)}u(!1),console.log("✓ Dark pool data reloaded successfully:",{files:A.totalFiles,records:A.totalRecords,latestData:A.dateRange.latest})}catch(V){console.error("Error during hard refresh:",V),m(V instanceof Error?V.message:"Failed to refresh dark pool data"),u(!1)}},[a]);return g.useEffect(()=>{if(!a){h(null),w("none"),y(!1);return}(async()=>{const $=await ne(a);h($.price),w($.source),y($.cached)})()},[a]),i?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading dark pool data from multiple files..."})]}):d?e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error Loading Dark Pool Data"}),e.jsx("p",{children:d}),e.jsx("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"darkpool-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"Market Analysis Dashboard"}),l&&e.jsxs("div",{className:"header-stats",children:[e.jsxs("span",{className:"header-stat",children:[l.totalFiles," files"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsxs("span",{className:"header-stat",children:[l.totalRecords.toLocaleString()," records"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsx("span",{className:"header-stat",children:l.files&&l.files.length>0?l.files[0].timestamp.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):((C=l.dateRange.latest)==null?void 0:C.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}))||""})]})]}),e.jsxs("div",{className:"header-right",children:[!a&&e.jsxs("div",{className:"search-container-header",children:[e.jsx(Ae,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search tickers...",value:k,onChange:V=>v(V.target.value)}),k&&e.jsx("button",{className:"clear-search",onClick:()=>v(""),title:"Clear search",children:"×"})]}),e.jsxs("div",{className:"nav-buttons",children:[e.jsx("button",{className:`nav-button ${t==="options"?"active":""}`,onClick:()=>s("options"),children:"Options Analysis"}),e.jsx("button",{className:`nav-button ${t==="darkpool"?"active":""}`,onClick:()=>s("darkpool"),children:"Dark Pool Analysis"}),e.jsx("button",{className:`nav-button ${t==="psychology"?"active":""}`,onClick:()=>s("psychology"),children:"Overall Analysis"})]}),e.jsxs("button",{className:"refresh-button-compact",onClick:M,title:"Hard Refresh - Clears all caches and reloads data from files",children:[e.jsx(z,{className:"refresh-icon"}),"Hard Refresh"]})]})]}),a?e.jsxs("div",{className:"ticker-detail-view",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("button",{className:"back-button",onClick:T,children:[e.jsx(Q,{className:"back-icon"}),"Back to Ticker List"]}),e.jsxs("h2",{children:[a," Dark Pool Analysis"]}),x&&f==="api"?e.jsxs("span",{className:"current-price-badge",children:[e.jsx("span",{className:"price-indicator"}),"Current Price: $",x.toFixed(2),e.jsxs("span",{className:"price-status",children:["(",P?"Cached":"Live",")"]})]}):e.jsx("span",{className:"price-unavailable",children:"Price unavailable"})]}),e.jsxs("div",{className:"charts-container",children:[e.jsx("div",{className:"chart-column",children:e.jsx(Gt,{trades:p,ticker:a})}),e.jsx("div",{className:"chart-column",children:e.jsx(Xt,{trades:p,ticker:a})})]}),e.jsx("div",{className:"darkpool-trades-section",children:e.jsx(ze,{trades:p,ticker:a})})]}):e.jsx(Ye,{tickers:D,onTickerSelect:N,allData:n})]})};async function G(){try{Ut(),ht(),Ne();const t=[];for(let s=0;s<sessionStorage.length;s++){const a=sessionStorage.key(s);a&&a.startsWith("optionAnalysis_")&&t.push(a)}if(t.forEach(s=>{try{sessionStorage.removeItem(s)}catch{}}),"caches"in window)try{const s=await caches.keys();await Promise.all(s.map(a=>caches.delete(a)))}catch{}}catch{}}function es(){const t=()=>{G()},s=()=>{G()},a=()=>{document.visibilityState==="hidden"&&G()};window.addEventListener("beforeunload",t),window.addEventListener("unload",s),document.addEventListener("visibilitychange",a),window.addEventListener("pagehide",t)}const ts=({trades:t,sortedAnalyses:s})=>{const a=g.useMemo(()=>s||(!t||t.length===0?[]:Ue(t)),[t,s]);return a.length===0?e.jsxs("div",{className:"ticker-weekly-analysis",children:[e.jsx("h3",{children:"Ticker Weekly Analysis"}),e.jsx("p",{children:"No data available for ticker weekly analysis"})]}):e.jsxs("div",{className:"ticker-weekly-analysis",children:[e.jsx("h3",{children:"Ticker Weekly Analysis"}),e.jsx("p",{children:"Bullish/Bearish sentiment by ticker for each week"}),e.jsx("div",{className:"ticker-analysis-grid",children:a.slice(0,20).map(o=>e.jsx(ss,{analysis:o},o.ticker))})]})},ss=({analysis:t})=>{const s=t.weeks.reduce((n,c)=>n+c.totalVolume,0),a=t.weeks.reduce((n,c)=>n+c.totalTrades,0),o=t.weeks.reduce((n,c)=>n+c.totalPremium,0);return e.jsxs("div",{className:`ticker-analysis-card ${t.overallSentiment}`,children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h4",{children:t.ticker}),e.jsx("div",{className:`overall-sentiment ${t.overallSentiment}`,children:t.overallSentiment.toUpperCase()})]}),e.jsxs("div",{className:"ticker-summary",children:[e.jsxs("div",{className:"summary-metric",children:[e.jsx("span",{className:"metric-label",children:"Volume"}),e.jsx("span",{className:"metric-value",children:Qe(s)})]}),e.jsxs("div",{className:"summary-metric",children:[e.jsx("span",{className:"metric-label",children:"Trades"}),e.jsx("span",{className:"metric-value",children:a.toLocaleString()})]}),e.jsxs("div",{className:"summary-metric",children:[e.jsx("span",{className:"metric-label",children:"Premium"}),e.jsx("span",{className:"metric-value",children:K(o)})]}),e.jsxs("div",{className:"summary-metric",children:[e.jsx("span",{className:"metric-label",children:"Weeks"}),e.jsx("span",{className:"metric-value",children:t.weeks.length})]})]}),e.jsxs("div",{className:"trend-info",children:[e.jsxs("div",{className:`trend-direction ${t.trendDirection}`,children:[e.jsx("span",{className:"trend-label",children:"Trend"}),e.jsx("span",{className:"trend-value",children:t.trendDirection})]}),e.jsxs("div",{className:`confidence ${t.confidence}`,children:[e.jsx("span",{className:"confidence-label",children:"Confidence"}),e.jsx("span",{className:"confidence-value",children:t.confidence})]})]}),e.jsx("div",{className:"weekly-breakdown",children:e.jsx("div",{className:"weeks-list",children:t.weeks.slice(0,2).map(n=>e.jsx(as,{week:n},`${n.weekStart}-${n.weekEnd}`))})})]})},as=({week:t})=>{const s=`${$e(t.weekStart)} - ${$e(t.weekEnd)}`;return e.jsxs("div",{className:`week-row ${t.psychology.sentiment}`,children:[e.jsxs("div",{className:"week-header",children:[e.jsx("span",{className:"week-date",children:s}),e.jsx("div",{className:`week-sentiment ${t.psychology.sentiment}`,children:t.psychology.sentiment.toUpperCase()})]}),e.jsxs("div",{className:"week-metrics",children:[e.jsxs("div",{className:"week-metric",children:[e.jsx("span",{className:"metric-label",children:"Vol"}),e.jsx("span",{className:"metric-value",children:Qe(t.totalVolume)})]}),e.jsxs("div",{className:"week-metric",children:[e.jsx("span",{className:"metric-label",children:"C/P"}),e.jsx("span",{className:"metric-value",children:t.callPutRatio.toFixed(1)})]}),e.jsxs("div",{className:"week-metric",children:[e.jsx("span",{className:"metric-label",children:"Trd"}),e.jsx("span",{className:"metric-value",children:t.totalTrades})]}),e.jsxs("div",{className:"week-metric",children:[e.jsx("span",{className:"metric-label",children:"Swp"}),e.jsx("span",{className:"metric-value",children:t.sweepCount+t.unusualSweepCount+t.highlyUnusualSweepCount})]})]}),e.jsx("div",{className:"week-psychology",children:e.jsx("span",{className:"psychology-description",children:t.psychology.description})})]})};function Qe(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function $e(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}const rs=({setActiveDashboard:t})=>{const[s,a]=g.useState([]),[,o]=g.useState(null),[n,c]=g.useState(!0),[l,r]=g.useState(null),[i,u]=g.useState("volume"),[d,m]=g.useState("desc"),[x,h]=g.useState(null);g.useEffect(()=>((async(j=!1)=>{try{c(!0),r(null);const D=setTimeout(()=>{r("Loading is taking longer than expected. This might be a cache issue. Try refreshing or clearing cache.")},15e3);h(D);const p=await ie(j);if(p.length===0)throw new Error("No data files found in the data directory");const{mergedData:N,info:T}=se(p);a(N),o(T),D&&(clearTimeout(D),h(null))}catch(D){console.error("Error loading data:",D),r(D instanceof Error?D.message:"Failed to load data"),x&&(clearTimeout(x),h(null))}finally{c(!1)}})(),()=>{x&&clearTimeout(x)}),[]);const f=async()=>{he(),await G(),await(async()=>{try{c(!0),r(null);const j=setTimeout(()=>{r("Refresh is taking longer than expected. Try clearing cache manually.")},15e3);h(j);const D=await ie(!0);if(D.length===0)throw new Error("No data files found in the data directory");const{mergedData:p,info:N}=se(D);a(p),o(N),j&&(clearTimeout(j),h(null))}catch(j){console.error("Error refreshing data:",j),r(j instanceof Error?j.message:"Failed to refresh data"),x&&(clearTimeout(x),h(null))}finally{c(!1)}})()},w=()=>{he(),G(),r(null),c(!0),setTimeout(()=>{window.location.reload()},100)},P=g.useMemo(()=>!s||s.length===0?[]:Ue(s).sort((j,D)=>{let p,N;switch(i){case"volume":p=j.weeks.reduce((A,E)=>A+E.totalVolume,0),N=D.weeks.reduce((A,E)=>A+E.totalVolume,0);break;case"premium":p=j.weeks.reduce((A,E)=>A+E.totalPremium,0),N=D.weeks.reduce((A,E)=>A+E.totalPremium,0);break;case"trades":p=j.weeks.reduce((A,E)=>A+E.totalTrades,0),N=D.weeks.reduce((A,E)=>A+E.totalTrades,0);break;case"recent":const C=j.weeks[j.weeks.length-1],V=D.weeks[D.weeks.length-1];p=((C==null?void 0:C.totalVolume)||0)+((C==null?void 0:C.totalPremium)||0),N=((V==null?void 0:V.totalVolume)||0)+((V==null?void 0:V.totalPremium)||0);break;case"sentiment":const $={bullish:3,bearish:2,mixed:1,neutral:0};p=$[j.overallSentiment],N=$[D.overallSentiment];break;case"ticker":p=j.ticker,N=D.ticker;break;default:p=0,N=0}if(typeof p=="string"&&typeof N=="string")return d==="asc"?p.localeCompare(N):N.localeCompare(p);const T=Number(p),M=Number(N);return d==="asc"?T-M:M-T}),[s,i,d]),y=v=>{i===v?m(d==="asc"?"desc":"asc"):(u(v),m("desc"))},k=v=>({volume:"Total Volume",premium:"Total Premium",trades:"Total Trades",recent:"Recent Activity",sentiment:"Sentiment",ticker:"Ticker"})[v];return n?e.jsxs("div",{className:"trade-psychology-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsx("button",{className:"back-button",onClick:()=>t("options"),title:"Back to Options Dashboard",children:e.jsx(Q,{size:20})}),e.jsx("h2",{children:"Overall Analysis"})]}),e.jsx("div",{className:"sort-controls",children:["volume","premium","trades","recent","sentiment","ticker"].map(v=>e.jsxs("button",{className:`sort-tab ${i===v?"active":""}`,onClick:()=>y(v),title:`Sort by ${k(v)}`,children:[e.jsx("span",{children:k(v)}),i===v&&e.jsx("span",{className:"sort-direction",children:d==="asc"?"↑":"↓"})]},v))}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{className:"refresh-button",onClick:f,title:"Refresh Data",children:e.jsx(z,{size:20})})})]})}),e.jsx("div",{className:"loading",children:e.jsx("p",{children:"Loading overall analysis data..."})})]}):l?e.jsxs("div",{className:"trade-psychology-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsx("button",{className:"back-button",onClick:()=>t("options"),title:"Back to Options Dashboard",children:e.jsx(Q,{size:20})}),e.jsx("h2",{children:"Overall Analysis"})]}),e.jsx("div",{className:"sort-controls",children:["volume","premium","trades","recent","sentiment","ticker"].map(v=>e.jsxs("button",{className:`sort-tab ${i===v?"active":""}`,onClick:()=>y(v),title:`Sort by ${k(v)}`,children:[e.jsx("span",{children:k(v)}),i===v&&e.jsx("span",{className:"sort-direction",children:d==="asc"?"↑":"↓"})]},v))}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{className:"refresh-button",onClick:f,title:"Refresh Data",children:e.jsx(z,{size:20})})})]})}),e.jsxs("div",{className:"error",children:[e.jsx("div",{className:"error-icon",children:e.jsx(we,{size:48})}),e.jsx("h3",{children:"Error Loading Data"}),e.jsx("p",{children:l}),e.jsxs("div",{className:"error-actions",children:[e.jsxs("button",{onClick:f,className:"retry-button",children:[e.jsx(z,{size:16}),"Try Again"]}),e.jsxs("button",{onClick:w,className:"clear-cache-button",children:[e.jsx(we,{size:16}),"Clear Cache & Reload"]})]})]})]}):e.jsxs("div",{className:"trade-psychology-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsx("button",{className:"back-button",onClick:()=>t("options"),title:"Back to Options Dashboard",children:e.jsx(Q,{size:20})}),e.jsx("h2",{children:"Overall Analysis"})]}),e.jsx("div",{className:"sort-controls",children:["volume","premium","trades","recent","sentiment","ticker"].map(v=>e.jsxs("button",{className:`sort-tab ${i===v?"active":""}`,onClick:()=>y(v),title:`Sort by ${k(v)}`,children:[e.jsx("span",{children:k(v)}),i===v&&e.jsx("span",{className:"sort-direction",children:d==="asc"?"↑":"↓"})]},v))}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{className:"refresh-button",onClick:f,title:"Refresh Data",children:e.jsx(z,{size:20})})})]})}),e.jsx(ts,{trades:s,sortedAnalyses:P})]})};class ls extends g.Component{constructor(s){super(s),this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,a){console.error("ErrorBoundary caught an error:",s,a),this.setState({error:s,errorInfo:a})}render(){var s,a;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"An error occurred while rendering this component."}),e.jsxs("details",{className:"error-details",children:[e.jsx("summary",{children:"Error Details"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("pre",{children:(a=this.state.errorInfo)==null?void 0:a.componentStack})]}),e.jsx("button",{className:"retry-button",onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),children:"Try Again"})]})}):this.props.children}}function is(){const[t,s]=g.useState("options");return e.jsx("div",{className:"app",children:e.jsx("main",{children:e.jsx(ls,{children:t==="options"?e.jsx(Jt,{activeDashboard:t,setActiveDashboard:s}):t==="darkpool"?e.jsx(Zt,{activeDashboard:t,setActiveDashboard:s}):e.jsx(rs,{activeDashboard:t,setActiveDashboard:s})})})})}"serviceWorker"in navigator&&(window.addEventListener("load",()=>{const t="/optionAnalysis/";navigator.serviceWorker.register(`${t}sw.js`).then(s=>{console.log("SW registered: ",s),s.addEventListener("updatefound",()=>{const a=s.installing;a==null||a.addEventListener("statechange",()=>{a.state==="installed"&&navigator.serviceWorker.controller&&console.log("🔄 New service worker available. Please reload the page.")})})}).catch(s=>{console.log("SW registration failed: ",s)})}),window.clearAllCaches=async()=>{try{const t=await navigator.serviceWorker.getRegistrations();await Promise.all(t.map(a=>a.unregister()));const s=await caches.keys();await Promise.all(s.map(a=>caches.delete(a))),sessionStorage.clear(),localStorage.clear(),console.log("✅ All caches cleared!"),alert("All caches cleared! Please reload the page."),window.location.reload()}catch(t){console.error("Failed to clear caches:",t)}});es();ue.createRoot(document.getElementById("root")).render(e.jsx(Je.StrictMode,{children:e.jsx(is,{})}));
//# sourceMappingURL=index-410f2990-1761744475133.js.map
