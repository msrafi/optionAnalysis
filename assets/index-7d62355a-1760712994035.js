import{r as v,a as ce,R as me}from"./vendor-b1791c80-1760712994035.js";import{A as te,T as de,a as ue,C as se,b as pe,Z as he,c as xe,S as fe,R as ve,d as ge}from"./utils-a11e769a-1760712994035.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const t of a.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&c(t)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();var ae={exports:{}},B={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var je=v,ye=Symbol.for("react.element"),Ne=Symbol.for("react.fragment"),ke=Object.prototype.hasOwnProperty,be=je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,we={key:!0,ref:!0,__self:!0,__source:!0};function re(s,n,i){var c,r={},a=null,t=null;i!==void 0&&(a=""+i),n.key!==void 0&&(a=""+n.key),n.ref!==void 0&&(t=n.ref);for(c in n)ke.call(n,c)&&!we.hasOwnProperty(c)&&(r[c]=n[c]);if(s&&s.defaultProps)for(c in n=s.defaultProps,n)r[c]===void 0&&(r[c]=n[c]);return{$$typeof:ye,type:s,key:a,ref:t,props:r,_owner:be.current}}B.Fragment=Ne;B.jsx=re;B.jsxs=re;ae.exports=B;var e=ae.exports,z={},Z=ce;z.createRoot=Z.createRoot,z.hydrateRoot=Z.hydrateRoot;const K=new Map;function Se(){K.clear(),q.clear()}function H(s){try{if(!s)return null;const n=s.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(!n)return null;const[,,i,c,r,a,t,l]=n,u={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}[i.toLowerCase()];if(u===void 0)return null;let p=parseInt(a);return l.toUpperCase()==="PM"&&p!==12?p+=12:l.toUpperCase()==="AM"&&p===12&&(p=0),new Date(parseInt(r),u,parseInt(c),p,parseInt(t))}catch{return null}}function $e(s){try{if(!s)return!1;const n=s.split("/");if(n.length!==3)return!1;const i=parseInt(n[0])-1,c=parseInt(n[1]),r=parseInt(n[2]);return new Date(r,i,c,23,59,59)<new Date}catch{return!1}}function Te(s,n){var o,u;const i=`${n||"unknown"}_${s.length}_${s.slice(0,100)}`,c=K.get(i);if(c)return c;const r=s.split(`
`),a=[],t=Math.max(1e3,r.length*.8);a.length=t;let l=0;for(let p=1;p<r.length;p++){const d=r[p].trim();if(!d)continue;const x=Ve(d);if(!(x.length<20))try{const y=x[5]||"",f=x[6]||"",N=x[7]||"",S=parseFloat(x[8])||0,h=x[9]||"",k=x[10],P=parseInt(((o=x[12])==null?void 0:o.replace(/,/g,""))||"0"),D=x[13]||"$0",O=parseInt(((u=x[14])==null?void 0:u.replace(/,/g,""))||"0"),m=0,g=["Ask","Above","Bid","Below","Sweep","Block","Trade","Volume","Premium"],w=N&&N.length>=1&&N.length<=10&&!g.includes(N)&&!N.match(/^\d+$/)&&!N.includes(" ")&&/^[A-Z0-9]+$/.test(N),V=$e(h);w&&S>0&&h&&k&&P>0&&!V&&(a[l++]={ticker:N,strike:S,expiry:h,optionType:k,volume:P,premium:D,openInterest:O,bidAskSpread:m,timestamp:y,sweepType:f,sourceFile:n})}catch{}}return a.length=l,K.set(i,a),a}function Ve(s){const n=[];let i="",c=!1;for(let r=0;r<s.length;r++){const a=s[r];a==='"'?c=!c:a===","&&!c?(n.push(i.trim()),i=""):i+=a}return n.push(i.trim()),n}const q=new Map;function Pe(s){const n=`${s.length}_${s.slice(0,3).map(a=>`${a.ticker}_${a.timestamp}`).join("_")}`,i=q.get(n);if(i)return i;const c=new Map;for(let a=0;a<s.length;a++){const t=s[a];if(!c.has(t.ticker)){const u=H(t.timestamp);c.set(t.ticker,{ticker:t.ticker,totalVolume:0,callVolume:0,putVolume:0,totalPremium:0,uniqueExpiries:[],expirySet:new Set,lastActivity:t.timestamp,lastActivityDate:u,lastTrade:{strike:t.strike,optionType:t.optionType,volume:t.volume,premium:t.premium,sweepType:t.sweepType,timestamp:t.timestamp}})}const l=c.get(t.ticker);l.totalVolume+=t.volume,l.totalPremium+=Me(t.premium),t.optionType==="Call"?l.callVolume+=t.volume:l.putVolume+=t.volume,l.expirySet.has(t.expiry)||(l.expirySet.add(t.expiry),l.uniqueExpiries.push(t.expiry));const o=H(t.timestamp);o&&l.lastActivityDate&&o>l.lastActivityDate?(l.lastActivity=t.timestamp,l.lastActivityDate=o,l.lastTrade={strike:t.strike,optionType:t.optionType,volume:t.volume,premium:t.premium,sweepType:t.sweepType,timestamp:t.timestamp}):o&&!l.lastActivityDate&&(l.lastActivity=t.timestamp,l.lastActivityDate=o,l.lastTrade||(l.lastTrade={strike:t.strike,optionType:t.optionType,volume:t.volume,premium:t.premium,sweepType:t.sweepType,timestamp:t.timestamp}))}const r=Array.from(c.values()).map(({expirySet:a,...t})=>t).sort((a,t)=>{const l=a.lastActivityDate,o=t.lastActivityDate;return l&&o&&l.getTime()!==o.getTime()?o.getTime()-l.getTime():t.totalVolume-a.totalVolume});return q.set(n,r),r}function Ce(s,n,i){const c=s.filter(a=>a.ticker===n&&(!i||a.expiry===i)),r=new Map;return c.forEach(a=>{r.has(a.strike)||r.set(a.strike,{strike:a.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const t=r.get(a.strike);t.totalVolume+=a.volume,t.openInterest+=a.openInterest,a.optionType==="Call"?t.callVolume+=a.volume:t.putVolume+=a.volume}),Array.from(r.values()).sort((a,t)=>a.strike-t.strike)}function De(s,n){const i=new Set;return s.forEach(c=>{c.ticker===n&&i.add(c.expiry)}),Array.from(i).sort((c,r)=>new Date(c).getTime()-new Date(r).getTime())}function _e(s,n,i){const c=s.filter(l=>l.ticker===n&&(!i||l.expiry===i));if(!c.length)return null;const r=new Map;c.forEach(l=>{r.has(l.strike)||r.set(l.strike,{strike:l.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const o=r.get(l.strike);o.totalVolume+=l.volume,o.openInterest+=l.openInterest,l.optionType==="Call"?o.callVolume+=l.volume:o.putVolume+=l.volume});const t=Array.from(r.values()).reduce((l,o)=>o.totalVolume>l.totalVolume?o:l);return{strike:t.strike,totalVolume:t.totalVolume,callVolume:t.callVolume,putVolume:t.putVolume,openInterest:t.openInterest}}function Me(s){const n=s.replace(/[$,K]/g,""),i=parseFloat(n);return s.includes("K")?i*1e3:s.includes("M")?i*1e6:i}function E(s){return s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}function Ee(s){return s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(1)}K`:`$${s.toFixed(0)}`}function G(s){const n=[],i=[];let c=null,r=null;const a=new Map;s.sort((o,u)=>u.timestamp.getTime()-o.timestamp.getTime()).forEach(o=>{const u=Te(o.data,o.filename);u.forEach(p=>{const d=`${p.ticker}_${p.strike}_${p.expiry}_${p.optionType}_${p.volume}_${p.premium}_${p.timestamp}`;a.has(d)||a.set(d,p)}),i.push({filename:o.filename,recordCount:u.length,timestamp:o.timestamp}),(!c||o.timestamp<c)&&(c=o.timestamp),(!r||o.timestamp>r)&&(r=o.timestamp)}),n.push(...a.values());const l={totalFiles:s.length,totalRecords:n.length,dateRange:{earliest:c,latest:r},files:i};return{mergedData:n,info:l}}function Ae(s,n,i){if(s.length===0)return null;const c=s.reduce((S,h)=>S+h.volume,0),r=s.reduce((S,h)=>{const k=parseFloat(h.premium.replace(/[$,]/g,""))||0;return S+k},0),a=s.filter(S=>S.optionType==="Call").reduce((S,h)=>S+h.volume,0),t=s.filter(S=>S.optionType==="Put").reduce((S,h)=>S+h.volume,0),l=t>0?a/t:a,o=s.filter(S=>S.sweepType&&S.sweepType.toLowerCase().includes("sweep")).length,u=c/s.length,p=[...new Set(i.map(S=>S.ticker))],d=i.reduce((S,h)=>S+h.volume,0)/p.length,x=i.reduce((S,h)=>{const k=parseFloat(h.premium.replace(/[$,]/g,""))||0;return S+k},0)/p.length,y=[];let f="low",N="volume";return c>d*3?(y.push(`Volume ${(c/d*100).toFixed(0)}% above average`),f="high",N="volume"):c>d*2&&(y.push(`Volume ${(c/d*100).toFixed(0)}% above average`),f="medium"),r>x*3?(y.push(`Premium ${(r/x*100).toFixed(0)}% above average`),f="high",N!=="volume"?N="premium":N="multiple"):r>x*2&&(y.push(`Premium ${(r/x*100).toFixed(0)}% above average`),f!=="high"&&(f="medium")),o>5?(y.push(`${o} sweeps detected`),f="high",N=N==="volume"||N==="premium"?"multiple":"sweep"):o>2&&(y.push(`${o} sweeps detected`),f==="low"&&(f="medium")),l>5?(y.push(`Heavy call bias (${l.toFixed(1)}:1)`),f==="low"&&(f="medium")):l<.2&&(y.push(`Heavy put bias (1:${(1/l).toFixed(1)})`),f==="low"&&(f="medium")),u>5e3&&(y.push(`Large avg trade size: ${E(Math.round(u))}`),f==="low"&&(f="medium")),y.length>0?{ticker:n,alertType:N,severity:f,reason:y.join(" • "),metrics:{totalVolume:c,totalPremium:r,callPutRatio:l,sweepCount:o,avgTradeSize:u}}:null}function Le(s,n=5){if(s.length===0)return[];const i=new Map;return s.forEach(r=>{const a=i.get(r.strike)||{volume:0,openInterest:0,premium:0,callVolume:0,putVolume:0},t=parseFloat(r.premium.replace(/[$,]/g,""))||0;a.volume+=r.volume,a.openInterest+=r.openInterest,a.premium+=t,r.optionType==="Call"?a.callVolume+=r.volume:a.putVolume+=r.volume,i.set(r.strike,a)}),Array.from(i.entries()).map(([r,a])=>{const t=Math.max(...Array.from(i.values()).map(N=>N.volume)),l=Math.max(...Array.from(i.values()).map(N=>N.openInterest)),o=Math.max(...Array.from(i.values()).map(N=>N.premium)),u=t>0?a.volume/t:0,p=l>0?a.openInterest/l:0,d=o>0?a.premium/o:0,x=u*.4+p*.4+d*.2;let y="low";x>.7?y="high":x>.4&&(y="medium");let f="both";return a.callVolume>a.putVolume*2?f="call":a.putVolume>a.callVolume*2&&(f="put"),{strike:r,volume:a.volume,openInterest:a.openInterest,premium:a.premium,significance:y,type:f,combinedScore:x}}).sort((r,a)=>a.combinedScore-r.combinedScore).slice(0,n).map(({combinedScore:r,...a})=>a)}function Fe(s,n){if(s.length===0)return[];const i=new Map;return s.forEach(r=>{const a=i.get(r.strike)||{callVolume:0,putVolume:0,callOI:0,putOI:0};r.optionType==="Call"?(a.callVolume+=r.volume,a.callOI+=r.openInterest):(a.putVolume+=r.volume,a.putOI+=r.openInterest),i.set(r.strike,a)}),Array.from(i.entries()).map(([r,a])=>{let t=1;if(n){const d=Math.abs(r-n)/n;d<.05?t=2:d<.1?t=1.5:d>.2&&(t=.5)}const l=(a.putOI-a.callOI)*t,o=Math.abs(l),u=Math.max(...Array.from(i.values()).map(d=>Math.abs(d.putOI-d.callOI)));let p="low";if(u>0){const d=o/u;d>.7?p="extreme":d>.4?p="high":d>.2&&(p="moderate")}return{strike:r,netGammaExposure:l,callVolume:a.callVolume,putVolume:a.putVolume,callOI:a.callOI,putOI:a.putOI,level:p}}).sort((r,a)=>r.strike-a.strike)}function Ie(s){if(s.length===0)return null;const n=[...new Set(s.map(a=>a.strike))].sort((a,t)=>a-t),i=new Map;n.forEach(a=>{let t=0;s.forEach(l=>{const{strike:o,optionType:u,openInterest:p}=l;u==="Call"?a<o&&(t+=p*(o-a)):a>o&&(t+=p*(a-o))}),i.set(a,t)});let c=n[0],r=i.get(n[0])||0;return i.forEach((a,t)=>{a>r&&(r=a,c=t)}),c}function Re(s,n,i){const c=n.filter(r=>r.ticker===s);return{ticker:s,unusualActivity:Ae(c,s,n),keyPriceLevels:Le(c,5),gammaExposure:Fe(c,i),maxPainStrike:Ie(c),currentPrice:i}}const Oe=(s,n)=>{try{let i;return n?i=n:i=new Date(s),isNaN(i.getTime())?"Unknown":i.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" "+i.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return"Unknown"}},le=v.memo(({tickers:s,onTickerSelect:n,allData:i})=>{const[c,r]=v.useState("recent"),a=v.useMemo(()=>{const t=[...s];switch(c){case"recent":return t.sort((l,o)=>l.lastActivityDate&&o.lastActivityDate?o.lastActivityDate.getTime()-l.lastActivityDate.getTime():0);case"oldest":return t.sort((l,o)=>l.lastActivityDate&&o.lastActivityDate?l.lastActivityDate.getTime()-o.lastActivityDate.getTime():0);case"volume-high":return t.sort((l,o)=>o.totalVolume-l.totalVolume);case"volume-low":return t.sort((l,o)=>l.totalVolume-o.totalVolume);case"calls-high":return t.sort((l,o)=>o.callVolume-l.callVolume);case"puts-high":return t.sort((l,o)=>o.putVolume-l.putVolume);case"premium-high":return t.sort((l,o)=>o.totalPremium-l.totalPremium);case"premium-low":return t.sort((l,o)=>l.totalPremium-o.totalPremium);default:return t}},[s,c]);return e.jsxs("div",{className:"ticker-list",children:[e.jsxs("div",{className:"ticker-list-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h2",{children:"Options Volume Dashboard"}),e.jsx("p",{children:"Click on any ticker to view detailed volume profile"})]}),e.jsxs("div",{className:"sort-controls",children:[e.jsx(te,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:t=>r(t.target.value),children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"volume-high",children:"Volume (High to Low)"}),e.jsx("option",{value:"volume-low",children:"Volume (Low to High)"}),e.jsx("option",{value:"calls-high",children:"Calls (High to Low)"}),e.jsx("option",{value:"puts-high",children:"Puts (High to Low)"}),e.jsx("option",{value:"premium-high",children:"Premium (High to Low)"}),e.jsx("option",{value:"premium-low",children:"Premium (Low to High)"})]})]})]}),e.jsx("div",{className:"ticker-grid",children:a.map(t=>{const l=t.callVolume>t.putVolume,o=t.putVolume>t.callVolume,u=l?"call-dominant":o?"put-dominant":"balanced",p=Re(t.ticker,i);return e.jsxs("div",{className:`ticker-card ${u}`,onClick:()=>n(t.ticker),children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h3",{className:"ticker-symbol",children:t.ticker}),e.jsxs("div",{className:"ticker-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx(de,{className:"metric-icon call"}),e.jsx("span",{className:"metric-label",children:"Calls"}),e.jsx("span",{className:"metric-value",children:E(t.callVolume)})]}),e.jsxs("div",{className:"metric",children:[e.jsx(ue,{className:"metric-icon put"}),e.jsx("span",{className:"metric-label",children:"Puts"}),e.jsx("span",{className:"metric-value",children:E(t.putVolume)})]})]})]}),e.jsxs("div",{className:"ticker-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Volume:"}),e.jsx("span",{className:"detail-value",children:E(t.totalVolume)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Premium:"}),e.jsx("span",{className:"detail-value",children:Ee(t.totalPremium)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(se,{className:"detail-icon"}),e.jsx("span",{className:"detail-label",children:"Expiries:"}),e.jsx("span",{className:"detail-value",children:t.uniqueExpiries.length})]}),t.lastTrade&&e.jsxs("div",{className:"detail-row last-trade-row",children:[e.jsx("span",{className:"detail-label",children:"Last Trade:"}),e.jsxs("span",{className:"detail-value last-trade",children:[t.lastTrade.optionType," $",t.lastTrade.strike,e.jsx("span",{className:`trade-side ${t.lastTrade.optionType.toLowerCase()}`,children:t.lastTrade.optionType==="Call"?"↗":"↘"}),E(t.lastTrade.volume)]})]})]}),(p.keyPriceLevels.length>0||p.maxPainStrike)&&e.jsxs("div",{className:"ticker-analytics",children:[p.keyPriceLevels.length>0&&e.jsxs("div",{className:"analytics-badge key-levels-badge",children:[e.jsx(pe,{size:12}),e.jsx("span",{className:"badge-label",children:"Key Levels:"}),e.jsx("span",{className:"badge-strikes",children:p.keyPriceLevels.slice(0,3).map((d,x)=>e.jsxs("span",{className:`level-strike level-${d.significance}`,title:`${d.type==="call"?"Call":d.type==="put"?"Put":"Call/Put"} - Vol: ${E(d.volume)}, OI: ${E(d.openInterest)}`,children:[x>0&&", ","$",d.strike]},d.strike))})]}),p.maxPainStrike&&e.jsxs("div",{className:"analytics-badge max-pain-badge",children:[e.jsx(he,{size:12}),e.jsx("span",{className:"badge-label",children:"Max Pain:"}),e.jsxs("span",{className:"badge-value",children:["$",p.maxPainStrike]})]})]}),e.jsx("div",{className:"ticker-footer",children:e.jsxs("div",{className:"last-activity",children:[e.jsx(xe,{className:"activity-icon"}),e.jsx("span",{children:Oe(t.lastActivity,t.lastActivityDate)})]})})]},t.ticker)})})]})});le.displayName="TickerList";const W=v.memo(({data:s,highestVolumeData:n,ticker:i,expiry:c,chartType:r,currentPrice:a,trades:t=[]})=>{const[l,o]=v.useState({visible:!1,x:0,y:0,content:null}),u=v.useCallback((m,g)=>g===0?0:Math.min(m/g*46,46),[]),p=v.useCallback((m,g)=>{const w=t.filter(b=>b.strike===m&&(!g||b.optionType===g)),V=w.reduce((b,C)=>b+C.volume,0),T=w.reduce((b,C)=>{const M=C.premium.replace(/[$,]/g,"");return b+(parseFloat(M)||0)},0),A=T>=1e6?(T/1e6).toFixed(2)+"M":T>=1e3?(T/1e3).toFixed(1)+"K":T.toFixed(0),_=T.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),I=[...new Set(w.map(b=>b.sweepType))].filter(Boolean),R=w.map(b=>b.volume).sort((b,C)=>C-b),F=[...new Set(w.map(b=>b.expiry))].sort(),j=V,$=w.sort((b,C)=>C.volume-b.volume).map(b=>({volume:b.volume,premium:b.premium,timestamp:b.timestamp,expiry:b.expiry}));return{strike:m,type:g,volume:V,trades:w.length,premium:A,premiumFull:_,sweepTypes:I,tradeVolumes:R,expiries:F,size:j,tradeDetails:$}},[t]),d=v.useCallback((m,g,w)=>{const V=m.currentTarget.getBoundingClientRect(),T=p(g,w);o({visible:!0,x:m.clientX,y:V.top-10,content:T})},[p]),x=v.useCallback(()=>{o(m=>({...m,visible:!1}))},[]),y=v.useCallback(m=>{o(g=>({...g,x:m.clientX}))},[]),f=v.useCallback(()=>a||(n==null?void 0:n.strike)||null,[a,n]),N=v.useCallback(m=>{const g=f();return g!==null&&Math.abs(m-g)<.01},[f]),h=v.useCallback(()=>s.sort((m,g)=>m.strike-g.strike),[s])(),k=v.useMemo(()=>{if(!h.length)return{maxVolume:0,minStrike:0,maxStrike:0,maxTotalVolume:0,totalVolumeSum:0};let m=0,g=0,w=1/0,V=-1/0,T=0;for(let A=0;A<h.length;A++){const _=h[A];m=Math.max(m,Math.max(_.callVolume,_.putVolume)),g=Math.max(g,_.totalVolume),w=Math.min(w,_.strike),V=Math.max(V,_.strike),T+=_.totalVolume}return{maxVolume:m,minStrike:w===1/0?0:w,maxStrike:V===-1/0?0:V,maxTotalVolume:g,totalVolumeSum:T}},[h]),P=v.useCallback(m=>{if(!h.length||k.maxStrike===k.minStrike)return 50;const g=h.findIndex(T=>T.strike===m);if(g===-1)return 50;const w=h.length,V=100/(w+1);if(r==="callput"){const T=w-1-g;return V*(T+1)}else return V*(g+1)},[h,k,r]),D=v.useCallback(m=>{if(!h.length||k.maxStrike===k.minStrike)return 50;const g=k.minStrike,w=k.maxStrike,V=Math.max(g,Math.min(w,m));let T=g,A=w,_=0,I=h.length-1;for(let M=0;M<h.length-1;M++){const L=h[M].strike,X=h[M+1].strike;if(L<=V&&V<=X){T=L,A=X,_=M,I=M+1;break}}const R=h.length,F=100/(R+1);let j,$;if(r==="callput"){const M=R-1-_,L=R-1-I;j=F*(M+1),$=F*(L+1)}else j=F*(_+1),$=F*(I+1);if(A===T)return j;const b=(V-T)/(A-T);return j+($-j)*b},[h,k,r]),O=v.useCallback(()=>Math.max(400,h.length*18+40),[h.length]);return s.length?r==="callput"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"volume-profile-chart modern-mirrored-chart",children:[e.jsxs("div",{className:"chart-header modern-header",children:[e.jsxs("h3",{children:[i," Call/Put Volume"]}),e.jsxs("div",{className:"header-info",children:[f()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",f()]})]}),c&&e.jsx("span",{className:"expiry-date",children:c})]})]}),e.jsx("div",{className:"chart-container modern-container",children:e.jsxs("div",{className:"chart-area modern-chart-area",style:{height:`${O()}px`},children:[e.jsx("div",{className:"center-line"}),e.jsx("div",{className:"strike-axis modern-strike-axis",children:h.map(m=>e.jsx("div",{className:"strike-line modern-strike-line",style:{top:`${P(m.strike)}%`},children:e.jsx("span",{className:`strike-label modern-strike-label ${N(m.strike)?"current-price-label":""}`,children:m.strike})},m.strike))}),e.jsx("div",{className:"volume-bars modern-volume-bars",children:h.map(m=>e.jsxs("div",{className:"strike-row modern-strike-row",style:{top:`${P(m.strike)}%`},children:[e.jsx("div",{className:"volume-bar call-bar modern-call-bar",style:{width:`${u(m.callVolume,k.maxVolume)}%`,right:"52%"},onMouseEnter:g=>d(g,m.strike,"Call"),onMouseLeave:x,onMouseMove:y,children:m.callVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:E(m.callVolume)})}),e.jsx("div",{className:"volume-bar put-bar modern-put-bar",style:{width:`${u(m.putVolume,k.maxVolume)}%`,left:"52%"},onMouseEnter:g=>d(g,m.strike,"Put"),onMouseLeave:x,onMouseMove:y,children:m.putVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:E(m.putVolume)})})]},m.strike))}),f()&&e.jsx("div",{className:"current-price-line",style:{top:`${D(f())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"105%",top:"50%",transform:"translateY(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",f().toFixed(2)]})})]})})]}),l.visible&&l.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${l.x+15}px`,top:`${l.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>o(m=>({...m,visible:!0})),onMouseLeave:x,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",l.content.strike]}),l.content.type&&e.jsx("span",{className:`tooltip-type ${l.content.type.toLowerCase()}`,children:l.content.type})]}),e.jsx("div",{className:"tooltip-body",children:l.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:l.content.tradeDetails.map((m,g)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:m.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:m.premium})]}),m.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(m.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!m.timestamp)return"N/A";const w=new Date(m.timestamp);return isNaN(w.getTime())?m.timestamp:`${w.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${w.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return m.timestamp||"N/A"}})()})]})]},g))})]})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"volume-profile-chart total-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[i," Total Volume"]}),e.jsxs("div",{className:"header-info",children:[f()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",f()]})]}),c&&e.jsx("span",{className:"expiry-date",children:c})]})]}),e.jsxs("div",{className:"chart-container vertical",children:[e.jsxs("div",{className:"chart-area vertical",style:{height:`${O()}px`},children:[e.jsx("div",{className:"volume-bars vertical",children:h.map(m=>e.jsx("div",{className:"strike-column",style:{left:`${P(m.strike)}%`},children:e.jsx("div",{className:"volume-bar total-bar vertical",style:{height:`${u(m.totalVolume,k.maxTotalVolume)}%`},onMouseEnter:g=>d(g,m.strike),onMouseLeave:x,onMouseMove:y,children:m.totalVolume>0&&e.jsxs("span",{className:"volume-text volume-text-top",children:[E(m.totalVolume),e.jsxs("span",{className:"volume-percentage",children:["(",k.totalVolumeSum>0?(m.totalVolume/k.totalVolumeSum*100).toFixed(1):"0.0","%)"]})]})})},m.strike))}),f()&&e.jsx("div",{className:"current-price-line vertical",style:{left:`${D(f())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"50%",top:"-30px",transform:"translateX(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",f().toFixed(2)]})})]}),e.jsx("div",{className:"x-axis-labels",children:h.map(m=>e.jsx("div",{className:"x-axis-label",style:{left:`${P(m.strike)}%`},children:e.jsx("span",{className:`strike-label ${N(m.strike)?"current-price-label":""}`,children:m.strike})},m.strike))})]}),l.visible&&l.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${l.x+15}px`,top:`${l.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>o(m=>({...m,visible:!0})),onMouseLeave:x,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",l.content.strike]}),l.content.type&&e.jsx("span",{className:`tooltip-type ${l.content.type.toLowerCase()}`,children:l.content.type})]}),e.jsx("div",{className:"tooltip-body",children:l.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:l.content.tradeDetails.map((m,g)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:m.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:m.premium})]}),m.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(m.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!m.timestamp)return"N/A";const w=new Date(m.timestamp);return isNaN(w.getTime())?m.timestamp:`${w.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${w.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return m.timestamp||"N/A"}})()})]})]},g))})]})})]})]})}):e.jsxs("div",{className:"volume-profile-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[i," ",r==="callput"?"Call/Put Volume":"Total Volume"]}),c&&e.jsx("span",{className:"expiry-date",children:c})]}),e.jsx("div",{className:"no-data",children:e.jsxs("p",{children:["No volume data available for this ticker",c?" and expiry date":""]})})]})});W.displayName="VolumeProfileChart";const ie=v.memo(({trade:s})=>{const n=a=>{try{const t=a.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(t){const[,,o,u,,p,d,x]=t;let y=parseInt(p);x.toUpperCase()==="PM"&&y!==12?y+=12:x.toUpperCase()==="AM"&&y===12&&(y=0);const S=`${{january:"01",february:"02",march:"03",april:"04",may:"05",june:"06",july:"07",august:"08",september:"09",october:"10",november:"11",december:"12"}[o.toLowerCase()]||"01"}/${u.padStart(2,"0")}`,h=`${y.toString().padStart(2,"0")}:${d}`;return`${S} ${h}`}const l=new Date(a);return isNaN(l.getTime())?"Unknown":l.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit"})+" "+l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return"Unknown"}},r=(a=>{const t=a.replace(/[$,]/g,""),l=parseFloat(t);return a.includes("M")?l*1e6:a.includes("K")?l*1e3:l})(s.premium)>=1e6;return e.jsxs("div",{className:"trade-row-horizontal",style:{backgroundColor:s.optionType==="Call"?r?"rgba(0, 80, 0, 0.7)":"rgba(0, 100, 0, 0.5)":r?"rgba(100, 0, 0, 0.7)":"rgba(139, 0, 0, 0.5)"},children:[e.jsx("div",{className:"trade-cell-h symbol",children:s.ticker}),e.jsx("div",{className:"trade-cell-h strike",children:s.strike}),e.jsx("div",{className:"trade-cell-h expiry",children:new Date(s.expiry).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})}),e.jsx("div",{className:"trade-cell-h type",children:s.optionType}),e.jsx("div",{className:"trade-cell-h side",children:s.sweepType}),e.jsx("div",{className:"trade-cell-h size",children:E(s.volume)}),e.jsx("div",{className:"trade-cell-h premium",children:s.premium}),e.jsx("div",{className:"trade-cell-h volume",children:E(s.volume)}),e.jsx("div",{className:"trade-cell-h oi",children:E(s.openInterest)}),e.jsx("div",{className:"trade-cell-h exec-time",children:n(s.timestamp)})]})});ie.displayName="TradeRow";const ne=v.memo(({trades:s,ticker:n,expiry:i})=>{const[c,r]=v.useState("trade-date"),a=v.useMemo(()=>[...s].sort((o,u)=>{switch(c){case"trade-date":{const p=H(o.timestamp),d=H(u.timestamp);return!p||!d?0:d.getTime()-p.getTime()}case"expiry-date":{const p=new Date(o.expiry),d=new Date(u.expiry);return p.getTime()-d.getTime()}case"size":return u.volume-o.volume;default:return 0}}),[s,c]),t=v.useMemo(()=>i?a.filter(o=>o.expiry===i):a,[a,i]);if(t.length===0)return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("h3",{children:[n," Trade History"]}),i&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(i).toLocaleDateString()]})]}),e.jsx("div",{className:"no-trades",children:e.jsxs("p",{children:["No trades found for ",n,i?` on ${new Date(i).toLocaleDateString()}`:""]})})]});const l=v.useCallback((o,u)=>`${o.ticker}-${o.strike}-${o.expiry}-${o.timestamp}-${u}`,[]);return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsxs("h3",{children:[n," Trade History"]}),i&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(i).toLocaleDateString()]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"sort-controls",children:[e.jsx(te,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:o=>r(o.target.value),children:[e.jsx("option",{value:"trade-date",children:"Sort by Trade Date (Recent First)"}),e.jsx("option",{value:"expiry-date",children:"Sort by Expiry Date (Earliest First)"}),e.jsx("option",{value:"size",children:"Sort by Size (Largest First)"})]})]}),e.jsxs("div",{className:"trade-count",children:[t.length," trades"]})]})]}),e.jsx("div",{className:"trade-list-content",children:e.jsxs("div",{className:"trade-list-table",children:[e.jsxs("div",{className:"trade-table-header",children:[e.jsx("div",{className:"header-cell",children:"Symbol"}),e.jsx("div",{className:"header-cell",children:"Strike"}),e.jsx("div",{className:"header-cell",children:"Expiration"}),e.jsx("div",{className:"header-cell",children:"Call/Put"}),e.jsx("div",{className:"header-cell",children:"Side"}),e.jsx("div",{className:"header-cell",children:"Size"}),e.jsx("div",{className:"header-cell",children:"Premium"}),e.jsx("div",{className:"header-cell",children:"Volume"}),e.jsx("div",{className:"header-cell",children:"OI"}),e.jsx("div",{className:"header-cell",children:"Exec Time"})]}),e.jsx("div",{className:"trade-table-body",children:t.map((o,u)=>e.jsx(ie,{trade:o,index:u},l(o,u)))})]})})]})});ne.displayName="TradeList";function Ue(s){const n=s.includes("K"),i=s.includes("M"),c=s.replace(/[$,]/g,""),r=parseFloat(c);return i?r*1e6:n?r*1e3:r}const He=({trades:s,currentPrice:n})=>{const{heatmapData:i,strikes:c,expiries:r,maxAbsValue:a}=v.useMemo(()=>{const d=new Map,x=new Set,y=new Set;s.forEach(h=>{const k=`${h.strike}_${h.expiry}`;x.add(h.strike),y.add(h.expiry),d.has(k)||d.set(k,{value:0,volume:0,callVolume:0,putVolume:0,trades:0});const P=d.get(k),D=Ue(h.premium);Math.abs(D)<10&&h.ticker==="TSLA"&&console.log(`Small premium detected: ${h.ticker} ${h.strike} ${h.expiry} ${h.optionType} - Premium: "${h.premium}" -> Parsed: ${D}`),h.optionType==="Call"?(P.value+=D,P.callVolume+=h.volume):(P.value-=D,P.putVolume+=h.volume),P.volume+=h.volume,P.trades+=1});const f=Array.from(x).sort((h,k)=>k-h),N=Array.from(y).sort((h,k)=>{const P=new Date(h),D=new Date(k);return P.getTime()-D.getTime()});let S=0;return d.forEach(h=>{const k=Math.abs(h.value);k>S&&(S=k)}),{heatmapData:d,strikes:f,expiries:N,maxAbsValue:S}},[s]),t=(d,x)=>{if(x===0)return"rgba(255, 255, 255, 0.03)";const f=.2+Math.abs(d)/a*.6;return d>0?`rgba(76, 175, 80, ${f})`:`rgba(244, 67, 54, ${f})`},l=d=>{const x=Math.abs(d);return x>=1e6?`${d>=0?"":"-"}$${(x/1e6).toFixed(1)}M`:x>=1e3?`${d>=0?"":"-"}$${(x/1e3).toFixed(1)}K`:x>=1?`${d>=0?"":"-"}$${x.toFixed(0)}`:`${d>=0?"":"-"}$${x.toFixed(2)}`},o=d=>n?Math.abs(d-n)<2:!1,u=(d,x)=>`${d}_${x}`,p=c.length>0&&r.length>0;return e.jsxs("div",{className:"strike-expiry-heatmap",children:[e.jsxs("div",{className:"heatmap-header",children:[e.jsx("h3",{children:"Strike × Expiry Premium Heatmap"}),e.jsxs("div",{className:"heatmap-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(76, 175, 80, 0.6)"}}),e.jsx("span",{children:"Call Premium"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(244, 67, 54, 0.6)"}}),e.jsx("span",{children:"Put Premium"})]}),n&&e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(255, 193, 7, 0.4)",border:"2px solid #ffc107"}}),e.jsxs("span",{children:["Current Price (~$",n.toFixed(2),")"]})]})]})]}),e.jsx("div",{className:"heatmap-scroll-container",children:p?e.jsxs("table",{className:"heatmap-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"heatmap-corner",children:"Strike"}),r.map(d=>e.jsx("th",{className:"heatmap-expiry",children:new Date(d).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"})},d))]})}),e.jsx("tbody",{children:c.map(d=>{const x=o(d);return e.jsxs("tr",{className:x?"current-price-row":"",children:[e.jsxs("td",{className:`heatmap-strike ${x?"at-money":""}`,children:[d.toFixed(1),x&&e.jsx("span",{className:"atm-indicator",children:"▶"})]}),r.map(y=>{const f=i.get(u(d,y)),N=f&&f.volume>0;return e.jsx("td",{className:`heatmap-cell ${N?"has-data":""} ${x?"at-money-cell":""}`,style:{background:N?t(f.value,f.volume):void 0},title:N?`Strike: $${d}
Expiry: ${y}
Net Premium: ${l(f.value)}
Volume: ${f.volume}
Calls: ${f.callVolume}
Puts: ${f.putVolume}
Trades: ${f.trades}`:void 0,children:N&&e.jsx("div",{className:"cell-content",children:e.jsx("span",{className:"cell-value",children:l(f.value)})})},`${d}_${y}`)})]},d)})})]}):e.jsxs("div",{className:"heatmap-no-data",children:[e.jsx("p",{children:"No heatmap data available"}),e.jsx("p",{children:"Select a ticker with options data to view the heatmap"})]})})]})};function oe(s){try{const n=s.match(/options_data_(\d{4}-\d{2}-\d{2})_(\d{2}-\d{2})\.csv/);if(!n)return null;const[,i,c]=n,[r,a,t]=i.split("-").map(Number),[l,o]=c.split("-").map(Number);return new Date(r,a-1,t,l,o)}catch{return null}}async function Be(){return["options_data_2025-10-15_TSLA.csv","options_data_2025-10-16_16-00.csv","options_data_2025-10-16_15-00.csv","options_data_2025-10-16_12-00.csv","options_data_2025-10-16_10-30.csv","options_data_2025-10-15_16-00.csv","options_data_2025-10-15_14-00.csv","options_data_2025-10-15_11-30.csv","options_data_2025-10-15_10-00.csv","options_data_2025-10-14_16-00.csv","options_data_2025-10-14_15-00.csv","options_data_2025-10-14_11-00.csv","options_data_2025-10-14_01-00.csv","options_data_2025-10-13_13-20.csv","options_data_2025-10-13_13-00.csv","options_data_2025-10-13_10-50.csv","options_data_2025-10-13_10-00.csv","options_data_2025-10-13_05-30.csv","options_data_2024-01-15_16-00.csv","options_data_2024-01-15_11-30.csv","options_data_2024-01-15_11-00.csv","options_data_2024-01-15_10-00.csv","options_data_2024-01-15_02-30.csv"].map(n=>({filename:n,timestamp:oe(n)||new Date,size:0})).sort((n,i)=>i.timestamp.getTime()-n.timestamp.getTime())}async function J(s,n=!1){try{const i=n?`?t=${Date.now()}`:"",r=await fetch(`/optionAnalysis/data/${s}${i}`,{cache:n?"no-store":"default",headers:{"Cache-Control":n?"no-cache, no-store, must-revalidate":"default",Pragma:n?"no-cache":"default"}});if(!r.ok)throw new Error(`Failed to load ${s}: ${r.status} ${r.statusText}`);const a=await r.text(),t=oe(s);return{filename:s,timestamp:t||new Date,data:a}}catch(i){return{filename:s,timestamp:new Date,data:"",error:i instanceof Error?i.message:"Unknown error"}}}const U=new Map,ze=5*60*1e3;async function Q(s=!1){try{const n=await Be(),i=Date.now();if(s){const u=n.map(x=>J(x.filename,!0)),p=await Promise.all(u);return p.forEach(x=>{x.error||U.set(x.filename,{data:x,timestamp:i})}),p.filter(x=>!x.error)}const c=[],r=[];n.forEach(u=>{const p=U.get(u.filename);p&&i-p.timestamp<ze?c.push(p.data):r.push(u.filename)});let a=[];if(r.length>0){const u=r.map(p=>J(p,!1));a=await Promise.all(u),a.forEach(p=>{p.error||U.set(p.filename,{data:p,timestamp:i})})}const t=[...c,...a],l=t.filter(u=>!u.error),o=t.filter(u=>u.error);return l}catch(n){return console.error("Failed to load data files:",n),[]}}function Ke(){U.clear()}async function qe(s){var i,c,r,a;const n="d3mgi7hr01qmso33ob30d3mgi7hr01qmso33ob3g";try{const t=`https://finnhub.io/api/v1/quote?symbol=${s}&token=${n}`,l=await fetch(t);if(l.ok){const o=await l.json(),u=o==null?void 0:o.c;if(u&&typeof u=="number"&&u>0)return u}}catch{}try{let t=`https://query1.finance.yahoo.com/v8/finance/chart/${s}?interval=1d&range=1d`,l=await fetch(t,{mode:"cors",headers:{Accept:"application/json"}});if(!l.ok||l.status===0){const p=`https://api.allorigins.win/raw?url=${encodeURIComponent(t)}`;l=await fetch(p)}if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const o=await l.json(),u=(a=(r=(c=(i=o==null?void 0:o.chart)==null?void 0:i.result)==null?void 0:c[0])==null?void 0:r.meta)==null?void 0:a.regularMarketPrice;return u&&typeof u=="number"?u:null}catch{return null}}const Y=new Map,We=9e5;async function ee(s){const n=Y.get(s),i=Date.now();if(n&&i-n.timestamp<We)return{price:n.price,source:"api",cached:!0};const c=await qe(s);return c!==null?(Y.set(s,{price:c,timestamp:i}),{price:c,source:"api",cached:!1}):{price:null,source:"none",cached:!1}}function Ye(){Y.clear()}const Xe=()=>{var F;const[s,n]=v.useState(null),[i,c]=v.useState(null),[r,a]=v.useState([]),[t,l]=v.useState(null),[o,u]=v.useState(!0),[p,d]=v.useState(null),[x,y]=v.useState(null),[f,N]=v.useState("none"),[S,h]=v.useState(!1),[k,P]=v.useState("");v.useEffect(()=>{(async($=!1)=>{try{u(!0),d(null);const b=await Q($);if(b.length===0)throw new Error("No data files found in the data directory");const{mergedData:C,info:M}=G(b.map(L=>({filename:L.filename,data:L.data,timestamp:L.timestamp})));a(C),l(M),u(!1)}catch(b){console.error("Error loading data files:",b),d(b instanceof Error?b.message:"Failed to load data"),u(!1)}})(!1)},[]);const D=v.useMemo(()=>Pe(r),[r]),O=v.useMemo(()=>{if(!k.trim())return D;const j=k.toLowerCase();return D.filter($=>$.ticker.toLowerCase().includes(j))},[D,k]),m=v.useMemo(()=>s?De(r,s):[],[r,s]),g=v.useMemo(()=>s?Ce(r,s,i||void 0):[],[r,s,i]),w=v.useMemo(()=>s?r.filter(j=>{const $=j.ticker===s,b=!i||j.expiry===i;return $&&b}):[],[r,s,i]),V=v.useMemo(()=>s?_e(r,s,i||void 0):null,[r,s,i]),T=v.useMemo(()=>s?r.filter(j=>j.ticker===s&&(!i||j.expiry===i)):[],[r,s,i]),A=v.useCallback(j=>{n(j),c(null)},[]),_=v.useCallback(()=>{n(null),c(null)},[]),I=v.useCallback(j=>{c(j===i?null:j)},[i]),R=v.useCallback(async()=>{try{console.log("🔄 Performing hard refresh..."),Se(),Ye(),Ke();try{localStorage.clear(),sessionStorage.clear()}catch(C){console.warn("Could not clear storage:",C)}console.log("✓ All caches cleared"),console.log("🔄 Reloading data with cache bypass..."),u(!0),d(null);const j=await Q(!0);if(j.length===0)throw new Error("No data files found in the data directory");const{mergedData:$,info:b}=G(j.map(C=>({filename:C.filename,data:C.data,timestamp:C.timestamp})));if(a($),l(b),y(null),N("none"),h(!1),s){const{price:C,source:M,cached:L}=await ee(s);y(C),N(M),h(L)}u(!1),console.log("✓ Data reloaded successfully:",{files:b.totalFiles,records:b.totalRecords,latestData:b.dateRange.latest})}catch(j){console.error("Error during hard refresh:",j),d(j instanceof Error?j.message:"Failed to refresh data"),u(!1)}},[s]);return v.useEffect(()=>{if(!s){y(null),N("none"),h(!1);return}(async()=>{const $=await ee(s);y($.price),N($.source),h($.cached)})()},[s]),o?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading options data from multiple files..."})]}):p?e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error Loading Data"}),e.jsx("p",{children:p}),e.jsx("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"options-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"Option Analysis Dashboard"}),t&&e.jsxs("div",{className:"header-stats",children:[e.jsxs("span",{className:"header-stat",children:[t.totalFiles," files"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsxs("span",{className:"header-stat",children:[t.totalRecords.toLocaleString()," records"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsx("span",{className:"header-stat",children:((F=t.dateRange.latest)==null?void 0:F.toLocaleString())||"Unknown"})]})]}),!s&&e.jsxs("div",{className:"search-container-header",children:[e.jsx(fe,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search tickers...",value:k,onChange:j=>P(j.target.value)}),k&&e.jsx("button",{className:"clear-search",onClick:()=>P(""),title:"Clear search",children:"×"})]}),e.jsxs("button",{className:"refresh-button-compact",onClick:R,title:"Hard Refresh - Clears all caches and reloads data from files",children:[e.jsx(ve,{className:"refresh-icon"}),"Hard Refresh"]})]}),s?e.jsxs("div",{className:"ticker-detail-view",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("button",{className:"back-button",onClick:_,children:[e.jsx(ge,{className:"back-icon"}),"Back to Ticker List"]}),e.jsxs("h2",{children:[s," Options Analysis"]}),x&&f==="api"?e.jsxs("span",{className:"current-price-badge",children:[e.jsx("span",{className:"price-indicator"}),"Current Price: $",x.toFixed(2),e.jsxs("span",{className:"price-status",children:["(",S?"Cached":"Live",")"]})]}):e.jsx("span",{className:"price-unavailable",children:"Price unavailable"})]}),e.jsxs("div",{className:"expiry-filter",children:[e.jsxs("div",{className:"filter-header",children:[e.jsx(se,{className:"filter-icon"}),e.jsx("span",{children:"Filter by Expiry Date:"})]}),e.jsxs("div",{className:"expiry-buttons",children:[e.jsx("button",{className:`expiry-button ${i?"":"active"}`,onClick:()=>c(null),children:"All Expiries"}),m.map(j=>e.jsx("button",{className:`expiry-button ${i===j?"active":""}`,onClick:()=>I(j),children:new Date(j).toLocaleDateString()},j))]})]}),e.jsxs("div",{className:"charts-section",children:[e.jsx("div",{className:"chart-column",children:e.jsx(W,{data:g,highestVolumeData:V,ticker:s,expiry:i||void 0,chartType:"callput",currentPrice:x||void 0,trades:w})}),e.jsx("div",{className:"chart-column",children:e.jsx(W,{data:g,highestVolumeData:V,ticker:s,expiry:i||void 0,chartType:"total",currentPrice:x||void 0,trades:w})})]}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Total Volume"}),e.jsx("p",{children:g.reduce((j,$)=>j+$.totalVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Call Volume"}),e.jsx("p",{children:g.reduce((j,$)=>j+$.callVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Put Volume"}),e.jsx("p",{children:g.reduce((j,$)=>j+$.putVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Open Interest"}),e.jsx("p",{children:g.reduce((j,$)=>j+$.openInterest,0).toLocaleString()})]})]}),e.jsxs("div",{className:"heatmap-trades-section",children:[e.jsx("div",{className:"heatmap-column",children:e.jsx(He,{trades:T,currentPrice:x||void 0})}),e.jsx("div",{className:"trades-column",children:e.jsxs("div",{className:"trade-list-section",children:[e.jsxs("h3",{children:["Trade History for ",s]}),e.jsxs("p",{children:["Found ",T.length," trades"]}),e.jsx(ne,{trades:T,ticker:s,expiry:i||void 0})]})})]})]}):e.jsx(le,{tickers:O,onTickerSelect:A,allData:r})]})};class Ze extends v.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,i){console.error("ErrorBoundary caught an error:",n,i),this.setState({error:n,errorInfo:i})}render(){var n,i;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"An error occurred while rendering this component."}),e.jsxs("details",{className:"error-details",children:[e.jsx("summary",{children:"Error Details"}),e.jsx("pre",{children:(n=this.state.error)==null?void 0:n.toString()}),e.jsx("pre",{children:(i=this.state.errorInfo)==null?void 0:i.componentStack})]}),e.jsx("button",{className:"retry-button",onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),children:"Try Again"})]})}):this.props.children}}function Ge(){return e.jsx("div",{className:"app",children:e.jsx("main",{children:e.jsx(Ze,{children:e.jsx(Xe,{})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{const s="/optionAnalysis/";navigator.serviceWorker.register(`${s}sw.js`).then(n=>{console.log("SW registered: ",n)}).catch(n=>{console.log("SW registration failed: ",n)})});z.createRoot(document.getElementById("root")).render(e.jsx(me.StrictMode,{children:e.jsx(Ge,{})}));
//# sourceMappingURL=index-7d62355a-1760712994035.js.map
