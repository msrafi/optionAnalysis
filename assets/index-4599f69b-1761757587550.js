import{r as g,a as Xe,R as Ze}from"./vendor-b1791c80-1761757587550.js";import{A as ge,T as Me,a as Ae,C as ye,b as Ee,S as Fe,R as Y,c as G,d as et,e as Se}from"./utils-4f5e302a-1761757587550.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var _e={exports:{}},de={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tt=g,st=Symbol.for("react.element"),at=Symbol.for("react.fragment"),rt=Object.prototype.hasOwnProperty,lt=tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,it={key:!0,ref:!0,__self:!0,__source:!0};function Le(t,s,r){var c,n={},o=null,l=null;r!==void 0&&(o=""+r),s.key!==void 0&&(o=""+s.key),s.ref!==void 0&&(l=s.ref);for(c in s)rt.call(s,c)&&!it.hasOwnProperty(c)&&(n[c]=s[c]);if(t&&t.defaultProps)for(c in s=t.defaultProps,s)n[c]===void 0&&(n[c]=s[c]);return{$$typeof:st,type:t,key:o,ref:l,props:n,_owner:lt.current}}de.Fragment=at;de.jsx=Le;de.jsxs=Le;_e.exports=de;var e=_e.exports,pe={},be=Xe;pe.createRoot=be.createRoot,pe.hydrateRoot=be.hydrateRoot;const ee="optionAnalysis_parseCache",te="optionAnalysis_darkPoolParseCache",se="optionAnalysis_tickerSummaryCache",ae="optionAnalysis_darkPoolTickerSummaryCache";function nt(t){try{const s=sessionStorage.getItem(t);if(s){const r=JSON.parse(s),c=new Map;for(const[n,o]of Object.entries(r))c.set(n,o);return c}}catch{}return new Map}function ot(t,s){try{const r=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(r))}catch{}}function ct(t){try{const s=sessionStorage.getItem(t);if(s){const r=JSON.parse(s),c=new Map;for(const[n,o]of Object.entries(r))c.set(n,o);return c}}catch{}return new Map}function dt(t,s){try{const r=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(r))}catch{}}function mt(t){try{const s=sessionStorage.getItem(t);if(s){const r=JSON.parse(s),c=new Map;for(const[n,o]of Object.entries(r))c.set(n,o);return c}}catch{}return new Map}function ut(t,s){try{const r=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(r))}catch{}}function ht(t){try{const s=sessionStorage.getItem(t);if(s){const r=JSON.parse(s),c=new Map;for(const[n,o]of Object.entries(r))c.set(n,o);return c}}catch{}return new Map}function pt(t,s){try{const r=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(r))}catch{}}function K(t){try{sessionStorage.removeItem(t)}catch{}}function xe(){K(ee),K(se)}function xt(){K(te),K(ae)}function ft(){K(ee),K(te),K(se),K(ae)}function q(t){try{if(!t)return null;const s=new Date,r=new Date(s.getFullYear(),s.getMonth(),s.getDate()),c={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},n=(l,i)=>{let a=parseInt(l);return i.toUpperCase()==="PM"&&a!==12?a+=12:i.toUpperCase()==="AM"&&a===12&&(a=0),a};let o=t.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(o){const[,,l,i,a,u,d,m]=o,x=c[l.toLowerCase()];if(x===void 0)return null;const h=n(u,m);return new Date(parseInt(a),x,parseInt(i),h,parseInt(d))}if(o=t.match(/Yesterday at (\d+):(\d+)\s+(AM|PM)/i),o){const[,l,i,a]=o,u=n(l,a),d=new Date(r);return d.setDate(d.getDate()-1),new Date(d.getFullYear(),d.getMonth(),d.getDate(),u,parseInt(i))}if(o=t.match(/(\d+):(\d+)\s+(AM|PM)/i),o){const[,l,i,a]=o,u=n(l,a);return new Date(r.getFullYear(),r.getMonth(),r.getDate(),u,parseInt(i))}return null}catch{return null}}function gt(t){try{if(!t)return!1;const s=t.split("/");if(s.length!==3)return!1;const r=parseInt(s[0])-1,c=parseInt(s[1]),n=parseInt(s[2]);return new Date(n,r,c,23,59,59)<new Date}catch{return!1}}function yt(t,s){var u,d;const r=`${s||"unknown"}_${t.length}_${t.slice(0,100)}`,c=nt(ee),n=c.get(r);if(n)return n;const o=t.split(`
`),l=[],i=Math.max(1e3,o.length*.8);l.length=i;let a=0;for(let m=1;m<o.length;m++){const x=o[m].trim();if(!x)continue;const h=Ie(x);if(!(h.length<19))try{const f=h[5]||"",w=h[6]||"",P=h[7]||"",y=parseFloat(h[8])||0,k=h[9]||"",v=h[10],j=parseInt(((u=h[12])==null?void 0:u.replace(/,/g,""))||"0"),D=h[13]||"$0",p=parseInt(((d=h[14])==null?void 0:d.replace(/,/g,""))||"0"),N=0,b=["Ask","Above","Bid","Below","Sweep","Block","Trade","Volume","Premium"],M=P&&P.length>=1&&P.length<=10&&!b.includes(P)&&!P.match(/^\d+$/)&&!P.includes(" ")&&/^[A-Z0-9]+$/.test(P),C=gt(k);M&&y>0&&k&&v&&j>0&&!C&&(l[a++]={ticker:P,strike:y,expiry:k,optionType:v,volume:j,premium:D,openInterest:p,bidAskSpread:N,timestamp:f,sweepType:w,sourceFile:s})}catch{}}return l.length=a,c.set(r,l),ot(ee,c),l}function vt(t){let s="empty";if(t.length>0){let i=null;t.forEach(a=>{const u=q(a.timestamp);u&&(!i||u>i)&&(i=u,s=a.timestamp)})}const r=`${t.length}_${t.slice(0,3).map(i=>`${i.ticker}_${i.timestamp}`).join("_")}_${s}`,c=mt(se),n=c.get(r);if(n)return n;const o=new Map;for(let i=0;i<t.length;i++){const a=t[i];if(!o.has(a.ticker)){const m=q(a.timestamp);o.set(a.ticker,{ticker:a.ticker,totalVolume:0,callVolume:0,putVolume:0,totalPremium:0,uniqueExpiries:[],expirySet:new Set,lastActivity:a.timestamp,lastActivityDate:m,lastTrade:{strike:a.strike,optionType:a.optionType,volume:a.volume,premium:a.premium,sweepType:a.sweepType,timestamp:a.timestamp}})}const u=o.get(a.ticker);u.totalVolume+=a.volume,u.totalPremium+=ve(a.premium),a.optionType==="Call"?u.callVolume+=a.volume:u.putVolume+=a.volume,u.expirySet.has(a.expiry)||(u.expirySet.add(a.expiry),u.uniqueExpiries.push(a.expiry));const d=q(a.timestamp);d&&u.lastActivityDate&&d>u.lastActivityDate?(u.lastActivity=a.timestamp,u.lastActivityDate=d,u.lastTrade={strike:a.strike,optionType:a.optionType,volume:a.volume,premium:a.premium,sweepType:a.sweepType,timestamp:a.timestamp}):d&&!u.lastActivityDate&&(u.lastActivity=a.timestamp,u.lastActivityDate=d,u.lastTrade||(u.lastTrade={strike:a.strike,optionType:a.optionType,volume:a.volume,premium:a.premium,sweepType:a.sweepType,timestamp:a.timestamp}))}const l=Array.from(o.values()).map(({expirySet:i,...a})=>a).sort((i,a)=>{const u=i.lastActivityDate instanceof Date?i.lastActivityDate:i.lastActivityDate?new Date(i.lastActivityDate):null,d=a.lastActivityDate instanceof Date?a.lastActivityDate:a.lastActivityDate?new Date(a.lastActivityDate):null;return u&&d&&u.getTime()!==d.getTime()?d.getTime()-u.getTime():a.totalVolume-i.totalVolume});return c.set(r,l),ut(se,c),l}function jt(t,s,r){const c=t.filter(o=>o.ticker===s&&(!r||o.expiry===r)),n=new Map;return c.forEach(o=>{n.has(o.strike)||n.set(o.strike,{strike:o.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const l=n.get(o.strike);l.totalVolume+=o.volume,l.openInterest+=o.openInterest,o.optionType==="Call"?l.callVolume+=o.volume:l.putVolume+=o.volume}),Array.from(n.values()).sort((o,l)=>o.strike-l.strike)}function Nt(t,s){const r=new Set;return t.forEach(c=>{c.ticker===s&&r.add(c.expiry)}),Array.from(r).sort((c,n)=>new Date(c).getTime()-new Date(n).getTime())}function wt(t,s,r){const c=t.filter(i=>i.ticker===s&&(!r||i.expiry===r));if(!c.length)return null;const n=new Map;c.forEach(i=>{n.has(i.strike)||n.set(i.strike,{strike:i.strike,callVolume:0,putVolume:0,openInterest:0,totalVolume:0});const a=n.get(i.strike);a.totalVolume+=i.volume,a.openInterest+=i.openInterest,i.optionType==="Call"?a.callVolume+=i.volume:a.putVolume+=i.volume});const l=Array.from(n.values()).reduce((i,a)=>a.totalVolume>i.totalVolume?a:i);return{strike:l.strike,totalVolume:l.totalVolume,callVolume:l.callVolume,putVolume:l.putVolume,openInterest:l.openInterest}}function ve(t){const s=t.replace(/[$,K]/g,""),r=parseFloat(s);return t.includes("K")?r*1e3:t.includes("M")?r*1e6:r}function U(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function z(t){return t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(0)}`}function re(t){const s=[],r=[];let c=null,n=null;const o=new Map;t.sort((a,u)=>{const d=a.timestamp instanceof Date?a.timestamp:new Date(a.timestamp);return(u.timestamp instanceof Date?u.timestamp:new Date(u.timestamp)).getTime()-d.getTime()}).forEach(a=>{const u=yt(a.data,a.filename);u.forEach(m=>{const x=`${m.ticker}_${m.strike}_${m.expiry}_${m.optionType}_${m.volume}_${m.premium}_${m.timestamp}`;o.has(x)||o.set(x,m)}),r.push({filename:a.filename,recordCount:u.length,timestamp:a.timestamp});const d=a.timestamp instanceof Date?a.timestamp:new Date(a.timestamp);(!c||d<c)&&(c=d),(!n||d>n)&&(n=d)}),s.push(...o.values()),s.sort((a,u)=>{const d=q(a.timestamp),m=q(u.timestamp);return!d||!m?0:m.getTime()-d.getTime()});const i={totalFiles:t.length,totalRecords:s.length,dateRange:{earliest:c,latest:n},files:r};return{mergedData:s,info:i}}function kt(t,s){var i,a,u,d,m;const r=`${s}-${t.length}`,c=ct(te),n=c.get(r);if(n)return n;const o=t.split(`
`),l=[];for(let x=1;x<o.length;x++){const h=o[x].trim();if(h)try{const f=Ie(h);if(f.length<14)continue;const w=(i=f[6])==null?void 0:i.replace(/"/g,"").trim(),P=(a=f[7])==null?void 0:a.replace(/"/g,"").replace(/,/g,"").trim(),y=(u=f[8])==null?void 0:u.replace(/"/g,"").trim(),k=(d=f[9])==null?void 0:d.replace(/"/g,"").trim(),v=(m=f[5])==null?void 0:m.replace(/"/g,"").trim();if(!w||w===""||w==="[")continue;const j=parseInt(P);if(isNaN(j)||j<=0)continue;const D=parseFloat(y);if(isNaN(D)||D<=0)continue;const p=q(v);if(!p)continue;l.push({ticker:w,quantity:j,price:D,totalValue:k,timestamp:p.toISOString(),sourceFile:s})}catch{continue}}return c.set(r,l),dt(te,c),l}function Ie(t){const s=[];let r="",c=!1;for(let n=0;n<t.length;n++){const o=t[n];o==='"'?c=!c:o===","&&!c?(s.push(r),r=""):r+=o}return s.push(r),s}function Te(t){const s=[];let r=0,c=null,n=null;const o=t.map(l=>{const i=kt(l.data,l.filename);return s.push(...i),r+=i.length,i.forEach(a=>{const u=new Date(a.timestamp);(!c||u<c)&&(c=u),(!n||u>n)&&(n=u)}),{filename:l.filename,recordCount:i.length,timestamp:l.timestamp}});return s.sort((l,i)=>new Date(i.timestamp).getTime()-new Date(l.timestamp).getTime()),{mergedData:s,info:{totalFiles:t.length,totalRecords:r,dateRange:{earliest:c,latest:n},files:o}}}function St(t){const s=`${t.length}_${t.slice(0,3).map(l=>`${l.ticker}_${l.timestamp}`).join("_")}`,r=ht(ae),c=r.get(s);if(c)return c;const n=new Map;t.forEach(l=>{const i=n.get(l.ticker)||{ticker:l.ticker,totalQuantity:0,totalValue:0,tradeCount:0,lastActivityDate:null,largestTrade:null};i.totalQuantity+=l.quantity,i.totalValue+=l.quantity*l.price,i.tradeCount+=1;const a=new Date(l.timestamp);(!i.lastActivityDate||a>i.lastActivityDate)&&(i.lastActivityDate=a),(!i.largestTrade||l.quantity>i.largestTrade.quantity)&&(i.largestTrade={quantity:l.quantity,price:l.price,totalValue:l.totalValue,timestamp:l.timestamp}),n.set(l.ticker,i)});const o=Array.from(n.values()).map(l=>({...l,averagePrice:l.totalValue/l.totalQuantity,lastActivity:l.lastActivityDate?l.lastActivityDate.toLocaleString():"Unknown"})).sort((l,i)=>i.totalValue-l.totalValue);return r.set(s,o),pt(ae,r),o}const bt=(t,s)=>{try{let r;if(s)r=s;else{const c=new Date,n=new Date(c.getFullYear(),c.getMonth(),c.getDate()),o={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},l=(a,u)=>{let d=parseInt(a);return u.toUpperCase()==="PM"&&d!==12?d+=12:u.toUpperCase()==="AM"&&d===12&&(d=0),d};let i=t.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(i){const[,,a,u,d,m,x,h]=i,f=o[a.toLowerCase()];if(f!==void 0){const w=l(m,h);r=new Date(parseInt(d),f,parseInt(u),w,parseInt(x))}else r=new Date(t)}else if(i=t.match(/Yesterday at (\d+):(\d+)\s+(AM|PM)/i)){const[,a,u,d]=i,m=l(a,d),x=new Date(n);x.setDate(x.getDate()-1),r=new Date(x.getFullYear(),x.getMonth(),x.getDate(),m,parseInt(u))}else if(i=t.match(/(\d+):(\d+)\s+(AM|PM)/i)){const[,a,u,d]=i,m=l(a,d);r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),m,parseInt(u))}else r=new Date(t)}return isNaN(r.getTime())?"":r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" "+r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}},Re=g.memo(({tickers:t,onTickerSelect:s,allData:r})=>{const[c,n]=g.useState("recent"),o=i=>{const a=r.filter(m=>m.ticker===i),u=new Date;u.setHours(0,0,0,0);let d=0;return a.forEach(m=>{let x;try{const h=m.timestamp,f=new Date,w=new Date(f.getFullYear(),f.getMonth(),f.getDate()),P={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},y=(j,D)=>{let p=parseInt(j);return D.toUpperCase()==="PM"&&p!==12?p+=12:D.toUpperCase()==="AM"&&p===12&&(p=0),p};let k=h.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(k){const[,,j,D,p,N,b,M]=k,C=P[j.toLowerCase()];if(C!==void 0){const V=y(N,M);x=new Date(parseInt(p),C,parseInt(D),V,parseInt(b))}else return}else if(k=h.match(/Yesterday at (\d+):(\d+)\s+(AM|PM)/i)){const[,j,D,p]=k,N=y(j,p),b=new Date(w);b.setDate(b.getDate()-1),x=new Date(b.getFullYear(),b.getMonth(),b.getDate(),N,parseInt(D))}else if(k=h.match(/(\d+):(\d+)\s+(AM|PM)/i)){const[,j,D,p]=k,N=y(j,p);x=new Date(w.getFullYear(),w.getMonth(),w.getDate(),N,parseInt(D))}else return;x.setHours(0,0,0,0),Math.floor((u.getTime()-x.getTime())/(1e3*60*60*24))===0&&(d+=m.volume)}catch{}}),d},l=g.useMemo(()=>{const i=[...t];switch(c){case"recent":return i.sort((a,u)=>{const d=a.lastActivityDate instanceof Date?a.lastActivityDate:a.lastActivityDate?new Date(a.lastActivityDate):null,m=u.lastActivityDate instanceof Date?u.lastActivityDate:u.lastActivityDate?new Date(u.lastActivityDate):null;return d&&m?m.getTime()-d.getTime():0});case"oldest":return i.sort((a,u)=>{const d=a.lastActivityDate instanceof Date?a.lastActivityDate:a.lastActivityDate?new Date(a.lastActivityDate):null,m=u.lastActivityDate instanceof Date?u.lastActivityDate:u.lastActivityDate?new Date(u.lastActivityDate):null;return d&&m?d.getTime()-m.getTime():0});case"volume-high":return i.sort((a,u)=>u.totalVolume-a.totalVolume);case"volume-low":return i.sort((a,u)=>a.totalVolume-u.totalVolume);case"calls-high":return i.sort((a,u)=>u.callVolume-a.callVolume);case"puts-high":return i.sort((a,u)=>u.putVolume-a.putVolume);case"premium-high":return i.sort((a,u)=>u.totalPremium-a.totalPremium);case"premium-low":return i.sort((a,u)=>a.totalPremium-u.totalPremium);case"today-volume-high":return i.sort((a,u)=>o(u.ticker)-o(a.ticker));case"today-volume-low":return i.sort((a,u)=>o(a.ticker)-o(u.ticker));default:return i}},[t,c]);return e.jsxs("div",{className:"ticker-list",children:[e.jsxs("div",{className:"ticker-list-header",children:[e.jsx("div",{className:"header-content",children:e.jsx("h2",{children:"Options Volume Dashboard"})}),e.jsxs("div",{className:"sort-controls",children:[e.jsx(ge,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:i=>n(i.target.value),children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"volume-high",children:"Volume (High to Low)"}),e.jsx("option",{value:"volume-low",children:"Volume (Low to High)"}),e.jsx("option",{value:"today-volume-high",children:"Today's Volume (High to Low)"}),e.jsx("option",{value:"today-volume-low",children:"Today's Volume (Low to High)"}),e.jsx("option",{value:"calls-high",children:"Calls (High to Low)"}),e.jsx("option",{value:"puts-high",children:"Puts (High to Low)"}),e.jsx("option",{value:"premium-high",children:"Premium (High to Low)"}),e.jsx("option",{value:"premium-low",children:"Premium (Low to High)"})]})]})]}),e.jsx("div",{className:"ticker-grid",children:l.map(i=>{const a=i.callVolume>i.putVolume,u=i.putVolume>i.callVolume,d=a?"call-dominant":u?"put-dominant":"balanced";return e.jsxs("div",{className:`ticker-card ${d}`,onClick:()=>s(i.ticker),children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h3",{className:"ticker-symbol",children:i.ticker}),e.jsxs("div",{className:"ticker-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx(Me,{className:"metric-icon call"}),e.jsx("span",{className:"metric-label",children:"Calls"}),e.jsx("span",{className:"metric-value",children:U(i.callVolume)})]}),e.jsxs("div",{className:"metric",children:[e.jsx(Ae,{className:"metric-icon put"}),e.jsx("span",{className:"metric-label",children:"Puts"}),e.jsx("span",{className:"metric-value",children:U(i.putVolume)})]})]})]}),e.jsxs("div",{className:"ticker-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Volume:"}),e.jsx("span",{className:"detail-value",children:U(i.totalVolume)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Premium:"}),e.jsx("span",{className:"detail-value",children:z(i.totalPremium)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(ye,{className:"detail-icon"}),e.jsx("span",{className:"detail-label",children:"Expiries:"}),e.jsx("span",{className:"detail-value",children:i.uniqueExpiries.length})]}),(()=>{const m=r.filter(y=>y.ticker===i.ticker),x=new Date,h=new Date(x.getFullYear(),x.getMonth(),x.getDate()),f=[0,0,0],w=[0,0,0],P=[0,0,0];return m.forEach(y=>{let k;try{const j=y.timestamp,D={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},p=(b,M)=>{let C=parseInt(b);return M.toUpperCase()==="PM"&&C!==12?C+=12:M.toUpperCase()==="AM"&&C===12&&(C=0),C};let N=j.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(N){const[,,b,M,C,V,$,A]=N,E=D[b.toLowerCase()];if(E!==void 0){const H=p(V,A);k=new Date(parseInt(C),E,parseInt(M),H,parseInt($))}else k=new Date(j)}else if(N=j.match(/Yesterday at (\d+):(\d+)\s+(AM|PM)/i)){const[,b,M,C]=N,V=p(b,C),$=new Date(h);$.setDate($.getDate()-1),k=new Date($.getFullYear(),$.getMonth(),$.getDate(),V,parseInt(M))}else if(N=j.match(/(\d+):(\d+)\s+(AM|PM)/i)){const[,b,M,C]=N,V=p(b,C);k=new Date(h.getFullYear(),h.getMonth(),h.getDate(),V,parseInt(M))}else k=new Date(j)}catch{return}k.setHours(0,0,0,0);const v=Math.floor((h.getTime()-k.getTime())/(1e3*60*60*24));v>=0&&v<=2&&(f[2-v]+=y.volume,y.optionType==="Call"?w[2-v]+=y.volume:P[2-v]+=y.volume)}),e.jsxs("div",{className:"detail-row volume-3day",children:[e.jsx("span",{className:"detail-label",children:"3-Day Volume:"}),e.jsxs("div",{className:"volume-breakdown",children:[e.jsxs("span",{className:"day-volume",children:[e.jsx("span",{className:"day-label",children:"Today:"}),e.jsx("span",{className:"day-value",children:U(f[2])})]}),e.jsxs("span",{className:"day-volume",children:[e.jsx("span",{className:"day-label",children:"-1:"}),e.jsx("span",{className:"day-value",children:U(f[1])})]}),e.jsxs("span",{className:"day-volume",children:[e.jsx("span",{className:"day-label",children:"-2:"}),e.jsx("span",{className:"day-value",children:U(f[0])})]})]})]})})()]}),(()=>{const m=r.filter(v=>v.ticker===i.ticker),x=new Date,h=new Date(x),f=new Date(x),w=x.getDay();h.setDate(x.getDate()-(w===0?6:w-1)),h.setHours(0,0,0,0),f.setDate(h.getDate()+6),f.setHours(23,59,59,999);const P=v=>{try{const j=v.split("/");if(j.length===3){const p=parseInt(j[0])-1,N=parseInt(j[1]),b=parseInt(j[2]);return new Date(b,p,N)}const D=v.match(/(\d{4})-(\d{2})-(\d{2})/);return D?new Date(parseInt(D[1]),parseInt(D[2])-1,parseInt(D[3])):null}catch{return null}},y=new Map;m.forEach(v=>{try{const j=P(v.expiry);if(!j)return;if(j>=h&&j<=f){const D=v.strike;y.has(D)||y.set(D,{volume:0,callVolume:0,putVolume:0,premium:0});const p=y.get(D);p.volume+=v.volume,p.premium+=ve(v.premium),v.optionType==="Call"?p.callVolume+=v.volume:p.putVolume+=v.volume}}catch{}});const k=Array.from(y.entries()).sort((v,j)=>j[1].volume-v[1].volume).slice(0,3);return k.length>0?e.jsx("div",{className:"ticker-analytics",children:e.jsxs("div",{className:"analytics-badge key-levels-badge",children:[e.jsx(Ee,{size:12}),e.jsx("span",{className:"badge-label",children:"Top Strikes (Expiring This Week):"}),e.jsx("span",{className:"badge-strikes",children:k.map(([v,j],D)=>e.jsxs("span",{className:"level-strike level-high",title:`Strike: ${v}, Vol: ${U(j.volume)}, Premium: ${z(j.premium)}, Calls: ${U(j.callVolume)}, Puts: ${U(j.putVolume)}`,children:[D>0&&"","$",v," (Vol: ",U(j.volume),", Prem: ",z(j.premium),")"]},v))})]})}):null})(),i.lastTrade&&e.jsxs("div",{className:"detail-row last-trade-row",children:[e.jsx("span",{className:"detail-label",children:"Last Trade:"}),e.jsxs("span",{className:"detail-value last-trade",children:[i.lastTrade.optionType," $",i.lastTrade.strike,e.jsx("span",{className:`trade-side ${i.lastTrade.optionType.toLowerCase()}`,children:i.lastTrade.optionType==="Call"?"↗":"↘"}),U(i.lastTrade.volume),e.jsx("span",{className:"trade-timestamp",children:bt(i.lastTrade.timestamp)})]})]})]},i.ticker)})})]})});Re.displayName="TickerList";const fe=g.memo(({data:t,highestVolumeData:s,ticker:r,expiry:c,chartType:n,currentPrice:o,trades:l=[]})=>{const[i,a]=g.useState({visible:!1,x:0,y:0,content:null}),u=g.useCallback((p,N)=>N===0?0:Math.min(p/N*46,46),[]),d=g.useCallback((p,N)=>{const b=l.filter(T=>T.strike===p&&(!N||T.optionType===N)),M=b.reduce((T,F)=>T+F.volume,0),C=b.reduce((T,F)=>{const S=F.premium.replace(/[$,]/g,"");return T+(parseFloat(S)||0)},0),V=C>=1e6?(C/1e6).toFixed(2)+"M":C>=1e3?(C/1e3).toFixed(1)+"K":C.toFixed(0),$=C.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),A=[...new Set(b.map(T=>T.sweepType))].filter(Boolean),E=b.map(T=>T.volume).sort((T,F)=>F-T),H=[...new Set(b.map(T=>T.expiry))].sort(),L=M,O=b.sort((T,F)=>F.volume-T.volume).map(T=>({volume:T.volume,premium:T.premium,timestamp:T.timestamp,expiry:T.expiry}));return{strike:p,type:N,volume:M,trades:b.length,premium:V,premiumFull:$,sweepTypes:A,tradeVolumes:E,expiries:H,size:L,tradeDetails:O}},[l]),m=g.useCallback((p,N,b)=>{const M=p.currentTarget.getBoundingClientRect(),C=d(N,b);a({visible:!0,x:p.clientX,y:M.top-10,content:C})},[d]),x=g.useCallback(()=>{a(p=>({...p,visible:!1}))},[]),h=g.useCallback(p=>{a(N=>({...N,x:p.clientX}))},[]),f=g.useCallback(()=>o||(s==null?void 0:s.strike)||null,[o,s]),w=g.useCallback(p=>{const N=f();return N!==null&&Math.abs(p-N)<.01},[f]),y=g.useCallback(()=>t.sort((p,N)=>p.strike-N.strike),[t])(),k=g.useMemo(()=>{if(!y.length)return{maxVolume:0,minStrike:0,maxStrike:0,maxTotalVolume:0,totalVolumeSum:0};let p=0,N=0,b=1/0,M=-1/0,C=0;for(let V=0;V<y.length;V++){const $=y[V];p=Math.max(p,Math.max($.callVolume,$.putVolume)),N=Math.max(N,$.totalVolume),b=Math.min(b,$.strike),M=Math.max(M,$.strike),C+=$.totalVolume}return{maxVolume:p,minStrike:b===1/0?0:b,maxStrike:M===-1/0?0:M,maxTotalVolume:N,totalVolumeSum:C}},[y]),v=g.useCallback(p=>{if(!y.length||k.maxStrike===k.minStrike)return 50;const N=y.findIndex(C=>C.strike===p);if(N===-1)return 50;const b=y.length,M=100/(b+1);if(n==="callput"){const C=b-1-N;return M*(C+1)}else return M*(N+1)},[y,k,n]),j=g.useCallback(p=>{if(!y.length||k.maxStrike===k.minStrike)return 50;const N=k.minStrike,b=k.maxStrike,M=Math.max(N,Math.min(b,p));let C=N,V=b,$=0,A=y.length-1;for(let S=0;S<y.length-1;S++){const _=y[S].strike,I=y[S+1].strike;if(_<=M&&M<=I){C=_,V=I,$=S,A=S+1;break}}const E=y.length,H=100/(E+1);let L,O;if(n==="callput"){const S=E-1-$,_=E-1-A;L=H*(S+1),O=H*(_+1)}else L=H*($+1),O=H*(A+1);if(V===C)return L;const T=(M-C)/(V-C);return L+(O-L)*T},[y,k,n]),D=g.useCallback(()=>Math.max(400,y.length*18+40),[y.length]);return t.length?n==="callput"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"volume-profile-chart modern-mirrored-chart",children:[e.jsxs("div",{className:"chart-header modern-header",children:[e.jsxs("h3",{children:[r," Call/Put Volume"]}),e.jsxs("div",{className:"header-info",children:[f()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",f()]})]}),c&&e.jsx("span",{className:"expiry-date",children:c})]})]}),e.jsx("div",{className:"chart-container modern-container",children:e.jsxs("div",{className:"chart-area modern-chart-area",style:{height:`${D()}px`},children:[e.jsx("div",{className:"center-line"}),e.jsx("div",{className:"strike-axis modern-strike-axis",children:y.map(p=>e.jsx("div",{className:"strike-line modern-strike-line",style:{top:`${v(p.strike)}%`},children:e.jsx("span",{className:`strike-label modern-strike-label ${w(p.strike)?"current-price-label":""}`,children:p.strike})},p.strike))}),e.jsx("div",{className:"volume-bars modern-volume-bars",children:y.map(p=>e.jsxs("div",{className:"strike-row modern-strike-row",style:{top:`${v(p.strike)}%`},children:[e.jsx("div",{className:"volume-bar call-bar modern-call-bar",style:{width:`${u(p.callVolume,k.maxVolume)}%`,right:"52%"},onMouseEnter:N=>m(N,p.strike,"Call"),onMouseLeave:x,onMouseMove:h,children:p.callVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:U(p.callVolume)})}),e.jsx("div",{className:"volume-bar put-bar modern-put-bar",style:{width:`${u(p.putVolume,k.maxVolume)}%`,left:"52%"},onMouseEnter:N=>m(N,p.strike,"Put"),onMouseLeave:x,onMouseMove:h,children:p.putVolume>0&&e.jsx("span",{className:"volume-text modern-volume-text",children:U(p.putVolume)})})]},p.strike))}),f()&&e.jsx("div",{className:"current-price-line",style:{top:`${j(f())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"105%",top:"50%",transform:"translateY(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",f().toFixed(2)]})})]})})]}),i.visible&&i.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${i.x+15}px`,top:`${i.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>a(p=>({...p,visible:!0})),onMouseLeave:x,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",i.content.strike]}),i.content.type&&e.jsx("span",{className:`tooltip-type ${i.content.type.toLowerCase()}`,children:i.content.type})]}),e.jsx("div",{className:"tooltip-body",children:i.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:i.content.tradeDetails.map((p,N)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:p.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:p.premium})]}),p.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(p.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!p.timestamp)return"N/A";const b=new Date(p.timestamp);return isNaN(b.getTime())?p.timestamp:`${b.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${b.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return p.timestamp||"N/A"}})()})]})]},N))})]})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"volume-profile-chart total-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[r," Total Volume"]}),e.jsxs("div",{className:"header-info",children:[f()&&e.jsxs("span",{className:"current-price-display",children:["Current Price: ",e.jsxs("strong",{children:["$",f()]})]}),c&&e.jsx("span",{className:"expiry-date",children:c})]})]}),e.jsxs("div",{className:"chart-container vertical",children:[e.jsxs("div",{className:"chart-area vertical",style:{height:`${D()}px`},children:[e.jsx("div",{className:"volume-bars vertical",children:y.map(p=>e.jsx("div",{className:"strike-column",style:{left:`${v(p.strike)}%`},children:e.jsx("div",{className:"volume-bar total-bar vertical",style:{height:`${u(p.totalVolume,k.maxTotalVolume)}%`},onMouseEnter:N=>m(N,p.strike),onMouseLeave:x,onMouseMove:h,children:p.totalVolume>0&&e.jsxs("span",{className:"volume-text volume-text-top",children:[U(p.totalVolume),e.jsxs("span",{className:"volume-percentage",children:["(",k.totalVolumeSum>0?(p.totalVolume/k.totalVolumeSum*100).toFixed(1):"0.0","%)"]})]})})},p.strike))}),f()&&e.jsx("div",{className:"current-price-line vertical",style:{left:`${j(f())}%`},children:e.jsxs("span",{className:"current-price-label-inline",style:{position:"absolute",left:"50%",top:"-30px",transform:"translateX(-50%)",background:"linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95))",color:"#000000",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"700",whiteSpace:"nowrap",border:"2px solid rgba(255, 193, 7, 1)",boxShadow:"0 2px 8px rgba(255, 193, 7, 0.4)",zIndex:15},children:["$",f().toFixed(2)]})})]}),e.jsx("div",{className:"x-axis-labels",children:y.map(p=>e.jsx("div",{className:"x-axis-label",style:{left:`${v(p.strike)}%`},children:e.jsx("span",{className:`strike-label ${w(p.strike)?"current-price-label":""}`,children:p.strike})},p.strike))})]}),i.visible&&i.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${i.x+15}px`,top:`${i.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>a(p=>({...p,visible:!0})),onMouseLeave:x,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsxs("span",{className:"tooltip-strike",children:["$",i.content.strike]}),i.content.type&&e.jsx("span",{className:`tooltip-type ${i.content.type.toLowerCase()}`,children:i.content.type})]}),e.jsx("div",{className:"tooltip-body",children:i.content.tradeDetails.length>0&&e.jsxs("div",{className:"tooltip-trade-details-only",children:[e.jsx("div",{className:"tooltip-trade-header",children:"Trade Details:"}),e.jsx("div",{className:"tooltip-trade-list",children:i.content.tradeDetails.map((p,N)=>e.jsxs("div",{className:"tooltip-trade-item",children:[e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Vol:"}),e.jsx("span",{className:"trade-item-value",children:p.volume.toLocaleString()})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Premium:"}),e.jsx("span",{className:"trade-item-value",children:p.premium})]}),p.expiry&&e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Expiry:"}),e.jsx("span",{className:"trade-item-value",children:new Date(p.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"trade-item-row",children:[e.jsx("span",{className:"trade-item-label",children:"Time:"}),e.jsx("span",{className:"trade-item-value trade-item-time",children:(()=>{try{if(!p.timestamp)return"N/A";const b=new Date(p.timestamp);return isNaN(b.getTime())?p.timestamp:`${b.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} ${b.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`}catch{return p.timestamp||"N/A"}})()})]})]},N))})]})})]})]})}):e.jsxs("div",{className:"volume-profile-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h3",{children:[r," ",n==="callput"?"Call/Put Volume":"Total Volume"]}),c&&e.jsx("span",{className:"expiry-date",children:c})]}),e.jsx("div",{className:"no-data",children:e.jsxs("p",{children:["No volume data available for this ticker",c?" and expiry date":""]})})]})});fe.displayName="VolumeProfileChart";const Oe=g.memo(({trade:t})=>{const s=o=>{try{const l=o.match(/(\w+),\s+(\w+)\s+(\d+),\s+(\d+)\s+at\s+(\d+):(\d+)\s+(AM|PM)/i);if(l){const[,,a,u,,d,m,x]=l;let h=parseInt(d);x.toUpperCase()==="PM"&&h!==12?h+=12:x.toUpperCase()==="AM"&&h===12&&(h=0);const P=`${{january:"01",february:"02",march:"03",april:"04",may:"05",june:"06",july:"07",august:"08",september:"09",october:"10",november:"11",december:"12"}[a.toLowerCase()]||"01"}/${u.padStart(2,"0")}`,y=`${h.toString().padStart(2,"0")}:${m}`;return`${P} ${y}`}const i=new Date(o);return isNaN(i.getTime())?"Unknown":i.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit"})+" "+i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return"Unknown"}},n=(o=>{const l=o.replace(/[$,]/g,""),i=parseFloat(l);return o.includes("M")?i*1e6:o.includes("K")?i*1e3:i})(t.premium)>=1e6;return e.jsxs("div",{className:"trade-row-horizontal",style:{backgroundColor:t.optionType==="Call"?n?"rgba(0, 80, 0, 0.7)":"rgba(0, 100, 0, 0.5)":n?"rgba(100, 0, 0, 0.7)":"rgba(139, 0, 0, 0.5)"},children:[e.jsx("div",{className:"trade-cell-h symbol",children:t.ticker}),e.jsx("div",{className:"trade-cell-h strike",children:t.strike}),e.jsx("div",{className:"trade-cell-h expiry",children:new Date(t.expiry).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})}),e.jsx("div",{className:"trade-cell-h type",children:t.optionType}),e.jsx("div",{className:"trade-cell-h side",children:t.sweepType}),e.jsx("div",{className:"trade-cell-h size",children:U(t.volume)}),e.jsx("div",{className:"trade-cell-h premium",children:t.premium}),e.jsx("div",{className:"trade-cell-h volume",children:U(t.volume)}),e.jsx("div",{className:"trade-cell-h oi",children:U(t.openInterest)}),e.jsx("div",{className:"trade-cell-h exec-time",children:s(t.timestamp)})]})});Oe.displayName="TradeRow";const He=g.memo(({trades:t,ticker:s,expiry:r})=>{const[c,n]=g.useState("trade-date"),o=g.useMemo(()=>[...t].sort((a,u)=>{switch(c){case"trade-date":{const d=q(a.timestamp),m=q(u.timestamp);return!d||!m?0:m.getTime()-d.getTime()}case"expiry-date":{const d=new Date(a.expiry),m=new Date(u.expiry);return d.getTime()-m.getTime()}case"size":return u.volume-a.volume;default:return 0}}),[t,c]),l=g.useMemo(()=>r?o.filter(a=>a.expiry===r):o,[o,r]);if(l.length===0)return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("h3",{children:[s," Trade History"]}),r&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(r).toLocaleDateString()]})]}),e.jsx("div",{className:"no-trades",children:e.jsxs("p",{children:["No trades found for ",s,r?` on ${new Date(r).toLocaleDateString()}`:""]})})]});const i=g.useCallback((a,u)=>`${a.ticker}-${a.strike}-${a.expiry}-${a.timestamp}-${u}`,[]);return e.jsxs("div",{className:"trade-list",children:[e.jsxs("div",{className:"trade-list-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsxs("h3",{children:[s," Trade History"]}),r&&e.jsxs("span",{className:"expiry-filter",children:["Filtered by: ",new Date(r).toLocaleDateString()]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"sort-controls",children:[e.jsx(ge,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:a=>n(a.target.value),children:[e.jsx("option",{value:"trade-date",children:"Sort by Trade Date (Recent First)"}),e.jsx("option",{value:"expiry-date",children:"Sort by Expiry Date (Earliest First)"}),e.jsx("option",{value:"size",children:"Sort by Size (Largest First)"})]})]}),e.jsxs("div",{className:"trade-count",children:[l.length," trades"]})]})]}),e.jsx("div",{className:"trade-list-content",children:e.jsxs("div",{className:"trade-list-table",children:[e.jsxs("div",{className:"trade-table-header",children:[e.jsx("div",{className:"header-cell",children:"Symbol"}),e.jsx("div",{className:"header-cell",children:"Strike"}),e.jsx("div",{className:"header-cell",children:"Expiration"}),e.jsx("div",{className:"header-cell",children:"Call/Put"}),e.jsx("div",{className:"header-cell",children:"Side"}),e.jsx("div",{className:"header-cell",children:"Size"}),e.jsx("div",{className:"header-cell",children:"Premium"}),e.jsx("div",{className:"header-cell",children:"Volume"}),e.jsx("div",{className:"header-cell",children:"OI"}),e.jsx("div",{className:"header-cell",children:"Exec Time"})]}),e.jsx("div",{className:"trade-table-body",children:l.map((a,u)=>e.jsx(Oe,{trade:a,index:u},i(a,u)))})]})})]})});He.displayName="TradeList";function Tt(t){const s=t.includes("K"),r=t.includes("M"),c=t.replace(/[$,]/g,""),n=parseFloat(c);return r?n*1e6:s?n*1e3:n}const Dt=({trades:t,currentPrice:s})=>{const{heatmapData:r,strikes:c,expiries:n,maxAbsValue:o}=g.useMemo(()=>{const m=new Map,x=new Set,h=new Set;t.forEach(y=>{const k=`${y.strike}_${y.expiry}`;x.add(y.strike),h.add(y.expiry),m.has(k)||m.set(k,{value:0,volume:0,callVolume:0,putVolume:0,trades:0});const v=m.get(k),j=Tt(y.premium);Math.abs(j)<10&&y.ticker==="TSLA"&&console.log(`Small premium detected: ${y.ticker} ${y.strike} ${y.expiry} ${y.optionType} - Premium: "${y.premium}" -> Parsed: ${j}`),y.optionType==="Call"?(v.value+=j,v.callVolume+=y.volume):(v.value-=j,v.putVolume+=y.volume),v.volume+=y.volume,v.trades+=1});const f=Array.from(x).sort((y,k)=>k-y),w=Array.from(h).sort((y,k)=>{const v=new Date(y),j=new Date(k);return v.getTime()-j.getTime()});let P=0;return m.forEach(y=>{const k=Math.abs(y.value);k>P&&(P=k)}),{heatmapData:m,strikes:f,expiries:w,maxAbsValue:P}},[t]),l=(m,x)=>{if(x===0)return"rgba(255, 255, 255, 0.03)";const f=.2+Math.abs(m)/o*.6;return m>0?`rgba(76, 175, 80, ${f})`:`rgba(244, 67, 54, ${f})`},i=m=>{const x=Math.abs(m);return x>=1e6?`${m>=0?"":"-"}$${(x/1e6).toFixed(1)}M`:x>=1e3?`${m>=0?"":"-"}$${(x/1e3).toFixed(1)}K`:x>=1?`${m>=0?"":"-"}$${x.toFixed(0)}`:`${m>=0?"":"-"}$${x.toFixed(2)}`},a=m=>s?Math.abs(m-s)<2:!1,u=(m,x)=>`${m}_${x}`,d=c.length>0&&n.length>0;return e.jsxs("div",{className:"strike-expiry-heatmap",children:[e.jsxs("div",{className:"heatmap-header",children:[e.jsx("h3",{children:"Strike × Expiry Premium Heatmap"}),e.jsxs("div",{className:"heatmap-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(76, 175, 80, 0.6)"}}),e.jsx("span",{children:"Call Premium"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(244, 67, 54, 0.6)"}}),e.jsx("span",{children:"Put Premium"})]}),s&&e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color",style:{background:"rgba(255, 193, 7, 0.4)",border:"2px solid #ffc107"}}),e.jsxs("span",{children:["Current Price (~$",s.toFixed(2),")"]})]})]})]}),e.jsx("div",{className:"heatmap-scroll-container",children:d?e.jsxs("table",{className:"heatmap-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"heatmap-corner",children:"Strike"}),n.map(m=>e.jsx("th",{className:"heatmap-expiry",children:new Date(m).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"})},m))]})}),e.jsx("tbody",{children:c.map(m=>{const x=a(m);return e.jsxs("tr",{className:x?"current-price-row":"",children:[e.jsxs("td",{className:`heatmap-strike ${x?"at-money":""}`,children:[m.toFixed(1),x&&e.jsx("span",{className:"atm-indicator",children:"▶"})]}),n.map(h=>{const f=r.get(u(m,h)),w=f&&f.volume>0;return e.jsx("td",{className:`heatmap-cell ${w?"has-data":""} ${x?"at-money-cell":""}`,style:{background:w?l(f.value,f.volume):void 0},title:w?`Strike: $${m}
Expiry: ${h}
Net Premium: ${i(f.value)}
Volume: ${f.volume}
Calls: ${f.callVolume}
Puts: ${f.putVolume}
Trades: ${f.trades}`:void 0,children:w&&e.jsx("div",{className:"cell-content",children:e.jsx("span",{className:"cell-value",children:i(f.value)})})},`${m}_${h}`)})]},m)})})]}):e.jsxs("div",{className:"heatmap-no-data",children:[e.jsx("p",{children:"No heatmap data available"}),e.jsx("p",{children:"Select a ticker with options data to view the heatmap"})]})})]})};function Ct(t){const s=t.replace(/[$,K]/g,""),r=parseFloat(s);return t.includes("K")?r*1e3:t.includes("M")?r*1e6:r}function Ue(t){const{callPutRatio:s,premiumCallPutRatio:r,sweepCount:c,unusualSweepCount:n,highlyUnusualSweepCount:o,totalVolume:l,totalTrades:i}=t;let a="neutral";s>1.5&&r>1.3?a="bullish":s<.7&&r<.8?a="bearish":Math.abs(s-1)<.3&&Math.abs(r-1)<.3?a="neutral":a="mixed";let u="low";const d=c+n+o;d>5||o>0||l>5e4?u="high":(d>2||n>0||l>2e4)&&(u="medium");let m="low";i>20||l>3e4?m="high":(i>10||l>15e3)&&(m="medium");let x="low";o>0||d>8?x="high":(n>0||d>3)&&(x="medium");let h="";return a==="bullish"?h=`Strong bullish sentiment with ${s.toFixed(1)}:1 call/put ratio`:a==="bearish"?h=`Strong bearish sentiment with ${(1/s).toFixed(1)}:1 put/call ratio`:a==="mixed"?h="Mixed sentiment with conflicting signals":h="Neutral sentiment with balanced activity",x==="high"?h+=` and high sweep activity (${d} sweeps)`:x==="medium"&&(h+=` and moderate sweep activity (${d} sweeps)`),m==="high"?h+=" - High volume trading":m==="medium"&&(h+=" - Moderate activity"),{sentiment:a,confidence:u,activity:m,sweepIntensity:x,description:h}}function $t(t){return t>=9.5&&t<=16.25}function qe(){const t=[];for(let s=9.5;s<=16.25;s+=.5)t.push(s);return t}function Vt(t,s){const r=new Map;return qe().forEach(n=>{r.set(n,{totalVolume:0,callVolume:0,putVolume:0,totalTrades:0,callTrades:0,putTrades:0,totalPremium:0,callPremium:0,putPremium:0,sweepCount:0,unusualSweepCount:0,highlyUnusualSweepCount:0,trades:[]})}),t.forEach(n=>{const o=q(n.timestamp);if(o&&o.getFullYear()===s.getFullYear()&&o.getMonth()===s.getMonth()&&o.getDate()===s.getDate()){const l=o.getHours()+o.getMinutes()/60;if(!$t(l))return;const i=Math.round(l*2)/2,a=r.get(i);if(!a)return;a.trades.push(n),a.totalVolume+=n.volume,a.totalTrades+=1;const u=Ct(n.premium);if(a.totalPremium+=u,n.optionType==="Call"?(a.callVolume+=n.volume,a.callTrades+=1,a.callPremium+=u):(a.putVolume+=n.volume,a.putTrades+=1,a.putPremium+=u),n.sweepType){const d=n.sweepType.toLowerCase();d.includes("highly unusual")?a.highlyUnusualSweepCount+=1:d.includes("unusual")?a.unusualSweepCount+=1:d.includes("sweep")&&(a.sweepCount+=1)}}}),Array.from(r.entries()).map(([n,o])=>{const l=o.putVolume>0?o.callVolume/o.putVolume:o.callVolume,i=o.putPremium>0?o.callPremium/o.putPremium:o.callPremium,a=o.totalTrades>0?o.totalVolume/o.totalTrades:0,u={hour:n,totalVolume:o.totalVolume,callVolume:o.callVolume,putVolume:o.putVolume,totalTrades:o.totalTrades,callTrades:o.callTrades,putTrades:o.putTrades,totalPremium:o.totalPremium,callPremium:o.callPremium,putPremium:o.putPremium,sweepCount:o.sweepCount,unusualSweepCount:o.unusualSweepCount,highlyUnusualSweepCount:o.highlyUnusualSweepCount,avgTradeSize:a,callPutRatio:l,premiumCallPutRatio:i,trades:o.trades,psychology:{sentiment:"neutral",confidence:"low",activity:"low",sweepIntensity:"low",description:""}};return u.psychology=Ue(u),u}).filter(n=>n!=null).sort((n,o)=>n.hour-o.hour)}function Pt(t,s){const r=Vt(t,s);if(!r||r.length===0)return{date:s.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),dayOfWeek:s.toLocaleDateString("en-US",{weekday:"long"}),hourlyData:[],dailySummary:{totalVolume:0,totalTrades:0,totalPremium:0,callPutRatio:0,peakVolume:0,peakHour:0,peakTrades:0,sweepCount:0,uniqueExpiries:[],psychology:{sentiment:"neutral",confidence:"low",activity:"low",sweepIntensity:"low",description:"No trading data available"}}};const c=r.reduce((d,m)=>(d.totalVolume+=m.totalVolume,d.totalTrades+=m.totalTrades,d.totalPremium+=m.totalPremium,d.sweepCount+=m.sweepCount+m.unusualSweepCount+m.highlyUnusualSweepCount,m.totalVolume>d.peakVolume&&(d.peakVolume=m.totalVolume,d.peakHour=m.hour),m.totalTrades>d.peakTrades&&(d.peakTrades=m.totalTrades),d),{totalVolume:0,totalTrades:0,totalPremium:0,callPutRatio:0,sweepCount:0,uniqueExpiries:[],psychology:{sentiment:"neutral",confidence:"low",activity:"low",sweepIntensity:"low",description:""},peakHour:0,peakVolume:0,peakTrades:0}),n=r.reduce((d,m)=>d+m.callVolume,0),o=r.reduce((d,m)=>d+m.putVolume,0);c.callPutRatio=o>0?n/o:n;const l=new Set;t.forEach(d=>{const m=q(d.timestamp);m&&m.toISOString().split("T")[0]===s.toISOString().split("T")[0]&&l.add(d.expiry)}),c.uniqueExpiries=Array.from(l).sort((d,m)=>new Date(d).getTime()-new Date(m).getTime());const i={hour:0,totalVolume:c.totalVolume,callVolume:n,putVolume:o,totalTrades:c.totalTrades,callTrades:r.reduce((d,m)=>d+m.callTrades,0),putTrades:r.reduce((d,m)=>d+m.putTrades,0),totalPremium:c.totalPremium,callPremium:r.reduce((d,m)=>d+m.callPremium,0),putPremium:r.reduce((d,m)=>d+m.putPremium,0),sweepCount:r.reduce((d,m)=>d+m.sweepCount,0),unusualSweepCount:r.reduce((d,m)=>d+m.unusualSweepCount,0),highlyUnusualSweepCount:r.reduce((d,m)=>d+m.highlyUnusualSweepCount,0),avgTradeSize:c.totalTrades>0?c.totalVolume/c.totalTrades:0,callPutRatio:c.callPutRatio,premiumCallPutRatio:0,trades:t.filter(d=>{const m=q(d.timestamp);return m&&m.toISOString().split("T")[0]===s.toISOString().split("T")[0]}),psychology:{sentiment:"neutral",confidence:"low",activity:"low",sweepIntensity:"low",description:""}};c.psychology=Ue(i);const a=s.toISOString().split("T")[0],u=s.toLocaleDateString("en-US",{weekday:"long"});return{date:a,dayOfWeek:u,hourlyData:r,dailySummary:c}}function De(t){const s=new Date(t);return s.setDate(t.getDate()-1),s.getDay()===0?s.setDate(s.getDate()-2):s.getDay()===6&&s.setDate(s.getDate()-1),s}function Mt(t){const s=t.getDay();return s>=1&&s<=5}function At(t){let s=new Date(0);return t.forEach(r=>{const c=q(r.timestamp);c&&c>s&&(s=c)}),s}function Et(t){const s=[],r=At(t);let c=new Date(r);Mt(c)||(c=De(c));for(let l=0;l<5;l++){const i=new Date(c);i.setHours(0,0,0,0);const a=Pt(t,i);s.push(a),c=De(c)}s.reverse();const n=Ft(s),o=_t(s);return{days:s,overallTrend:n,hourlyPatterns:o}}function Ft(t){if(t.length===0)return{sentiment:"neutral",confidence:"low",activity:"stable",description:"No data available"};const s=t.map(x=>x.dailySummary.psychology.sentiment),r=t.map(x=>x.dailySummary.totalVolume),c=t.map(x=>x.dailySummary.psychology.confidence),n=s.reduce((x,h)=>(x[h]=(x[h]||0)+1,x),{}),o=Object.entries(n).sort(([,x],[,h])=>h-x)[0][0],l=c.filter(x=>x==="high").length,i=l>=2?"high":l>=1?"medium":"low",a=r[r.length-1]-r[0],u=r.reduce((x,h)=>x+h,0)/r.length,d=a>u*.2?"increasing":a<-u*.2?"decreasing":"stable";let m=`Overall ${o} sentiment over 5 trading days`;return i==="high"?m+=" with high confidence":i==="medium"&&(m+=" with moderate confidence"),d==="increasing"?m+=" and increasing activity":d==="decreasing"?m+=" and decreasing activity":m+=" with stable activity",{sentiment:o,confidence:i,activity:d,description:m}}function _t(t){const s={},r=qe();return r.forEach(c=>{s[c]={avgVolume:0,avgTrades:0,sentiment:"neutral",consistency:0}}),r.forEach(c=>{const n=t.map(x=>x.hourlyData.find(h=>h.hour===c)).filter(x=>x!==void 0);if(n.length===0)return;const o=n.reduce((x,h)=>x+h.totalVolume,0)/n.length,l=n.reduce((x,h)=>x+h.totalTrades,0)/n.length,a=n.map(x=>x.psychology.sentiment).reduce((x,h)=>(x[h]=(x[h]||0)+1,x),{}),u=Object.entries(a).sort(([,x],[,h])=>h-x)[0][0],m=Math.max(...Object.values(a))/n.length;s[c]={avgVolume:o,avgTrades:l,sentiment:u,consistency:m}}),s}function Lt(t){const s=t.getDay(),r=t.getDate()-s+(s===0?-6:1);return new Date(t.setDate(r))}function It(t){const s=new Date(t);return s.setDate(t.getDate()+4),s}function me(t){return t.toISOString().split("T")[0]}function Rt(t){const{callPutRatio:s,premiumCallPutRatio:r,sweepCount:c,unusualSweepCount:n,highlyUnusualSweepCount:o,totalVolume:l,totalTrades:i}=t;let a="neutral";s>1.5&&r>1.3?a="bullish":s<.7&&r<.8?a="bearish":Math.abs(s-1)<.3&&Math.abs(r-1)<.3?a="neutral":a="mixed";let u="low";l>1e5||i>1e3?u="high":(l>1e4||i>100)&&(u="medium");let d="low";const m=c+n+o;m>50||o>10?d="high":(m>10||n>5)&&(d="medium");let x="low";const h=5e4,f=500;l>h&&i>f&&m>20?x="high":l>h/2&&i>f/2&&m>5&&(x="medium");let w="";return a==="bullish"?w=`Strong bullish sentiment with ${s.toFixed(1)}:1 call/put ratio and high call premium dominance`:a==="bearish"?w=`Bearish sentiment with ${s.toFixed(1)}:1 call/put ratio indicating put buying pressure`:a==="neutral"?w="Balanced sentiment with neutral call/put ratios around 1:1":w="Mixed sentiment with varying call/put ratios indicating uncertainty",d==="high"?w+=` and high sweep activity (${m} sweeps)`:d==="medium"&&(w+=" with moderate sweep activity"),{sentiment:a,confidence:x,activity:u,sweepIntensity:d,description:w}}function Be(t){const s=new Map;t.forEach(c=>{s.has(c.ticker)||s.set(c.ticker,[]),s.get(c.ticker).push(c)});const r=[];return s.forEach((c,n)=>{const o=new Map;c.forEach(h=>{const f=q(h.timestamp);if(f){const w=Lt(new Date(f)),P=me(w);o.has(P)||o.set(P,[]),o.get(P).push(h)}});const l=[];o.forEach((h,f)=>{const w=new Date(f),P=It(new Date(w)),y=h.reduce((S,_)=>S+_.volume,0),k=h.filter(S=>S.optionType==="Call"),v=h.filter(S=>S.optionType==="Put"),j=k.reduce((S,_)=>S+_.volume,0),D=v.reduce((S,_)=>S+_.volume,0),p=h.length,N=k.length,b=v.length,M=h.reduce((S,_)=>{const I=parseFloat(_.premium.replace(/[$,]/g,""));return S+(isNaN(I)?0:I)},0),C=k.reduce((S,_)=>{const I=parseFloat(_.premium.replace(/[$,]/g,""));return S+(isNaN(I)?0:I)},0),V=v.reduce((S,_)=>{const I=parseFloat(_.premium.replace(/[$,]/g,""));return S+(isNaN(I)?0:I)},0),$=D>0?j/D:j,A=V>0?C/V:C,E=h.filter(S=>S.sweepType&&S.sweepType.toLowerCase().includes("sweep")).length,H=h.filter(S=>S.sweepType&&S.sweepType.toLowerCase().includes("unusual")).length,L=h.filter(S=>S.sweepType&&S.sweepType.toLowerCase().includes("highly unusual")).length,O=p>0?y/p:0,T=[...new Set(h.map(S=>S.expiry))],F=Rt({callPutRatio:$,premiumCallPutRatio:A,totalVolume:y,totalTrades:p,sweepCount:E,unusualSweepCount:H,highlyUnusualSweepCount:L,avgTradeSize:O});l.push({weekStart:me(w),weekEnd:me(P),ticker:n,totalVolume:y,callVolume:j,putVolume:D,totalTrades:p,callTrades:N,putTrades:b,totalPremium:M,callPremium:C,putPremium:V,callPutRatio:$,premiumCallPutRatio:A,sweepCount:E,unusualSweepCount:H,highlyUnusualSweepCount:L,avgTradeSize:O,uniqueExpiries:T,psychology:F})}),l.sort((h,f)=>{const w=new Date(h.weekStart);return new Date(f.weekStart).getTime()-w.getTime()});const i=l.map(h=>h.psychology.sentiment),a=i.reduce((h,f)=>(h[f]=(h[f]||0)+1,h),{}),u=Object.entries(a).sort(([,h],[,f])=>f-h)[0][0];let d="stable";if(l.length>=2){const h=l[0].psychology.sentiment,f=l[1].psychology.sentiment;h==="bullish"&&f!=="bullish"||h==="bearish"&&f!=="bearish"?d="improving":(h==="bearish"&&f==="bullish"||h==="neutral"&&f==="bullish")&&(d="declining")}const m=Math.max(...Object.values(a)),x=m/i.length>.7?"high":m/i.length>.5?"medium":"low";r.push({ticker:n,weeks:l,overallSentiment:u,trendDirection:d,confidence:x})}),r.sort((c,n)=>{const o=c.weeks.reduce((i,a)=>i+a.totalVolume,0);return n.weeks.reduce((i,a)=>i+a.totalVolume,0)-o}),r}const Ot=({ticker:t,trades:s})=>{const[r,c]=g.useState(0),[n,o]=g.useState({visible:!1,x:0,y:0,content:null}),l=g.useMemo(()=>!s||s.length===0?null:Et(s),[s]),i=(d,m)=>{const x=d.currentTarget.getBoundingClientRect();o({visible:!0,x:x.left+x.width/2,y:x.top,content:m})},a=()=>{o(d=>({...d,visible:!1}))};if(!l||l.days.length===0)return e.jsxs("div",{className:"ticker-psychology-analysis",children:[e.jsxs("div",{className:"psychology-header",children:[e.jsxs("h3",{children:[t," Trade Psychology"]}),e.jsx("p",{children:"5-Day Trading Psychology Analysis"})]}),e.jsx("div",{className:"no-data",children:e.jsxs("p",{children:["No trade data available for ",t," psychology analysis"]})})]});const u=l.days[r];return e.jsxs("div",{className:"ticker-psychology-analysis",children:[e.jsxs("div",{className:"psychology-header",children:[e.jsxs("h3",{children:[t," Trade Psychology"]}),e.jsx("p",{children:"5-Day Trading Psychology Analysis"}),e.jsxs("div",{className:"overall-trend",children:[e.jsxs("div",{className:`trend-indicator ${l.overallTrend.sentiment}`,children:[e.jsx("span",{className:"trend-sentiment",children:l.overallTrend.sentiment.toUpperCase()}),e.jsxs("span",{className:"trend-confidence",children:[l.overallTrend.confidence," confidence"]})]}),e.jsx("p",{className:"trend-description",children:l.overallTrend.description})]})]}),e.jsx("div",{className:"four-day-layout",children:l.days.map((d,m)=>e.jsx(Ht,{day:d,isSelected:m===r,onClick:()=>c(m),index:m},d.date))}),e.jsxs("div",{className:"hourly-chart",children:[e.jsxs("h4",{children:["Hourly Breakdown: ",u.dayOfWeek,", ",u.date]}),e.jsx("div",{className:"chart-container",children:e.jsx("div",{className:"chart-grid",children:u.hourlyData.map(d=>e.jsx(Ut,{hourData:d,maxVolume:Math.max(...u.hourlyData.map(m=>m.totalVolume)),onMouseEnter:m=>i(m,d),onMouseLeave:a},d.hour))})})]}),n.visible&&n.content&&e.jsxs("div",{className:"modern-tooltip",style:{position:"fixed",left:`${n.x+15}px`,top:`${n.y}px`,transform:"translateY(-50%)",pointerEvents:"auto",zIndex:9999},onMouseEnter:()=>o(d=>({...d,visible:!0})),onMouseLeave:a,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsx("span",{className:"tooltip-strike",children:je(n.content.hour)}),e.jsx("span",{className:`tooltip-type ${n.content.psychology.sentiment}`,children:n.content.psychology.sentiment.toUpperCase()})]}),e.jsxs("div",{className:"tooltip-body",children:[e.jsxs("div",{className:"tooltip-section",children:[e.jsx("div",{className:"tooltip-section-title",children:"Summary"}),e.jsxs("div",{className:"tooltip-row",children:[e.jsx("span",{className:"tooltip-label",children:"Total Volume"}),e.jsx("span",{className:"tooltip-value",children:B(n.content.totalVolume)})]}),e.jsxs("div",{className:"tooltip-row",children:[e.jsx("span",{className:"tooltip-label",children:"Total Trades"}),e.jsx("span",{className:"tooltip-value",children:n.content.totalTrades})]}),e.jsxs("div",{className:"tooltip-row",children:[e.jsx("span",{className:"tooltip-label",children:"Call/Put Ratio"}),e.jsxs("span",{className:"tooltip-value",children:[n.content.callPutRatio.toFixed(2),":1"]})]}),e.jsxs("div",{className:"tooltip-row",children:[e.jsx("span",{className:"tooltip-label",children:"Total Premium"}),e.jsx("span",{className:"tooltip-value",children:z(n.content.totalPremium)})]})]}),n.content.trades&&n.content.trades.length>0&&e.jsxs("div",{className:"tooltip-section",children:[e.jsx("div",{className:"tooltip-section-title",children:"Individual Trades"}),e.jsxs("div",{className:"trades-list",children:[n.content.trades.slice(0,5).map((d,m)=>e.jsxs("div",{className:`trade-item ${d.optionType.toLowerCase()}-trade`,children:[e.jsxs("div",{className:"trade-header",children:[e.jsx("span",{className:`trade-type ${d.optionType.toLowerCase()}`,children:d.optionType}),e.jsxs("span",{className:"trade-strike",children:["$",d.strike]}),e.jsx("span",{className:"trade-expiry",children:new Date(d.expiry).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"trade-details",children:[e.jsxs("span",{className:"trade-volume",children:["Vol: ",d.volume]}),e.jsxs("span",{className:"trade-premium",children:["Premium: ",z(ve(d.premium))]}),d.sweepType&&e.jsx("span",{className:"trade-sweep",children:d.sweepType})]}),e.jsx("div",{className:"trade-time",children:new Date(q(d.timestamp)||d.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]},m)),n.content.trades.length>5&&e.jsxs("div",{className:"more-trades",children:["+",n.content.trades.length-5," more trades"]})]})]})]})]})]})},Ht=({day:t,isSelected:s,onClick:r})=>e.jsxs("div",{className:`day-column ${s?"selected":""}`,onClick:r,children:[e.jsxs("div",{className:"day-header",children:[e.jsx("h4",{children:t.dayOfWeek}),e.jsx("p",{className:"day-date-short",children:t.date})]}),e.jsxs("div",{className:"day-metrics",children:[e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Volume"}),e.jsx("span",{className:"metric-value",children:B(t.dailySummary.totalVolume)})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Trades"}),e.jsx("span",{className:"metric-value",children:t.dailySummary.totalTrades})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"C/P Ratio"}),e.jsx("span",{className:"metric-value",children:t.dailySummary.callPutRatio.toFixed(1)})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Sweeps"}),e.jsx("span",{className:"metric-value",children:t.dailySummary.sweepCount})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Premium"}),e.jsx("span",{className:"metric-value",children:z(t.dailySummary.totalPremium)})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Expiries"}),e.jsx("span",{className:"metric-value",children:t.dailySummary.uniqueExpiries.length})]})]}),e.jsxs("div",{className:`psychology-indicator ${t.dailySummary.psychology.sentiment}`,children:[e.jsx("span",{className:"psychology-sentiment",children:t.dailySummary.psychology.sentiment.toUpperCase()}),e.jsx("span",{className:"psychology-confidence",children:t.dailySummary.psychology.confidence})]}),e.jsx("div",{className:"mini-chart",children:t.hourlyData.map(c=>e.jsx("div",{className:`mini-hour-bar ${c.psychology.sentiment}`,style:{height:`${Math.max(2,c.totalVolume/Math.max(...t.hourlyData.map(n=>n.totalVolume))*100)}%`},title:`${je(c.hour)}: ${B(c.totalVolume)} volume, ${c.psychology.sentiment} sentiment`},c.hour))})]}),Ut=({hourData:t,maxVolume:s,onMouseEnter:r,onMouseLeave:c})=>{const n=s>0?t.totalVolume/s*100:0,o=t.totalVolume>0;return e.jsxs("div",{className:"hour-bar-container",children:[e.jsx("div",{className:"hour-label",children:je(t.hour)}),e.jsx("div",{className:"hour-bar-wrapper",children:e.jsx("div",{className:`hour-bar ${o?`${t.psychology.sentiment} ${t.psychology.activity}`:"no-trades"}`,style:o?{height:`${Math.max(5,n)}%`}:{},onMouseEnter:o?r:void 0,onMouseLeave:o?c:void 0,children:e.jsxs("div",{className:"bar-content",children:[e.jsxs("div",{className:"volume-info",children:[e.jsx("span",{className:"volume",children:B(t.totalVolume)}),e.jsx("span",{className:"trades",children:t.totalTrades})]}),e.jsxs("div",{className:"call-put-info",children:[e.jsxs("span",{className:"call-volume",children:["C: ",B(t.callVolume)]}),e.jsxs("span",{className:"put-volume",children:["P: ",B(t.putVolume)]})]})]})})}),e.jsxs("div",{className:"hour-details",children:[e.jsxs("div",{className:"cp-ratio",children:["C/P: ",t.callPutRatio.toFixed(1)]}),e.jsxs("div",{className:"volume-breakdown",children:["C: ",B(t.callVolume)," | P: ",B(t.putVolume)]})]})]})};function B(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function je(t){const s=t%1===.5,r=Math.floor(t);return r===0?s?"12:30AM":"12AM":r<12?s?`${r}:30AM`:`${r}AM`:r===12?s?"12:30PM":"12PM":s?`${r-12}:30PM`:`${r-12}PM`}function Ne(t){try{const s=t.match(/(?:options_data|option_data|darkpool_data)_(\d{4}-\d{2}-\d{2})_(\d{2}-\d{2})\.csv/);if(!s)return null;const[,r,c]=s,[n,o,l]=r.split("-").map(Number),[i,a]=c.split("-").map(Number);return new Date(n,o-1,l,i,a)}catch{return null}}async function qt(t=!1){try{const r="/optionAnalysis/",c=t?`?t=${Date.now()}&r=${Math.random()}`:"",n=await fetch(`${r}api/data-files.json${c}`,{cache:t?"no-store":"default",headers:t?{"Cache-Control":"no-cache, no-store, must-revalidate, max-age=0",Pragma:"no-cache",Expires:"0"}:{}});if(n.ok){const o=await n.json();if(Array.isArray(o)&&o.length>0)return o.map(l=>({filename:l.name,timestamp:new Date(l.timestamp),size:l.size}))}}catch{}return["options_data_2025-10-21_16-51.csv","options_data_2025-10-21_15-00.csv","options_data_2025-10-20_16-00.csv","options_data_2025-10-17_15-45.csv","options_data_2025-10-15_TSLA.csv","options_data_2025-10-16_16-00.csv","options_data_2025-10-16_15-00.csv","options_data_2025-10-16_12-00.csv","options_data_2025-10-16_10-30.csv","options_data_2025-10-15_16-00.csv","options_data_2025-10-15_14-00.csv","options_data_2025-10-15_11-30.csv","options_data_2025-10-15_10-00.csv","options_data_2025-10-14_16-00.csv","options_data_2025-10-14_15-00.csv","options_data_2025-10-14_11-00.csv","options_data_2025-10-14_01-00.csv","options_data_2025-10-13_13-20.csv","options_data_2025-10-13_13-00.csv","options_data_2025-10-13_10-50.csv","options_data_2025-10-13_10-00.csv","options_data_2025-10-13_05-30.csv","options_data_2024-01-15_16-00.csv","options_data_2024-01-15_11-30.csv","options_data_2024-01-15_11-00.csv","options_data_2024-01-15_10-00.csv","options_data_2024-01-15_02-30.csv"].map(r=>({filename:r,timestamp:Ne(r)||new Date,size:0})).sort((r,c)=>c.timestamp.getTime()-r.timestamp.getTime())}async function Bt(){return["darkpool_data_2025-10-17_15-00.csv"].map(s=>({filename:s,timestamp:Ne(s)||new Date,size:0})).sort((s,r)=>r.timestamp.getTime()-s.timestamp.getTime())}async function le(t,s=!1){try{const r=s?`?t=${Date.now()}&r=${Math.random()}`:"",n=await fetch(`/optionAnalysis/data/${t}${r}`,{cache:s?"no-store":"default",headers:s?{"Cache-Control":"no-cache, no-store, must-revalidate, max-age=0",Pragma:"no-cache",Expires:"0"}:{}});if(!n.ok)throw new Error(`Failed to load ${t}: ${n.status} ${n.statusText}`);const o=await n.text(),l=Ne(t);return{filename:t,timestamp:l||new Date,data:o}}catch(r){return{filename:t,timestamp:new Date,data:"",error:r instanceof Error?r.message:"Unknown error"}}}const X="optionAnalysis_fileCache",Z="optionAnalysis_darkPoolFileCache",Ke=5*60*1e3;function ze(t){try{const s=sessionStorage.getItem(t);if(s){const r=JSON.parse(s),c=new Map;for(const[n,o]of Object.entries(r))c.set(n,o);return c}}catch{}return new Map}function ie(t,s){try{const r=Object.fromEntries(s);sessionStorage.setItem(t,JSON.stringify(r))}catch{}}function ne(t){try{sessionStorage.removeItem(t)}catch{}}function Kt(){ne(X),ne(Z)}function zt(){ne(X)}function Yt(){ne(Z)}async function oe(t=!1){try{const s=await qt(t),r=Date.now(),c=ze(X);if(t){console.log("🔄 Cache busting enabled - loading all files fresh..."),console.log(`📂 Found ${s.length} data files to load:`,s.map(f=>f.filename).sort().reverse());const d=s.map(f=>le(f.filename,!0)),m=await Promise.all(d);m.forEach(f=>{f.error||c.set(f.filename,{data:f,timestamp:r})}),ie(X,c);const x=m.filter(f=>!f.error),h=m.filter(f=>f.error);return console.log(`✓ Loaded ${x.length} files fresh (cache bypassed)`),h.length>0&&console.warn(`⚠️ Failed to load ${h.length} files:`,h.map(f=>({filename:f.filename,error:f.error}))),console.log("📄 Successfully loaded files:",x.map(f=>f.filename).sort().reverse()),x}const n=[],o=[];s.forEach(d=>{const m=c.get(d.filename);m&&r-m.timestamp<Ke?n.push(m.data):o.push(d.filename)});let l=[];if(o.length>0){const d=o.map(m=>le(m,!1));l=await Promise.all(d),l.forEach(m=>{m.error||c.set(m.filename,{data:m,timestamp:r})}),ie(X,c)}const i=[...n,...l],a=i.filter(d=>!d.error),u=i.filter(d=>d.error);return a}catch(s){return console.error("Failed to load data files:",s),[]}}async function Ce(t=!1){try{const s=await Bt(),r=Date.now(),c=ze(Z);if(t){const d=s.map(h=>le(h.filename,!0)),m=await Promise.all(d);return m.forEach(h=>{h.error||c.set(h.filename,{data:h,timestamp:r})}),ie(Z,c),m.filter(h=>!h.error)}const n=[],o=[];s.forEach(d=>{const m=c.get(d.filename);m&&r-m.timestamp<Ke?n.push(m.data):o.push(d.filename)});let l=[];if(o.length>0){const d=o.map(m=>le(m,!1));l=await Promise.all(d),l.forEach(m=>{m.error||c.set(m.filename,{data:m,timestamp:r})}),ie(Z,c)}const i=[...n,...l],a=i.filter(d=>!d.error),u=i.filter(d=>d.error);return a}catch(s){return console.error("Failed to load dark pool data files:",s),[]}}async function Wt(t){var r,c,n,o;const s="d3mgi7hr01qmso33ob30d3mgi7hr01qmso33ob3g";try{const l=`https://finnhub.io/api/v1/quote?symbol=${t}&token=${s}`,i=await fetch(l);if(i.ok){const a=await i.json(),u=a==null?void 0:a.c;if(u&&typeof u=="number"&&u>0)return u}}catch{}try{let l=`https://query1.finance.yahoo.com/v8/finance/chart/${t}?interval=1d&range=1d`,i=await fetch(l,{mode:"cors",headers:{Accept:"application/json"}});if(!i.ok||i.status===0){const d=`https://api.allorigins.win/raw?url=${encodeURIComponent(l)}`;i=await fetch(d)}if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const a=await i.json(),u=(o=(n=(c=(r=a==null?void 0:a.chart)==null?void 0:r.result)==null?void 0:c[0])==null?void 0:n.meta)==null?void 0:o.regularMarketPrice;return u&&typeof u=="number"?u:null}catch{return null}}const we="optionAnalysis_priceCache",Qt=9e5;function Jt(){try{const t=sessionStorage.getItem(we);if(t){const s=JSON.parse(t),r=new Map;for(const[c,n]of Object.entries(s))r.set(c,n);return r}}catch{}return new Map}function Gt(t){try{const s=Object.fromEntries(t);sessionStorage.setItem(we,JSON.stringify(s))}catch{}}function Xt(){try{sessionStorage.removeItem(we)}catch{}}async function ce(t){const s=Jt(),r=s.get(t),c=Date.now();if(r&&c-r.timestamp<Qt)return{price:r.price,source:"api",cached:!0};const n=await Wt(t);return n!==null?(s.set(t,{price:n,timestamp:c}),Gt(s),{price:n,source:"api",cached:!1}):{price:null,source:"none",cached:!1}}function ke(){Xt()}async function W(){try{Kt(),ft(),ke();const t=[];for(let s=0;s<sessionStorage.length;s++){const r=sessionStorage.key(s);r&&r.startsWith("optionAnalysis_")&&t.push(r)}if(t.forEach(s=>{try{sessionStorage.removeItem(s)}catch{}}),"caches"in window)try{const s=await caches.keys();await Promise.all(s.map(r=>caches.delete(r)))}catch{}}catch{}}function Zt(){const t=()=>{W()},s=()=>{W()},r=()=>{document.visibilityState==="hidden"&&W()};window.addEventListener("beforeunload",t),window.addEventListener("unload",s),document.addEventListener("visibilitychange",r),window.addEventListener("pagehide",t)}const es=({activeDashboard:t,setActiveDashboard:s})=>{var O;const[r,c]=g.useState(null),[n,o]=g.useState(null),[l,i]=g.useState([]),[a,u]=g.useState(null),[d,m]=g.useState(!0),[x,h]=g.useState(null),[f,w]=g.useState(null),[P,y]=g.useState("none"),[k,v]=g.useState(!1),[j,D]=g.useState("");g.useEffect(()=>{(async(F=!1)=>{try{m(!0),h(null);const S=await oe(F);if(S.length===0)throw new Error("No data files found in the data directory");const{mergedData:_,info:I}=re(S.map(Q=>({filename:Q.filename,data:Q.data,timestamp:Q.timestamp})));i(_),u(I),m(!1)}catch(S){console.error("Error loading data files:",S),h(S instanceof Error?S.message:"Failed to load data"),m(!1)}})(!1)},[]);const p=g.useMemo(()=>vt(l),[l]),N=g.useMemo(()=>{if(!j.trim())return p;const T=j.toLowerCase();return p.filter(F=>F.ticker.toLowerCase().includes(T))},[p,j]),b=g.useMemo(()=>r?Nt(l,r):[],[l,r]),M=g.useMemo(()=>r?jt(l,r,n||void 0):[],[l,r,n]),C=g.useMemo(()=>r?l.filter(T=>{const F=T.ticker===r,S=!n||T.expiry===n;return F&&S}):[],[l,r,n]),V=g.useMemo(()=>r?wt(l,r,n||void 0):null,[l,r,n]),$=g.useMemo(()=>r?l.filter(T=>T.ticker===r&&(!n||T.expiry===n)):[],[l,r,n]),A=g.useCallback(T=>{c(T),o(null)},[]),E=g.useCallback(()=>{c(null),o(null)},[]),H=g.useCallback(T=>{o(T===n?null:T)},[n]),L=g.useCallback(async()=>{var T,F;try{if(console.log("🔄 Performing hard refresh for options data..."),await W(),xe(),zt(),ke(),"serviceWorker"in navigator)try{const R=await navigator.serviceWorker.getRegistrations();for(const J of R)await J.unregister(),console.log("✓ Service worker unregistered")}catch(R){console.warn("Could not unregister service worker:",R)}console.log("✓ All caches cleared (session storage, service worker, and application caches)"),console.log("🔄 Reloading options data with cache bypass..."),await new Promise(R=>setTimeout(R,100)),m(!0),h(null);const S=await oe(!0);if(S.length===0)throw new Error("No data files found in the data directory");const{mergedData:_,info:I}=re(S.map(R=>({filename:R.filename,data:R.data,timestamp:R.timestamp})));i(_),u(I);const Q=_.slice(0,10);if(console.log("📊 Sample of latest trades after refresh:",Q.map(R=>({ticker:R.ticker,timestamp:R.timestamp,sourceFile:R.sourceFile}))),console.log("📁 Files loaded:",S.map(R=>R.filename).sort().reverse()),console.log("📈 Data range:",{earliest:(T=I.dateRange.earliest)==null?void 0:T.toISOString(),latest:(F=I.dateRange.latest)==null?void 0:F.toISOString(),totalFiles:I.totalFiles,totalRecords:I.totalRecords}),console.log("📋 File timestamps:",S.map(R=>({filename:R.filename,timestamp:R.timestamp.toISOString()})).sort((R,J)=>new Date(J.timestamp).getTime()-new Date(R.timestamp).getTime())),w(null),y("none"),v(!1),r){const{price:R,source:J,cached:Ge}=await ce(r);w(R),y(J),v(Ge)}m(!1),console.log("✓ Data reloaded successfully:",{files:I.totalFiles,records:I.totalRecords,latestData:I.dateRange.latest})}catch(S){console.error("Error during hard refresh:",S),h(S instanceof Error?S.message:"Failed to refresh data"),m(!1)}},[r]);return g.useEffect(()=>{if(!r){w(null),y("none"),v(!1);return}(async()=>{const F=await ce(r);w(F.price),y(F.source),v(F.cached)})()},[r]),d?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading options data from multiple files..."})]}):x?e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error Loading Data"}),e.jsx("p",{children:x}),e.jsx("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"options-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"Market Analysis Dashboard"}),a&&e.jsxs("div",{className:"header-stats",children:[e.jsxs("span",{className:"header-stat",children:[a.totalFiles," files"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsxs("span",{className:"header-stat",children:[a.totalRecords.toLocaleString()," records"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsx("span",{className:"header-stat",children:a.files&&a.files.length>0?a.files[0].timestamp.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):((O=a.dateRange.latest)==null?void 0:O.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}))||""})]})]}),e.jsxs("div",{className:"header-right",children:[!r&&e.jsxs("div",{className:"search-container-header",children:[e.jsx(Fe,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search tickers...",value:j,onChange:T=>D(T.target.value)}),j&&e.jsx("button",{className:"clear-search",onClick:()=>D(""),title:"Clear search",children:"×"})]}),e.jsxs("div",{className:"nav-buttons",children:[e.jsx("button",{className:`nav-button ${t==="options"?"active":""}`,onClick:()=>s("options"),children:"Options Analysis"}),e.jsx("button",{className:`nav-button ${t==="darkpool"?"active":""}`,onClick:()=>s("darkpool"),children:"Dark Pool Analysis"}),e.jsx("button",{className:`nav-button ${t==="psychology"?"active":""}`,onClick:()=>s("psychology"),children:"Overall Analysis"})]}),e.jsxs("button",{className:"refresh-button-compact",onClick:L,title:"Hard Refresh - Clears all caches and reloads data from files",children:[e.jsx(Y,{className:"refresh-icon"}),"Hard Refresh"]})]})]}),r?e.jsxs("div",{className:"ticker-detail-view",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("button",{className:"back-button",onClick:E,children:[e.jsx(G,{className:"back-icon"}),"Back to Ticker List"]}),e.jsxs("h2",{children:[r," Options Analysis"]}),f&&P==="api"?e.jsxs("span",{className:"current-price-badge",children:[e.jsx("span",{className:"price-indicator"}),"Current Price: $",f.toFixed(2),e.jsxs("span",{className:"price-status",children:["(",k?"Cached":"Live",")"]})]}):e.jsx("span",{className:"price-unavailable",children:"Price unavailable"})]}),e.jsxs("div",{className:"expiry-filter",children:[e.jsxs("div",{className:"filter-header",children:[e.jsx(ye,{className:"filter-icon"}),e.jsx("span",{children:"Filter by Expiry Date:"})]}),e.jsxs("div",{className:"expiry-buttons",children:[e.jsx("button",{className:`expiry-button ${n?"":"active"}`,onClick:()=>o(null),children:"All Expiries"}),b.map(T=>e.jsx("button",{className:`expiry-button ${n===T?"active":""}`,onClick:()=>H(T),children:new Date(T).toLocaleDateString()},T))]})]}),e.jsxs("div",{className:"charts-section",children:[e.jsx("div",{className:"chart-column",children:e.jsx(fe,{data:M,highestVolumeData:V,ticker:r,expiry:n||void 0,chartType:"callput",currentPrice:f||void 0,trades:C})}),e.jsx("div",{className:"chart-column",children:e.jsx(fe,{data:M,highestVolumeData:V,ticker:r,expiry:n||void 0,chartType:"total",currentPrice:f||void 0,trades:C})})]}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Total Volume"}),e.jsx("p",{children:M.reduce((T,F)=>T+F.totalVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Call Volume"}),e.jsx("p",{children:M.reduce((T,F)=>T+F.callVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Put Volume"}),e.jsx("p",{children:M.reduce((T,F)=>T+F.putVolume,0).toLocaleString()})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Open Interest"}),e.jsx("p",{children:M.reduce((T,F)=>T+F.openInterest,0).toLocaleString()})]})]}),e.jsx(Ot,{ticker:r,trades:$}),e.jsxs("div",{className:"heatmap-trades-section",children:[e.jsx("div",{className:"heatmap-column",children:e.jsx(Dt,{trades:$,currentPrice:f||void 0})}),e.jsx("div",{className:"trades-column",children:e.jsxs("div",{className:"trade-list-section",children:[e.jsxs("h3",{children:["Trade History for ",r]}),e.jsxs("p",{children:["Found ",$.length," trades"]}),e.jsx(He,{trades:$,ticker:r,expiry:n||void 0})]})})]})]}):e.jsx(Re,{tickers:N,onTickerSelect:A,allData:l})]})},Ye=g.memo(({trade:t,volumeStats:s,valueStats:r})=>{const c=a=>{try{return new Date(a).toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}catch{return"Unknown"}},n=a=>a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(1)}K`:a.toLocaleString(),l=(a=>{const u=a.replace(/[$,]/g,""),d=parseFloat(u);return a.includes("M")?d*1e6:a.includes("K")?d*1e3:d})(t.totalValue),i=()=>t.quantity>=s.q90||l>=r.q90?"rgba(0, 200, 0, 0.6)":"rgba(255, 255, 255, 0.1)";return e.jsxs("div",{className:"darkpool-row-horizontal",style:{backgroundColor:i(),borderLeft:t.quantity>=s.q90||l>=r.q90?"4px solid #00c800":"none"},children:[e.jsx("div",{className:"darkpool-cell-h symbol",children:t.ticker}),e.jsx("div",{className:"darkpool-cell-h quantity",children:n(t.quantity)}),e.jsxs("div",{className:"darkpool-cell-h price",children:["$",t.price.toFixed(2)]}),e.jsx("div",{className:"darkpool-cell-h total-value",children:t.totalValue}),e.jsx("div",{className:"darkpool-cell-h exec-time",children:c(t.timestamp)})]})});Ye.displayName="DarkPoolRow";const $e=t=>{const s=[...t].sort((a,u)=>a-u),r=t.reduce((a,u)=>a+u,0)/t.length,c=t.reduce((a,u)=>a+Math.pow(u-r,2),0)/t.length,n=Math.sqrt(c),o=Math.floor(s.length*.75),l=Math.floor(s.length*.9),i=Math.floor(s.length*.95);return{mean:r,stdDev:n,q75:s[o]||0,q90:s[l]||0,q95:s[i]||0}},We=g.memo(({trades:t,ticker:s})=>{const[r,c]=g.useState("timestamp"),[n,o]=g.useState("desc"),{volumeStats:l,valueStats:i}=g.useMemo(()=>{if(t.length===0)return{volumeStats:{mean:0,stdDev:0,q75:0,q90:0,q95:0},valueStats:{mean:0,stdDev:0,q75:0,q90:0,q95:0}};const h=t.map(w=>w.quantity),f=t.map(w=>{const P=w.totalValue.replace(/[$,]/g,""),y=parseFloat(P);return w.totalValue.includes("M")?y*1e6:w.totalValue.includes("K")?y*1e3:y});return{volumeStats:$e(h),valueStats:$e(f)}},[t]),a=g.useMemo(()=>[...t].sort((f,w)=>{let P=0;switch(r){case"timestamp":P=new Date(f.timestamp).getTime()-new Date(w.timestamp).getTime();break;case"quantity":P=f.quantity-w.quantity;break;case"price":P=f.price-w.price;break;case"total-value":const y=parseFloat(f.totalValue.replace(/[$,]/g,"")),k=parseFloat(w.totalValue.replace(/[$,]/g,""));P=y-k;break;default:P=0}return n==="asc"?P:-P}),[t,r,n]),u=h=>{r===h?o(n==="asc"?"desc":"asc"):(c(h),o("desc"))},d=h=>r!==h?"↕️":n==="asc"?"↑":"↓",m=t.reduce((h,f)=>{const w=parseFloat(f.totalValue.replace(/[$,]/g,""));return h+w},0),x=h=>h>=1e9?`$${(h/1e9).toFixed(1)}B`:h>=1e6?`$${(h/1e6).toFixed(1)}M`:h>=1e3?`$${(h/1e3).toFixed(1)}K`:`$${h.toFixed(0)}`;return e.jsxs("div",{className:"darkpool-list-container",children:[e.jsxs("div",{className:"darkpool-list-header",children:[e.jsxs("h3",{children:["Dark Pool Trades",s?` for ${s}`:""]}),e.jsxs("div",{className:"darkpool-stats",children:[e.jsxs("span",{className:"stat-item",children:[e.jsx("strong",{children:t.length})," trades"]}),e.jsxs("span",{className:"stat-item",children:[e.jsx("strong",{children:x(m)})," total value"]})]})]}),e.jsxs("div",{className:"darkpool-legend",children:[e.jsx("div",{className:"legend-title",children:"Trade Volume/Value Indicators:"}),e.jsxs("div",{className:"legend-items",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color unusual"}),e.jsx("span",{children:"Unusual (Top 10%)"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color normal"}),e.jsx("span",{children:"Normal"})]})]})]}),e.jsxs("div",{className:"darkpool-list-table",children:[e.jsxs("div",{className:"darkpool-header-row",children:[e.jsxs("div",{className:"darkpool-header-cell symbol",onClick:()=>u("timestamp"),children:["Symbol ",d("timestamp")]}),e.jsxs("div",{className:"darkpool-header-cell quantity",onClick:()=>u("quantity"),children:["Quantity ",d("quantity")]}),e.jsxs("div",{className:"darkpool-header-cell price",onClick:()=>u("price"),children:["Price ",d("price")]}),e.jsxs("div",{className:"darkpool-header-cell total-value",onClick:()=>u("total-value"),children:["Total Value ",d("total-value")]}),e.jsxs("div",{className:"darkpool-header-cell exec-time",onClick:()=>u("timestamp"),children:["Execution Time ",d("timestamp")]})]}),e.jsx("div",{className:"darkpool-trades-container",children:a.map((h,f)=>e.jsx(Ye,{trade:h,volumeStats:l,valueStats:i},`${h.ticker}-${h.timestamp}-${f}`))})]}),t.length===0&&e.jsx("div",{className:"no-trades-message",children:e.jsxs("p",{children:["No dark pool trades found",s?` for ${s}`:"","."]})})]})});We.displayName="DarkPoolList";const Ve=t=>{try{const s=new Date(t);return isNaN(s.getTime())?"":s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" "+s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}},ue=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),he=t=>t>=1e9?`$${(t/1e9).toFixed(1)}B`:t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(2)}`,Qe=g.memo(({tickers:t,onTickerSelect:s,allData:r})=>{const[c,n]=g.useState("recent"),o=g.useMemo(()=>{const l=[...t];switch(c){case"recent":return l.sort((i,a)=>new Date(a.lastActivity).getTime()-new Date(i.lastActivity).getTime());case"oldest":return l.sort((i,a)=>new Date(i.lastActivity).getTime()-new Date(a.lastActivity).getTime());case"value-high":return l.sort((i,a)=>a.totalValue-i.totalValue);case"value-low":return l.sort((i,a)=>i.totalValue-a.totalValue);case"quantity-high":return l.sort((i,a)=>a.totalQuantity-i.totalQuantity);case"quantity-low":return l.sort((i,a)=>i.totalQuantity-a.totalQuantity);case"trades-high":return l.sort((i,a)=>a.tradeCount-i.tradeCount);case"trades-low":return l.sort((i,a)=>i.tradeCount-a.tradeCount);case"volume-high":return l.sort((i,a)=>a.highestVolumeQuantity-i.highestVolumeQuantity);case"volume-low":return l.sort((i,a)=>i.highestVolumeQuantity-a.highestVolumeQuantity);default:return l}},[t,c]);return e.jsxs("div",{className:"ticker-list-container",children:[e.jsxs("div",{className:"ticker-list-header",children:[e.jsx("h2",{children:"Dark Pool Tickers"}),e.jsx("p",{children:"Select a ticker to view detailed dark pool activity"}),e.jsxs("div",{className:"sort-controls",children:[e.jsx(ge,{className:"sort-icon"}),e.jsxs("select",{className:"sort-selector",value:c,onChange:l=>n(l.target.value),children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"value-high",children:"Value (High to Low)"}),e.jsx("option",{value:"value-low",children:"Value (Low to High)"}),e.jsx("option",{value:"quantity-high",children:"Quantity (High to Low)"}),e.jsx("option",{value:"quantity-low",children:"Quantity (Low to High)"}),e.jsx("option",{value:"trades-high",children:"Trades (High to Low)"}),e.jsx("option",{value:"trades-low",children:"Trades (Low to High)"}),e.jsx("option",{value:"volume-high",children:"High Volume (High to Low)"}),e.jsx("option",{value:"volume-low",children:"High Volume (Low to High)"})]})]})]}),e.jsx("div",{className:"ticker-grid",children:o.map(l=>{const i=r.filter(a=>a.ticker===l.ticker).sort((a,u)=>new Date(u.timestamp).getTime()-new Date(a.timestamp).getTime())[0];return e.jsxs("div",{className:"ticker-card darkpool-card",onClick:()=>s(l.ticker),children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h3",{className:"ticker-symbol",children:l.ticker}),e.jsxs("div",{className:"ticker-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx(Me,{className:"metric-icon value"}),e.jsx("span",{className:"metric-label",children:"Total Value"}),e.jsx("span",{className:"metric-value",children:he(l.totalValue)})]}),e.jsxs("div",{className:"metric",children:[e.jsx(Ae,{className:"metric-icon quantity"}),e.jsx("span",{className:"metric-label",children:"Quantity"}),e.jsx("span",{className:"metric-value",children:ue(l.totalQuantity)})]})]})]}),e.jsxs("div",{className:"ticker-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Trades:"}),e.jsx("span",{className:"detail-value",children:l.tradeCount})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Avg Price:"}),e.jsxs("span",{className:"detail-value",children:["$",l.averagePrice.toFixed(2)]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(ye,{className:"detail-icon"}),e.jsx("span",{className:"detail-label",children:"Max Trade:"}),e.jsx("span",{className:"detail-value",children:he(l.maxTradeValue)})]})]}),e.jsxs("div",{className:"ticker-analytics",children:[e.jsxs("div",{className:"analytics-badge key-levels-badge",children:[e.jsx(Ee,{size:12}),e.jsx("span",{className:"badge-label",children:"High Volume:"}),e.jsxs("span",{className:"badge-strikes",children:[ue(l.highestVolumeQuantity)," @ $",l.highestVolumePrice.toFixed(2)]})]}),e.jsxs("div",{className:"analytics-badge max-pain-badge",children:[e.jsx(et,{size:12}),e.jsx("span",{className:"badge-label",children:"Peak Time:"}),e.jsx("span",{className:"badge-strikes",children:Ve(l.highestVolumeTime)})]})]}),i&&e.jsxs("div",{className:"detail-row last-trade-row",children:[e.jsx("span",{className:"detail-label",children:"Last Trade:"}),e.jsxs("span",{className:"detail-value last-trade",children:[he(i.price*i.quantity),e.jsxs("span",{className:"trade-side",children:[ue(i.quantity)," @ $",i.price.toFixed(2)]}),e.jsx("span",{className:"trade-timestamp",children:Ve(i.timestamp)})]})]})]},l.ticker)})}),o.length===0&&e.jsx("div",{className:"no-tickers",children:e.jsx("p",{children:"No dark pool tickers found"})})]})});Qe.displayName="DarkPoolTickerList";const ts=({trades:t})=>{const s=g.useMemo(()=>{if(!t||t.length===0)return[];const l=[...t].sort((a,u)=>a.price-u.price),i=new Map;return l.forEach(a=>{const u=Math.round(a.price*100)/100;if(i.has(u)){const d=i.get(u);d.volume+=a.quantity,d.value+=a.price*a.quantity,new Date(a.timestamp)>new Date(d.timestamp)&&(d.timestamp=a.timestamp)}else i.set(u,{price:u,volume:a.quantity,timestamp:a.timestamp,value:a.price*a.quantity})}),Array.from(i.values()).sort((a,u)=>a.price-u.price)},[t]),r=g.useMemo(()=>Math.max(...s.map(l=>l.volume),1),[s]),c=l=>l>=1e6?`${(l/1e6).toFixed(1)}M`:l>=1e3?`${(l/1e3).toFixed(1)}K`:l.toString(),n=l=>l>=1e9?`$${(l/1e9).toFixed(1)}B`:l>=1e6?`$${(l/1e6).toFixed(1)}M`:l>=1e3?`$${(l/1e3).toFixed(1)}K`:`$${l.toFixed(2)}`,o=l=>{try{const i=new Date(l);return isNaN(i.getTime())?"":i.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}};return s.length===0?e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Trade Distribution Chart"}),e.jsx("div",{className:"no-data",children:"No trade data available for charting"})]}):e.jsx("div",{className:"chart-container",children:e.jsxs("div",{className:"chart-content",children:[e.jsxs("div",{className:"chart-y-axis",children:[e.jsx("div",{className:"y-label",children:"Volume"}),e.jsxs("div",{className:"y-scale",children:[e.jsx("div",{className:"scale-value",children:c(r)}),e.jsx("div",{className:"scale-value",children:c(r*.75)}),e.jsx("div",{className:"scale-value",children:c(r*.5)}),e.jsx("div",{className:"scale-value",children:c(r*.25)}),e.jsx("div",{className:"scale-value",children:"0"})]})]}),e.jsxs("div",{className:"chart-main",children:[e.jsx("div",{className:"chart-bars",children:s.map((l,i)=>{const a=l.volume/r*100,u=l.volume>r*.8;return e.jsx("div",{className:`chart-bar ${u?"high-volume":""}`,style:{height:`${a}%`},title:`Price: $${l.price.toFixed(2)}
Volume: ${c(l.volume)}
Value: ${n(l.value)}
Time: ${o(l.timestamp)}`,children:e.jsx("div",{className:"bar-value",children:c(l.volume)})},`${l.price}-${i}`)})}),e.jsxs("div",{className:"chart-x-axis",children:[e.jsx("div",{className:"x-label",children:"Price ($)"}),e.jsx("div",{className:"x-scale",children:s.map((l,i)=>e.jsx("div",{className:"x-tick",children:e.jsxs("span",{className:"price-label",children:["$",l.price.toFixed(2)]})},`price-${i}`))})]})]})]})})},ss=({trades:t})=>{const s=g.useMemo(()=>{if(!t||t.length===0)return[];const l=new Map;return t.forEach(i=>{const a=new Date(i.timestamp),u=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:00`;if(l.has(u)){const d=l.get(u);d.volume+=i.quantity,d.tradeCount+=1,d.totalValue+=i.price*i.quantity,d.avgPrice=d.totalValue/d.volume}else l.set(u,{time:u,volume:i.quantity,tradeCount:1,avgPrice:i.price,totalValue:i.price*i.quantity})}),Array.from(l.values()).sort((i,a)=>new Date(i.time).getTime()-new Date(a.time).getTime())},[t]),r=g.useMemo(()=>Math.max(...s.map(l=>l.volume),1),[s]),c=l=>l>=1e6?`${(l/1e6).toFixed(1)}M`:l>=1e3?`${(l/1e3).toFixed(1)}K`:l.toString(),n=l=>l>=1e9?`$${(l/1e9).toFixed(1)}B`:l>=1e6?`$${(l/1e6).toFixed(1)}M`:l>=1e3?`$${(l/1e3).toFixed(1)}K`:`$${l.toFixed(2)}`,o=l=>{try{const i=new Date(l);if(isNaN(i.getTime()))return"";const a=String(i.getMonth()+1).padStart(2,"0"),u=String(i.getDate()).padStart(2,"0"),d=String(i.getHours()).padStart(2,"0"),m=String(i.getMinutes()).padStart(2,"0");return`${a}/${u}-${d}:${m}`}catch{return""}};return s.length===0?e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Volume Over Time"}),e.jsx("div",{className:"no-data",children:"No trade data available for time analysis"})]}):e.jsx("div",{className:"chart-container",children:e.jsxs("div",{className:"chart-content",children:[e.jsxs("div",{className:"chart-y-axis",children:[e.jsx("div",{className:"y-label",children:"Volume"}),e.jsxs("div",{className:"y-scale",children:[e.jsx("div",{className:"scale-value",children:c(r)}),e.jsx("div",{className:"scale-value",children:c(r*.75)}),e.jsx("div",{className:"scale-value",children:c(r*.5)}),e.jsx("div",{className:"scale-value",children:c(r*.25)}),e.jsx("div",{className:"scale-value",children:"0"})]})]}),e.jsxs("div",{className:"chart-main",children:[e.jsx("div",{className:"chart-bars",children:s.map((l,i)=>{const a=l.volume/r*100,u=l.volume>r*.8;return e.jsx("div",{className:`chart-bar ${u?"high-volume":""}`,style:{height:`${a}%`},title:`Time: ${o(l.time)}
Volume: ${c(l.volume)}
Trades: ${l.tradeCount}
Avg Price: $${l.avgPrice.toFixed(2)}
Total Value: ${n(l.totalValue)}`,children:e.jsx("div",{className:"bar-value",children:c(l.volume)})},`${l.time}-${i}`)})}),e.jsxs("div",{className:"chart-x-axis",children:[e.jsx("div",{className:"x-label",children:"Time"}),e.jsx("div",{className:"x-scale",children:s.map((l,i)=>e.jsx("div",{className:"x-tick",children:e.jsx("span",{className:"time-label",children:o(l.time)})},`time-${i}`))})]})]})]})})},as=({activeDashboard:t,setActiveDashboard:s})=>{var C;const[r,c]=g.useState(null),[n,o]=g.useState([]),[l,i]=g.useState(null),[a,u]=g.useState(!0),[d,m]=g.useState(null),[x,h]=g.useState(null),[f,w]=g.useState("none"),[P,y]=g.useState(!1),[k,v]=g.useState("");g.useEffect(()=>{(async($=!1)=>{try{u(!0),m(null);const A=await Ce($);if(A.length===0)throw new Error("No dark pool data files found in the data directory");const{mergedData:E,info:H}=Te(A.map(L=>({filename:L.filename,data:L.data,timestamp:L.timestamp})));o(E),i(H),u(!1)}catch(A){console.error("Error loading dark pool data files:",A),m(A instanceof Error?A.message:"Failed to load dark pool data"),u(!1)}})(!1)},[]);const j=g.useMemo(()=>St(n).map($=>{const A=n.filter(S=>S.ticker===$.ticker),E=A.map(S=>S.quantity),H=A.map(S=>S.price*S.quantity),L=A.map(S=>S.price),O=A.reduce((S,_)=>_.quantity>S.quantity?_:S,A[0]),T=$.totalValue/$.tradeCount,F=L.length>1?Math.sqrt(L.reduce((S,_)=>S+Math.pow(_-$.averagePrice,2),0)/L.length):0;return{ticker:$.ticker,totalValue:$.totalValue,totalQuantity:$.totalQuantity,tradeCount:$.tradeCount,averagePrice:$.averagePrice,lastActivity:$.lastActivity,maxTradeValue:Math.max(...H),minTradeValue:Math.min(...H),maxQuantity:Math.max(...E),minQuantity:Math.min(...E),avgTradeSize:T,priceVolatility:F,highestVolumePrice:(O==null?void 0:O.price)||0,highestVolumeTime:(O==null?void 0:O.timestamp)||"",highestVolumeQuantity:(O==null?void 0:O.quantity)||0}}),[n]),D=g.useMemo(()=>{if(!k.trim())return j;const V=k.toLowerCase();return j.filter($=>$.ticker.toLowerCase().includes(V))},[j,k]),p=g.useMemo(()=>r?n.filter(V=>V.ticker===r):[],[n,r]),N=g.useCallback(V=>{c(V)},[]),b=g.useCallback(()=>{c(null)},[]),M=g.useCallback(async()=>{try{console.log("🔄 Performing hard refresh for dark pool data..."),xt(),Yt(),ke(),console.log("✓ Dark pool caches cleared (parsed data, file cache, and price cache)"),console.log("🔄 Reloading dark pool data with cache bypass..."),u(!0),m(null);const V=await Ce(!0);if(V.length===0)throw new Error("No dark pool data files found in the data directory");const{mergedData:$,info:A}=Te(V.map(E=>({filename:E.filename,data:E.data,timestamp:E.timestamp})));if(o($),i(A),h(null),w("none"),y(!1),r){const{price:E,source:H,cached:L}=await ce(r);h(E),w(H),y(L)}u(!1),console.log("✓ Dark pool data reloaded successfully:",{files:A.totalFiles,records:A.totalRecords,latestData:A.dateRange.latest})}catch(V){console.error("Error during hard refresh:",V),m(V instanceof Error?V.message:"Failed to refresh dark pool data"),u(!1)}},[r]);return g.useEffect(()=>{if(!r){h(null),w("none"),y(!1);return}(async()=>{const $=await ce(r);h($.price),w($.source),y($.cached)})()},[r]),a?e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading dark pool data from multiple files..."})]}):d?e.jsxs("div",{className:"dashboard-error",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error Loading Dark Pool Data"}),e.jsx("p",{children:d}),e.jsx("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"darkpool-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"Market Analysis Dashboard"}),l&&e.jsxs("div",{className:"header-stats",children:[e.jsxs("span",{className:"header-stat",children:[l.totalFiles," files"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsxs("span",{className:"header-stat",children:[l.totalRecords.toLocaleString()," records"]}),e.jsx("span",{className:"stat-separator",children:"•"}),e.jsx("span",{className:"header-stat",children:l.files&&l.files.length>0?l.files[0].timestamp.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):((C=l.dateRange.latest)==null?void 0:C.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}))||""})]})]}),e.jsxs("div",{className:"header-right",children:[!r&&e.jsxs("div",{className:"search-container-header",children:[e.jsx(Fe,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search tickers...",value:k,onChange:V=>v(V.target.value)}),k&&e.jsx("button",{className:"clear-search",onClick:()=>v(""),title:"Clear search",children:"×"})]}),e.jsxs("div",{className:"nav-buttons",children:[e.jsx("button",{className:`nav-button ${t==="options"?"active":""}`,onClick:()=>s("options"),children:"Options Analysis"}),e.jsx("button",{className:`nav-button ${t==="darkpool"?"active":""}`,onClick:()=>s("darkpool"),children:"Dark Pool Analysis"}),e.jsx("button",{className:`nav-button ${t==="psychology"?"active":""}`,onClick:()=>s("psychology"),children:"Overall Analysis"})]}),e.jsxs("button",{className:"refresh-button-compact",onClick:M,title:"Hard Refresh - Clears all caches and reloads data from files",children:[e.jsx(Y,{className:"refresh-icon"}),"Hard Refresh"]})]})]}),r?e.jsxs("div",{className:"ticker-detail-view",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("button",{className:"back-button",onClick:b,children:[e.jsx(G,{className:"back-icon"}),"Back to Ticker List"]}),e.jsxs("h2",{children:[r," Dark Pool Analysis"]}),x&&f==="api"?e.jsxs("span",{className:"current-price-badge",children:[e.jsx("span",{className:"price-indicator"}),"Current Price: $",x.toFixed(2),e.jsxs("span",{className:"price-status",children:["(",P?"Cached":"Live",")"]})]}):e.jsx("span",{className:"price-unavailable",children:"Price unavailable"})]}),e.jsxs("div",{className:"charts-container",children:[e.jsx("div",{className:"chart-column",children:e.jsx(ts,{trades:p,ticker:r})}),e.jsx("div",{className:"chart-column",children:e.jsx(ss,{trades:p,ticker:r})})]}),e.jsx("div",{className:"darkpool-trades-section",children:e.jsx(We,{trades:p,ticker:r})})]}):e.jsx(Qe,{tickers:D,onTickerSelect:N,allData:n})]})},rs=({trades:t,sortedAnalyses:s})=>{const r=g.useMemo(()=>s||(!t||t.length===0?[]:Be(t)),[t,s]);return r.length===0?e.jsxs("div",{className:"ticker-weekly-analysis",children:[e.jsx("h3",{children:"Ticker Weekly Analysis"}),e.jsx("p",{children:"No data available for ticker weekly analysis"})]}):e.jsxs("div",{className:"ticker-weekly-analysis",children:[e.jsx("h3",{children:"Ticker Weekly Analysis"}),e.jsx("p",{children:"Bullish/Bearish sentiment by ticker for each week"}),e.jsx("div",{className:"ticker-analysis-grid",children:r.slice(0,20).map(c=>e.jsx(ls,{analysis:c},c.ticker))})]})},ls=({analysis:t})=>{const s=t.weeks.reduce((n,o)=>n+o.totalVolume,0),r=t.weeks.reduce((n,o)=>n+o.totalTrades,0),c=t.weeks.reduce((n,o)=>n+o.totalPremium,0);return e.jsxs("div",{className:`ticker-analysis-card ${t.overallSentiment}`,children:[e.jsxs("div",{className:"ticker-header",children:[e.jsx("h4",{children:t.ticker}),e.jsx("div",{className:`overall-sentiment ${t.overallSentiment}`,children:t.overallSentiment.toUpperCase()})]}),e.jsxs("div",{className:"ticker-summary",children:[e.jsxs("div",{className:"summary-metric",children:[e.jsx("span",{className:"metric-label",children:"Volume"}),e.jsx("span",{className:"metric-value",children:Je(s)})]}),e.jsxs("div",{className:"summary-metric",children:[e.jsx("span",{className:"metric-label",children:"Trades"}),e.jsx("span",{className:"metric-value",children:r.toLocaleString()})]}),e.jsxs("div",{className:"summary-metric",children:[e.jsx("span",{className:"metric-label",children:"Premium"}),e.jsx("span",{className:"metric-value",children:z(c)})]}),e.jsxs("div",{className:"summary-metric",children:[e.jsx("span",{className:"metric-label",children:"Weeks"}),e.jsx("span",{className:"metric-value",children:t.weeks.length})]})]}),e.jsxs("div",{className:"trend-info",children:[e.jsxs("div",{className:`trend-direction ${t.trendDirection}`,children:[e.jsx("span",{className:"trend-label",children:"Trend"}),e.jsx("span",{className:"trend-value",children:t.trendDirection})]}),e.jsxs("div",{className:`confidence ${t.confidence}`,children:[e.jsx("span",{className:"confidence-label",children:"Confidence"}),e.jsx("span",{className:"confidence-value",children:t.confidence})]})]}),e.jsx("div",{className:"weekly-breakdown",children:e.jsx("div",{className:"weeks-list",children:t.weeks.slice(0,2).map(n=>e.jsx(is,{week:n},`${n.weekStart}-${n.weekEnd}`))})})]})},is=({week:t})=>{const s=`${Pe(t.weekStart)} - ${Pe(t.weekEnd)}`;return e.jsxs("div",{className:`week-row ${t.psychology.sentiment}`,children:[e.jsxs("div",{className:"week-header",children:[e.jsx("span",{className:"week-date",children:s}),e.jsx("div",{className:`week-sentiment ${t.psychology.sentiment}`,children:t.psychology.sentiment.toUpperCase()})]}),e.jsxs("div",{className:"week-metrics",children:[e.jsxs("div",{className:"week-metric",children:[e.jsx("span",{className:"metric-label",children:"Vol"}),e.jsx("span",{className:"metric-value",children:Je(t.totalVolume)})]}),e.jsxs("div",{className:"week-metric",children:[e.jsx("span",{className:"metric-label",children:"C/P"}),e.jsx("span",{className:"metric-value",children:t.callPutRatio.toFixed(1)})]}),e.jsxs("div",{className:"week-metric",children:[e.jsx("span",{className:"metric-label",children:"Trd"}),e.jsx("span",{className:"metric-value",children:t.totalTrades})]}),e.jsxs("div",{className:"week-metric",children:[e.jsx("span",{className:"metric-label",children:"Swp"}),e.jsx("span",{className:"metric-value",children:t.sweepCount+t.unusualSweepCount+t.highlyUnusualSweepCount})]})]}),e.jsx("div",{className:"week-psychology",children:e.jsx("span",{className:"psychology-description",children:t.psychology.description})})]})};function Je(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function Pe(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}const ns=({setActiveDashboard:t})=>{const[s,r]=g.useState([]),[,c]=g.useState(null),[n,o]=g.useState(!0),[l,i]=g.useState(null),[a,u]=g.useState("volume"),[d,m]=g.useState("desc"),[x,h]=g.useState(null);g.useEffect(()=>((async(j=!1)=>{try{o(!0),i(null);const D=setTimeout(()=>{i("Loading is taking longer than expected. This might be a cache issue. Try refreshing or clearing cache.")},15e3);h(D);const p=await oe(j);if(p.length===0)throw new Error("No data files found in the data directory");const{mergedData:N,info:b}=re(p);r(N),c(b),D&&(clearTimeout(D),h(null))}catch(D){console.error("Error loading data:",D),i(D instanceof Error?D.message:"Failed to load data"),x&&(clearTimeout(x),h(null))}finally{o(!1)}})(),()=>{x&&clearTimeout(x)}),[]);const f=async()=>{xe(),await W(),await(async()=>{try{o(!0),i(null);const j=setTimeout(()=>{i("Refresh is taking longer than expected. Try clearing cache manually.")},15e3);h(j);const D=await oe(!0);if(D.length===0)throw new Error("No data files found in the data directory");const{mergedData:p,info:N}=re(D);r(p),c(N),j&&(clearTimeout(j),h(null))}catch(j){console.error("Error refreshing data:",j),i(j instanceof Error?j.message:"Failed to refresh data"),x&&(clearTimeout(x),h(null))}finally{o(!1)}})()},w=()=>{xe(),W(),i(null),o(!0),setTimeout(()=>{window.location.reload()},100)},P=g.useMemo(()=>!s||s.length===0?[]:Be(s).sort((j,D)=>{let p,N;switch(a){case"volume":p=j.weeks.reduce((A,E)=>A+E.totalVolume,0),N=D.weeks.reduce((A,E)=>A+E.totalVolume,0);break;case"premium":p=j.weeks.reduce((A,E)=>A+E.totalPremium,0),N=D.weeks.reduce((A,E)=>A+E.totalPremium,0);break;case"trades":p=j.weeks.reduce((A,E)=>A+E.totalTrades,0),N=D.weeks.reduce((A,E)=>A+E.totalTrades,0);break;case"recent":const C=j.weeks[j.weeks.length-1],V=D.weeks[D.weeks.length-1];p=((C==null?void 0:C.totalVolume)||0)+((C==null?void 0:C.totalPremium)||0),N=((V==null?void 0:V.totalVolume)||0)+((V==null?void 0:V.totalPremium)||0);break;case"sentiment":const $={bullish:3,bearish:2,mixed:1,neutral:0};p=$[j.overallSentiment],N=$[D.overallSentiment];break;case"ticker":p=j.ticker,N=D.ticker;break;default:p=0,N=0}if(typeof p=="string"&&typeof N=="string")return d==="asc"?p.localeCompare(N):N.localeCompare(p);const b=Number(p),M=Number(N);return d==="asc"?b-M:M-b}),[s,a,d]),y=v=>{a===v?m(d==="asc"?"desc":"asc"):(u(v),m("desc"))},k=v=>({volume:"Total Volume",premium:"Total Premium",trades:"Total Trades",recent:"Recent Activity",sentiment:"Sentiment",ticker:"Ticker"})[v];return n?e.jsxs("div",{className:"trade-psychology-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsx("button",{className:"back-button",onClick:()=>t("options"),title:"Back to Options Dashboard",children:e.jsx(G,{size:20})}),e.jsx("h2",{children:"Overall Analysis"})]}),e.jsx("div",{className:"sort-controls",children:["volume","premium","trades","recent","sentiment","ticker"].map(v=>e.jsxs("button",{className:`sort-tab ${a===v?"active":""}`,onClick:()=>y(v),title:`Sort by ${k(v)}`,children:[e.jsx("span",{children:k(v)}),a===v&&e.jsx("span",{className:"sort-direction",children:d==="asc"?"↑":"↓"})]},v))}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{className:"refresh-button",onClick:f,title:"Refresh Data",children:e.jsx(Y,{size:20})})})]})}),e.jsx("div",{className:"loading",children:e.jsx("p",{children:"Loading overall analysis data..."})})]}):l?e.jsxs("div",{className:"trade-psychology-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsx("button",{className:"back-button",onClick:()=>t("options"),title:"Back to Options Dashboard",children:e.jsx(G,{size:20})}),e.jsx("h2",{children:"Overall Analysis"})]}),e.jsx("div",{className:"sort-controls",children:["volume","premium","trades","recent","sentiment","ticker"].map(v=>e.jsxs("button",{className:`sort-tab ${a===v?"active":""}`,onClick:()=>y(v),title:`Sort by ${k(v)}`,children:[e.jsx("span",{children:k(v)}),a===v&&e.jsx("span",{className:"sort-direction",children:d==="asc"?"↑":"↓"})]},v))}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{className:"refresh-button",onClick:f,title:"Refresh Data",children:e.jsx(Y,{size:20})})})]})}),e.jsxs("div",{className:"error",children:[e.jsx("div",{className:"error-icon",children:e.jsx(Se,{size:48})}),e.jsx("h3",{children:"Error Loading Data"}),e.jsx("p",{children:l}),e.jsxs("div",{className:"error-actions",children:[e.jsxs("button",{onClick:f,className:"retry-button",children:[e.jsx(Y,{size:16}),"Try Again"]}),e.jsxs("button",{onClick:w,className:"clear-cache-button",children:[e.jsx(Se,{size:16}),"Clear Cache & Reload"]})]})]})]}):e.jsxs("div",{className:"trade-psychology-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsxs("div",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsx("button",{className:"back-button",onClick:()=>t("options"),title:"Back to Options Dashboard",children:e.jsx(G,{size:20})}),e.jsx("h2",{children:"Overall Analysis"})]}),e.jsx("div",{className:"sort-controls",children:["volume","premium","trades","recent","sentiment","ticker"].map(v=>e.jsxs("button",{className:`sort-tab ${a===v?"active":""}`,onClick:()=>y(v),title:`Sort by ${k(v)}`,children:[e.jsx("span",{children:k(v)}),a===v&&e.jsx("span",{className:"sort-direction",children:d==="asc"?"↑":"↓"})]},v))}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{className:"refresh-button",onClick:f,title:"Refresh Data",children:e.jsx(Y,{size:20})})})]})}),e.jsx(rs,{trades:s,sortedAnalyses:P})]})};class os extends g.Component{constructor(s){super(s),this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),this.setState({error:s,errorInfo:r})}render(){var s,r;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"An error occurred while rendering this component."}),e.jsxs("details",{className:"error-details",children:[e.jsx("summary",{children:"Error Details"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("pre",{children:(r=this.state.errorInfo)==null?void 0:r.componentStack})]}),e.jsx("button",{className:"retry-button",onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),children:"Try Again"})]})}):this.props.children}}function cs(){const[t,s]=g.useState("options");return e.jsx("div",{className:"app",children:e.jsx("main",{children:e.jsx(os,{children:t==="options"?e.jsx(es,{activeDashboard:t,setActiveDashboard:s}):t==="darkpool"?e.jsx(as,{activeDashboard:t,setActiveDashboard:s}):e.jsx(ns,{activeDashboard:t,setActiveDashboard:s})})})})}"serviceWorker"in navigator&&(window.addEventListener("load",()=>{const t="/optionAnalysis/";navigator.serviceWorker.register(`${t}sw.js`).then(s=>{console.log("SW registered: ",s),s.addEventListener("updatefound",()=>{const r=s.installing;r==null||r.addEventListener("statechange",()=>{r.state==="installed"&&navigator.serviceWorker.controller&&console.log("🔄 New service worker available. Please reload the page.")})})}).catch(s=>{console.log("SW registration failed: ",s)})}),window.clearAllCaches=async()=>{try{const t=await navigator.serviceWorker.getRegistrations();await Promise.all(t.map(r=>r.unregister()));const s=await caches.keys();await Promise.all(s.map(r=>caches.delete(r))),sessionStorage.clear(),localStorage.clear(),console.log("✅ All caches cleared!"),alert("All caches cleared! Please reload the page."),window.location.reload()}catch(t){console.error("Failed to clear caches:",t)}});Zt();pe.createRoot(document.getElementById("root")).render(e.jsx(Ze.StrictMode,{children:e.jsx(cs,{})}));
//# sourceMappingURL=index-4599f69b-1761757587550.js.map
